<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport"    content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author"      content="">

<link href="atom.xml" type="application/atom+xml" rel="alternate" title="Atom feed for Blog: Model Train-related Notes" />

<meta property="og:url"         content="https://www.alfray.com/trains/blog/train/0001.html" />
<meta property="og:type"        content="article" />

<meta property="og:title"       content="Blog: Model Train-related Notes" />
<meta property="og:description" content="I got these for Randall and they are working very nicely: https://amzn.to/4evzCYk&nbsp;“DC-DC Boost Converter, XH-M411 DC to DC 3-35V to 5-45V (2 pack)”. The cost was $6.50 per converter." />
<meta property="og:image"       content="https://www.alfray.com/trains/blog/train/img_49b9e611ad3353f95a2af60b5f62af72c62cedfd883aa396a31cf9bbf6df968di.jpg" />

<meta name="twitter:card"        content="summary" />
<!-- meta name="twitter:site"    content="@flickr" / -->

<meta name="twitter:title"       content="Blog: Model Train-related Notes" />
<meta name="twitter:description" content="I got these for Randall and they are working very nicely: https://amzn.to/4evzCYk&nbsp;“DC-DC Boost Converter, XH-M411 DC to DC 3-35V to 5-45V (2 pack)”. The cost was $6.50 per converter." />
<meta name="twitter:image"       content="https://www.alfray.com/trains/blog/train/img_49b9e611ad3353f95a2af60b5f62af72c62cedfd883aa396a31cf9bbf6df968di.jpg" />

<title>Blog: Model Train-related Notes</title>

<script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5c66171070e9220011ed1c61&product=inline-share-buttons" async="async"></script>

<!-- Custom styles for this template -->
<style type="text/css">
body {
    font-family: sans-serif;
    margin: 0;
}

.main {
    margin: 8px;
}

p, span {
    line-height: 1.2;
    text-align: justify;
}

p.console {
    margin: 0;
    padding: 0;
}

.container {
    max-width: 95%;
}

@media screen and (min-width: 600px) {
    .container {
        max-width: 60rem;
    }
}

.center-horiz {
    margin: auto;
}

.no-margin-container {
}

/* Header + Title */
.blog-header {
  margin-bottom: 3rem;
  background-color: #428bca;
  box-shadow: inset 0 -.1rem .25rem rgba(0,0,0,.1);
}


.banner-bg-image {
    height: 50px;
    background-image: url("header.jpg");
    background-position: center;
    background-size: 100% auto;
}

@media screen and (min-width: 600px) {
    .banner-bg-image {
        height: 200px;
    }
}


.title-container {
    color: #fff;
    padding: 1rem;
    line-height: 1.5;
    font-weight: 500;
    font-size: 24px;
    font-family: sans-serif;
}

.title-container a {
    color: #fff;
    text-decoration: none;
}

.post-container {
}

.bottom-container {
    margin-top: 8px;
    color: #fff;
    background-color: #428bca;
    font-family: sans-serif;
    text-align: center;
    font-size: small;
    line-height: 1rem;
}

@media screen and (min-width: 600px) {
    .bottom-container {
        font-size: x-small;
    }
}

.post-title-container {
    position: relative;
    background-color: #428bca;
    padding: 0.5rem;
}

.post-title {
    display: inline;
    color: #fff;
    font-weight: 500;
    font-family: sans-serif;
    font-size: 1.5em;
}

a.post-title-link {
    color: #fff;
    text-decoration: none;
}

.post-cat {
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    padding: 0.25rem;
    background-color: #d0e0e3;
    color: #000;
    font-weight: 500;
    font-family: sans-serif;
    font-size: 1.5em;
}

a.post-cat-link {
    color: #000;
    text-decoration: none;
}

.post-cat-label {
    display: block;
    text-align: right;
    color: #000;
    font-size: 0.4em;
}

.prev-next-container {
    overflow: auto;
}

.prev-page {
    float: left;
    line-height: 2em;
}

.next-page {
    float: right;
    line-height: 2em;
}

h1, h2, h3, h4, h5, h6 {
    font-family: sans-serif;
    font-weight: bold;
}

.text-hide {
    font: 0/0 a;
    color: transparent;
    text-shadow: none;
    background-color: transparent;
    border: 0;
}

td p {
    margin: 0;
}


</style>
</head>

<body>

<header class="blog-header">

    <div class="no-margin-container banner-bg-image text-hide">
        Site Banner Image
    </div>

    <div class="title-container">
        <a href="https://www.alfray.com/trains/">Ralf's Train Pages</a>
        
        /
        <a href="0001.html">Blog: Model Train-related Notes</a>
        
    </div>
</header>

<main role="main">
<div class="main">
<div class="container center-horiz">

<p><span> </span></p>
<p><span></span></p>
<p><span> </span></p>
<p><span style="font-style:italic">Model Train-related Notes Blog -- t</span><span style="font-style:italic">hese are personal notes and musings on the subject of model train control, automation, electronics, or whatever I find interesting. I also have more posts in a blog dedicated to the maintenance of the </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);font-style:italic;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/blog/randall/" style="color:inherit;text-decoration:inherit">Randall Museum Model Railroad</a></span><span style="font-style:italic">.</span></p>
<p><span></span></p>

<div class="prev-next-container">

    <span class="prev-page"><a href="index.html">⇐ Newer Posts</a><br/></span>
    <span class="next-page"><a href="0002.html">Older Posts ⇒</a><br/></span>


</div>



    <div class="post-container">
<div class="post-title-container">
<a class="post-title-link" href="2024-11-21_dc-dc_boost_step-up_converter_xh-m411.html">
    <h2 class="post-title">2024-11-21 - DC-DC Boost Step-Up Converter XH-M411</h2>
</a>
<span class="post-cat" title="Category">
    <span class="post-cat-label">Category</span>
    <span class="post-cat-text">
    Electronics
    
    </span>
</span></div>

<p><span></span></p>
<p></p>
<p><span>I got these for Randall and they are working very nicely: </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://amzn.to/4evzCYk" style="color:inherit;text-decoration:inherit">https://amzn.to/4evzCYk</a></span><span>&nbsp;“</span><span>DC-DC Boost Converter, XH-M411 DC to DC 3-35V to 5-45V (2 pack)”. The cost was $6.50 per converter.</span></p>
<p></p>
<p><span>There’s no usage manual (or I lost it?), so let’s copy stuff here:</span></p>
<p></p>
<p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:0.00px solid #000000;display:inline-block;height:437.50px;margin:0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:481.48px"><img alt="" src="img_49b9e611ad3353f95a2af60b5f62af72c62cedfd883aa396a31cf9bbf6df968di.jpg" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p>
<p></p>
<p></p>
<p><span>What the button does is switch the </span><span style="font-style:italic">display</span><span>&nbsp;from displaying input to displaying output voltage. The blue LED turns on on the input/output side depending on what is displayed.</span></p>
<p></p>
<p><span>Output voltage is adjusted using the tiny blue potentiometer next to the radiator.</span></p>
<p><span></span></p>

<a href="2024-11-21_dc-dc_boost_step-up_converter_xh-m411.html">Click here to continue reading...</a>
<p/>
<hr/>
</div>
<div class="post-container">
<div class="post-title-container">
<a class="post-title-link" href="2024-10-14_conductor_2_freight_starts_w_ce787171.html">
    <h2 class="post-title">2024-10-14 - Conductor 2: Freight starts when Passenger goes into Error</h2>
</a>
<span class="post-cat" title="Category">
    <span class="post-cat-label">Category</span>
    <span class="post-cat-text">
    Rtac
    
    </span>
</span></div>

<p><span></span></p>
<p></p>
<p><span>In the old Conductor 1, anytime the train sequence did not work as expected, the engine simply stopped everything, and we had to manually replace the trains as expected and restart everything.<br>Thus, when I redesigned the new </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/randall/rtac" style="color:inherit;text-decoration:inherit">Conductor 2</a></span><span>, I added some “recovery” functionality -- the idea is that if the train sequence does not happen as expected, the automation engine should do something to try to recover the trains.</span></p>
<p></p>
<p><span>Unfortunately, the idea of “recovery” is basically to more or less predict the unpredictable and decide what the automation program should do in that case. Which means there are always cases that one never thought about because that “could never happen” and thus such cases are not handled. Today is one such case.</span></p>
<p></p>
<p><span>Orion and I have been slowly working on fixing the Branchline T324 turnout. That involves crawling through one of the mountain access holes, and then we need to reach the Branchline over the Mainline track. To make it more fun, that’s one of the tracks used by the Passenger train automation.</span></p>
<p></p>
<p><span>Twice I’ve seen the Passenger train go into error mode while we were trying to work on the Branchline T324 turnout. What was even more puzzling is that the Passenger was at Summit and then the Freight train just… started! Suddenly, on the </span><span style="font-style:italic">same track</span><span>, I had the Passenger train go into recovery and thus reversing towards the station whilst at the same time I had the Freight train leaving the station… Each going towards each other in the opposite direction. Not exactly a good scenario.</span></p>
<p></p>
<p><span>Hilarity ensues.</span></p>
<p></p>
<p><span>The first part of the puzzle was easy to find: when we crawl into the mountain access hole, we somehow activate the block B340. It’s not exactly clear </span><span style="font-style:italic">why</span><span>&nbsp;and </span><span style="font-style:italic">how</span><span>&nbsp;that happens, yet that sure is the result.</span></p>
<p></p>
<p><span>Here’s an excerpt from </span><span style="font-style:italic">conductor-log-2024-10-12-08-40-03.txt</span><span>:</span></p>
<p><span></span></p>

<a href="2024-10-14_conductor_2_freight_starts_w_ce787171.html">Click here to continue reading...</a>
<p/>
<hr/>
</div>
<div class="post-container">
<div class="post-title-container">
<a class="post-title-link" href="2024-10-12_conductor_2_sensor_issues_on_483b2f5d.html">
    <h2 class="post-title">2024-10-12 - Conductor 2: Sensor Issues on B330 and B360</h2>
</a>
<span class="post-cat" title="Category">
    <span class="post-cat-label">Category</span>
    <span class="post-cat-text">
    Rtac
    
    </span>
</span></div>

<p><span></span></p>
<p></p>
<p><span>This happened once, when Allen and Jim ended their Saturday session:</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>At 1:40pm, they turned the "Saturday mode" switch off, turned the Mainline Automation toggle on. Consequently, the Freight train correctly moved back to its normal position.</span></li>
</ul>
<p><span>So far that seems normal. However...</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>At 1:42pm and 1:43pm, the computer registered multiple on/off instances of block detection on Block B330 -- there were about a dozen on/off activations for 2 seconds -- but also B360 registers as on -- see below.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>Cameras show they were not running anything at that time, and that block B330 is clearly empty. I cannot see B360 however nothing on the video indicates there should be anything on it (no trains going in or out in the following minutes).</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>Camera shows Allen moving trains to Richmond via B160/B150 a minute later. I don’t think it’s related.</span></li>
</ul>
<p></p>
<p><span>Here’s an excerpt from </span><span style="font-style:italic">conductor-log-2024-10-12-08-40-03.txt</span><span>:</span></p>
<p></p>
<p style="margin-left:36pt;text-align:left" class="console "><span>⇒ This starts just after the Freight train has reached its default parking location at the Station: <br></span><span style="font-family:&quot;Consolas&quot;;font-size:9pt">13:42:34.779 R Idle Mainline #0 ML Ready : ACTIVE</span></p>
<p style="margin-left:36pt;text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:9pt">13:42:35.972 S S/NS773 B330 : ON</span></p>
<p style="margin-left:36pt;text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:9pt">13:42:36.937 S S/NS773 B330 : OFF</span></p>
<p style="margin-left:36pt;text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:9pt">13:42:37.833 S S/NS773 B330 : ON</span></p>
<p style="margin-left:36pt;text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:9pt">13:42:38.962 S S/NS773 B330 : OFF</span></p>
<p style="margin-left:36pt;text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:9pt">13:42:39.659 S S/NS773 B330 : ON</span></p>
<p style="margin-left:36pt;text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:9pt">13:42:40.639 S S/NS773 B330 : OFF</span></p>
<p style="margin-left:36pt;text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:9pt">13:42:41.520 S S/NS773 B330 : ON</span></p>
<p style="margin-left:36pt;text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:9pt">13:42:42.416 S S/NS773 B330 : OFF</span></p>
<p style="margin-left:36pt;text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:9pt">13:42:43.348 S S/NS773 B330 : ON</span></p>
<p style="margin-left:36pt;text-align:left"><span></span></p>

<a href="2024-10-12_conductor_2_sensor_issues_on_483b2f5d.html">Click here to continue reading...</a>
<p/>
<hr/>
</div>
<div class="post-container">
<div class="post-title-container">
<a class="post-title-link" href="2023-11-24_sdb_first_trolley_automation_ecde7037.html">
    <h2 class="post-title">2023-11-24 - SDB: First Trolley Automation Test, Continued</h2>
</a>
<span class="post-cat" title="Category">
    <span class="post-cat-label">Category</span>
    <span class="post-cat-text">
    SDB
    
    </span>
</span></div>

<p><span></span></p>
<p></p>
<p><span style="font-style:italic">The </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);font-style:italic;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://github.com/model-railroad/sdb" style="color:inherit;text-decoration:inherit">Software Defined Blocks</a></span><span style="font-style:italic">&nbsp;project uses an ESP32 with sensors to emulate block activations for a train model railroad</span><span>.</span></p>
<p></p>
<p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:0.00px solid #000000;display:inline-block;height:282.67px;margin:0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:796.80px"><img alt="" src="img_5244b4ed2bc9b875000ac241baa0aaa5f3900b00fae020592646d8c0f37f8315i.jpg" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p>
<p></p>
<p><span>The first prototype automation test has been overwhelmingly problematic:</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>At first, I could not get the ToF sensor to reliably detect the engine. It would seem to work, then most of the time it would not detect a decreasing distance as the trolley was approaching till it was right next to the sensor.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>At the same time, my mere presence a couple feet on the side would influence the result. That’s not good.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>The response time in JMRI seems extremely slow.</span></li>
</ul>
<p></p>
<p><span>Let’s detail that last one.</span></p>
<p><span></span></p>

<a href="2023-11-24_sdb_first_trolley_automation_ecde7037.html">Click here to continue reading...</a>
<p/>
<hr/>
</div>
<div class="post-container">
<div class="post-title-container">
<a class="post-title-link" href="2023-11-11_dcc-ex_command_station.html">
    <h2 class="post-title">2023-11-11 - DCC-EX Command Station</h2>
</a>
<span class="post-cat" title="Category">
    <span class="post-cat-label">Category</span>
    <span class="post-cat-text">
    DCC
    
    </span>
</span></div>

<p><span></span></p>
<p></p>
<p><span>I realize I don’t know the exact details of what’s needed for </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://dcc-ex.com/" style="color:inherit;text-decoration:inherit">DCC-EX</a></span><span>. So let’s look into it.</span></p>
<p><span>I also wonder how much some of the hardware parts cost, out of curiosity.</span></p>
<p></p>
<p><span>To start with, a </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://dcc-ex.com/ex-commandstation/index.html" style="color:inherit;text-decoration:inherit">DCC-EX Command Station</a></span><span>&nbsp;is, as the name suggests, a command station for DCC -- digital control of model trains. What makes this interesting is that it’s a complete DIY system based around an Arduino board, an extra board providing the track power, and an open-source free software. Depending on the kind of Arduino board used, the trains can then be controlled via a computer and a web page, or even an Android or iPhone.</span></p>
<p></p>
<p><span>Here’s the one I made using the recommended components. It is pictured next to an HO-scale engine to show you how small it is:</span></p>
<p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:0.00px solid #000000;display:inline-block;height:334.67px;margin:0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:796.80px"><img alt="" src="img_e93d1ea97f855b743c90c75ddfe0df6f516e29a96b7897e2cab624feffa4360fi.jpg" style="margin-left:0.00px;margin-top:0.00px" title=""></span><span><br></span><span style="font-style:italic">An Arduino UNO with a Motor Shield. <br>Bottom jack is the input power for the track.<br>The USB cable provides power to the Arduino + web page for control.</span></p>
<p></p>
<p><span>Of note, a DCC-EX command station can generate two track outputs. That can be 2 DCC signals -- for example for a mainline track + a separate programming track -- or it can be one DCC signal plus a separate DC signal. E.g. one could make a circuit with one loop on DCC, one loop on DC voltage, and control both independently..</span></p>
<p></p>
<p><span>On the hardware side, one needs two things:</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>An Arduino board -- that’s the “computer” part</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>A “motor shield” -- that’s the part at the top that produces the track voltage.</span></li>
</ul>
<p><span></span></p>

<a href="2023-11-11_dcc-ex_command_station.html">Click here to continue reading...</a>
<p/>
<hr/>
</div>
<div class="post-container">
<div class="post-title-container">
<a class="post-title-link" href="2023-11-02_sdb_first_trolley_automation_test.html">
    <h2 class="post-title">2023-11-02 - SDB: First Trolley Automation Test</h2>
</a>
<span class="post-cat" title="Category">
    <span class="post-cat-label">Category</span>
    <span class="post-cat-text">
    SDB
    
    </span>
</span></div>

<p><span></span></p>
<p></p>
<p><span style="font-style:italic">The </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);font-style:italic;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://github.com/model-railroad/sdb" style="color:inherit;text-decoration:inherit">Software Defined Blocks</a></span><span style="font-style:italic">&nbsp;project uses an ESP32 with sensors to emulate block activations for a train model railroad</span><span>.</span></p>
<p></p>
<p><span>I brought my prototype board to Randall today and gave it a try with the desired trolley:</span></p>
<p></p>
<p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:0.00px solid #000000;display:inline-block;height:244.00px;margin:0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:796.80px"><img alt="" src="img_c5f8b56e7364c511a43532c7a941c8cb273f0d3f09330438df8eb6f5e96f7592i.jpg" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p>
<p></p>
<p><span>The SDB prototype detected the trolley properly. When placed this way against the end bumper, we can adequately measure the trolley distance between 10 mm and 400 mm (1 cm up to 40 cm). After that, we always get a value in the 400 range.</span></p>
<p></p>
<p><span>Note that in this test, I did not hook SDB to the main JMRI computer for actual control. The goal was to determine which sensor placement would fulfill the detection need. Whatever is on the picture above seems like it will work correctly, so I’ll go ahead and create some kind of sensor support -- probably out of foam/cardboard first and then later 3d-printed or stuck to a little building.</span></p>
<p></p>
<p><span>Here’s an overview of the track I want to control:</span></p>
<p></p>
<p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:0.00px solid #000000;display:inline-block;height:166.67px;margin:0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:796.80px"><img alt="" src="img_7bf923351e2d89701926b89b6c8fa0cc9c48bbe6ed090bad7abf62c8dc8ca4e9d.jpg" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p>
<p><span></span></p>

<a href="2023-11-02_sdb_first_trolley_automation_test.html">Click here to continue reading...</a>
<p/>
<hr/>
</div>
<div class="post-container">
<div class="post-title-container">
<a class="post-title-link" href="2023-11-01_sdb_vl53l0x_tof_sensor_accuracy.html">
    <h2 class="post-title">2023-11-01 - SDB: VL53L0X ToF Sensor Accuracy</h2>
</a>
<span class="post-cat" title="Category">
    <span class="post-cat-label">Category</span>
    <span class="post-cat-text">
    SDB
    
    </span>
</span></div>

<p><span></span></p>
<p></p>
<p><span style="font-style:italic">The </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);font-style:italic;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://github.com/model-railroad/sdb" style="color:inherit;text-decoration:inherit">Software Defined Blocks</a></span><span style="font-style:italic">&nbsp;project uses an ESP32 with sensors to emulate block activations for a train model railroad</span><span>.</span></p>
<p></p>
<p><span>The initial design called for the use of two ToF sensors, one on each side of the piece of track to automate. That would allow the automation to precisely stop the train on either side. The piece of track I want to monitor is about 3 meters long.</span></p>
<p></p>
<p><span>I selected the </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.adafruit.com/product/3317" style="color:inherit;text-decoration:inherit">Adafruit VL53L0X</a></span><span>&nbsp;“Time of Flight Distance Sensor” for this application.</span></p>
<p></p>
<p><span>The specification lists the sensor as having a 30 mm to 1 meter range. The idea was thus to have 2 sensors, one on each side of the track to monitor, thus creating 3 “virtual blocks”: each sensor would monitor about 1 meter of the track, and if the engine is not detected there, we would assume it would be in the middle.</span></p>
<p></p>
<p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:0.00px solid #000000;display:inline-block;height:123.01px;margin:0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:796.80px"><img alt="" src="img_f166c02c848f568b930b21b2611854915be1af943b5f7a9d21919c483a3cc23fd.jpg" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p>
<p></p>
<p><span>Unfortunately, as soon as I tried the sensor, I realized that it does not work for </span><span style="font-style:italic">this specific application</span><span>.</span></p>
<p style="text-align:left"><span></span></p>

<a href="2023-11-01_sdb_vl53l0x_tof_sensor_accuracy.html">Click here to continue reading...</a>
<p/>
<hr/>
</div>
<div class="post-container">
<div class="post-title-container">
<a class="post-title-link" href="2023-10-13_sdb_supporting_two_tof_sensors.html">
    <h2 class="post-title">2023-10-13 - SDB: Supporting two ToF Sensors</h2>
</a>
<span class="post-cat" title="Category">
    <span class="post-cat-label">Category</span>
    <span class="post-cat-text">
    SDB
    
    </span>
</span></div>

<p><span></span></p>
<p></p>
<p><span style="font-style:italic">The </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);font-style:italic;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://github.com/model-railroad/sdb" style="color:inherit;text-decoration:inherit">Software Defined Blocks</a></span><span style="font-style:italic">&nbsp;project uses an ESP32 with sensors to emulate block activations for a train model railroad</span><span>.</span></p>
<p></p>
<p><span>The initial design calls to use two ToF sensors, one on each side of the piece of track to automate. That would allow the automation to precisely stop the train on either side.</span></p>
<p></p>
<p><span>The sensor I use is the Adafruit VL53L0X. It connects on the I2C bus at a specific 0x29 address. However, </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://learn.adafruit.com/adafruit-vl53l0x-micro-lidar-distance-sensor-breakout/arduino-code" style="color:inherit;text-decoration:inherit">it is possible to change the address in software</a></span><span>: one of the sensor’s pins named XSHUT is to “shutdown” the sensor. The procedure is to connect both sensors on the I2C bus, and have the two sensors’ XSHUT pins connected to different GPIO pins. This makes it possible to selectively turn them on at boot, changing their address one by one.</span></p>
<p style="text-align:left"><span></span></p>

<a href="2023-10-13_sdb_supporting_two_tof_sensors.html">Click here to continue reading...</a>
<p/>
<hr/>
</div>
<div class="post-container">
<div class="post-title-container">
<a class="post-title-link" href="2023-09-18_converting_a_bachmann_spectr_f4f13891.html">
    <h2 class="post-title">2023-09-18 - Converting a Bachmann Spectrum Shay to DCC</h2>
</a>
<span class="post-cat" title="Category">
    <span class="post-cat-label">Category</span>
    <span class="post-cat-text">
    DCC
    
    </span>
</span></div>

<p><span></span></p>
<p style="text-align:center"><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><iframe width="560" height="315" src="https://www.youtube.com/embed/LaWar07neX4" frameborder="0" allowfullscreen></iframe></span><span><br></span><span style="font-style:italic">The Shay running at Randall after DCC conversion</span><span>.</span></p>
<p></p>
<p><span>I recently got a Bachmann Spectrum Shay -- the “80-ton 3 truck Shay” #81901. The one I got is an unlettered black version, used, and in good condition. All gears work. It has an 8-pin NMRA / NEM652 connector, and it screams to be converted to DCC so we’ll discuss this effort here.</span></p>
<p></p>
<p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:0.00px solid #000000;display:inline-block;height:392.00px;margin:0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:796.80px"><img alt="" src="img_56ce127f7cdbd95e5a2ac07557ddfbe917c3cb36e511ab2db101c1fa02761886i.jpg" style="margin-left:0.00px;margin-top:0.00px" title=""></span><span><br></span><span style="font-style:italic">The Bachmann Shay before DCC conversion, as unboxed.</span></p>
<p></p>
<p><span style="font-weight:700">Initial Observations</span></p>
<p></p>
<p><span>Here are the initial observations:</span></p>
<p><span></span></p>

<a href="2023-09-18_converting_a_bachmann_spectr_f4f13891.html">Click here to continue reading...</a>
<p/>
<hr/>
</div>
<div class="post-container">
<div class="post-title-container">
<a class="post-title-link" href="2023-09-11_conductor_2_route_statistics_54d3297b.html">
    <h2 class="post-title">2023-09-11 - Conductor 2: Route Statistics with Numbers</h2>
</a>
<span class="post-cat" title="Category">
    <span class="post-cat-label">Category</span>
    <span class="post-cat-text">
    Rtac
    
    </span>
</span></div>

<p><span></span></p>
<p></p>
<p><span>In the latest version of </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/randall/rtac" style="color:inherit;text-decoration:inherit">Conductor 2</a></span><span>, I’ve </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/blog/train/2023-08-23_conductor_2_route_statistics.html" style="color:inherit;text-decoration:inherit">added “end-of-route statistics”</a></span><span>. I’ve now accumulated enough data to start looking at it.</span></p>
<p></p>
<p><span>First, I needed to parse a JSON log file (a log file with one JSON entry per line per day per run), and I needed a way to convert that to CSV to dump it in a Google Spreadsheet. I briefly considered writing a short python script to do that, then realized that nothing can beat the awesomeness of </span><span style="font-style:italic">sed</span><span>, so I ended up with this:</span></p>
<p></p>
<table style="border-collapse:collapse;border-spacing:0;margin-right:auto">
 <tbody>
  <tr style="height:0pt">
   <td colspan="1" rowspan="1" style="border-bottom-color:rgb(0, 0, 0);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(0, 0, 0);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(0, 0, 0);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(0, 0, 0);border-top-style:solid;border-top-width:1pt;padding:5pt 5pt 5pt 5pt;vertical-align:top;width:597.6pt"><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:9pt;vertical-align:baseline">$ grep '{"name"' conductor-log-2023-09-* | sed -E -n '/Recovery/d; /true/d; s/^[^0-9]+//; s/([0-9-]{10})[^:]+:/\1 /; s/ R Seq[^\{]+/@ /; s/":/" /g; s/[^a-zA-Z0-9@.:-]+/,/g; s/@/,/g; s/,ms,([0-9]{3,})/,\1,ms/g; s/([0-9])([0-9]{3}),ms/\1.\2,ms/g; s/,name,|,th|,act|,err,false,nodes|,n|,ms//g; p' &nbsp;| tee ~/temp/_csv.txt</span></p></td>
  </tr>
 </tbody>
</table>
<p></p>
<p><span>I regret nothing. &lt;insert appropriate meme&gt;</span></p>
<p></p>
<p><span>I shall note that this expression purposely only selects log lines that have no errors, that is, successful runs that have completed with no issue. This will become relevant later.</span></p>
<p></p>
<p><span>Now let’s look at the collected data.</span></p>
<p></p>
<p><span style="font-weight:700">Freight Route</span></p>
<p></p>
<p><span>This is a simple shuttle route over two blocks: we’re moving from block B311 (the </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/randall/about.html#h.1a30ydkpyo99" style="color:inherit;text-decoration:inherit">Stockton Station</a></span><span>) to B321 (the Sonora Station), stopping there, and then back again to B311. The way I wrote the route stats aggregator, I add an index number when a block is repeated, so “B311.1” means “block B311 when leaving”, and “B311.2” means “block B311 when coming back”.</span></p>
<p></p>
<p><span>I have 98 runs for this one, and when we compute the stats we get a very nice result:</span></p>
<p></p>
<p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:0.00px solid #000000;display:inline-block;height:418.67px;margin:0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:796.80px"><img alt="" src="img_00608dbba9a28644b702a86dff07157c6de2bf69670bddeddfa57ed5fe2931d0i.png" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p>
<p><span></span></p>

<a href="2023-09-11_conductor_2_route_statistics_54d3297b.html">Click here to continue reading...</a>
<p/>
<hr/>
</div>





<div class="prev-next-container">

    <span class="prev-page"><a href="index.html">⇐ Newer Posts</a><br/></span>
    <span class="next-page"><a href="0002.html">Older Posts ⇒</a><br/></span>


</div>

</div> <!-- container -->
</div> <!-- main -->

<div class="sharethis-inline-share-buttons"></div>

<div class="bottom-container">&nbsp;Generated on 2025-09-02 by Rig4j 0.1-Exp-05cc7b2&nbsp;</div>

</main>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-M1KDMEFC4D"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-M1KDMEFC4D');
</script>

</body>
</html>

