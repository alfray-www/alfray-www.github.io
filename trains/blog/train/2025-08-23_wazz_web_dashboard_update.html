<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport"    content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author"      content="">

<link href="atom.xml" type="application/atom+xml" rel="alternate" title="Atom feed for Blog: Model Train-related Notes" />

<meta property="og:url"         content="https://www.alfray.com/trains/blog/train/2025-08-23_wazz_web_dashboard_update.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Wazz Web Dashboard Update" />

<meta property="og:description" content="“Wazz” is my own web-based dashboard to get an instant overview of the automation at the Randall Museum Model Railroad. Last month, I started revamping the web site&nbsp;with a more modern implementation, and after about a month of work, I’ve just finished this major rework on the status dashboard with the following architecture:" />
<meta property="og:image"       content="https://www.alfray.com/trains/blog/train/img_940d6c4be6094d2d9b07997b3831fb09ac0e2659ed6ad72d94a95f6ea8a39198d.jpg" />

<meta name="twitter:card"        content="summary" />
<!-- meta name="twitter:site"    content="@flickr" / -->
<meta name="twitter:title"       content="Wazz Web Dashboard Update" />

<meta name="twitter:description" content="“Wazz” is my own web-based dashboard to get an instant overview of the automation at the Randall Museum Model Railroad. Last month, I started revamping the web site&nbsp;with a more modern implementation, and after about a month of work, I’ve just finished this major rework on the status dashboard with the following architecture:" />
<meta name="twitter:image"       content="https://www.alfray.com/trains/blog/train/img_940d6c4be6094d2d9b07997b3831fb09ac0e2659ed6ad72d94a95f6ea8a39198d.jpg" />

<title>Blog: Model Train-related Notes</title>

<script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5c66171070e9220011ed1c61&product=inline-share-buttons" async="async"></script>

<!-- Custom styles for this template -->
<style type="text/css">
body {
    font-family: sans-serif;
    margin: 0;
}

.main {
    margin: 8px;
}

p, span {
    line-height: 1.2;
    text-align: justify;
}

p.console {
    margin: 0;
    padding: 0;
}

.container {
    max-width: 95%;
}

@media screen and (min-width: 600px) {
    .container {
        max-width: 60rem;
    }
}

.center-horiz {
    margin: auto;
}

.no-margin-container {
}

/* Header + Title */
.blog-header {
  margin-bottom: 3rem;
  background-color: #428bca;
  box-shadow: inset 0 -.1rem .25rem rgba(0,0,0,.1);
}


.banner-bg-image {
    height: 50px;
    background-image: url("header.jpg");
    background-position: center;
    background-size: 100% auto;
}

@media screen and (min-width: 600px) {
    .banner-bg-image {
        height: 200px;
    }
}


.title-container {
    color: #fff;
    padding: 1rem;
    line-height: 1.5;
    font-weight: 500;
    font-size: 24px;
    font-family: sans-serif;
}

.title-container a {
    color: #fff;
    text-decoration: none;
}

.post-container {
}

.bottom-container {
    margin-top: 8px;
    color: #fff;
    background-color: #428bca;
    font-family: sans-serif;
    text-align: center;
    font-size: small;
    line-height: 1rem;
}

@media screen and (min-width: 600px) {
    .bottom-container {
        font-size: x-small;
    }
}

.post-title-container {
    position: relative;
    background-color: #428bca;
    padding: 0.5rem;
}

.post-title {
    display: inline;
    color: #fff;
    font-weight: 500;
    font-family: sans-serif;
    font-size: 1.5em;
}

a.post-title-link {
    color: #fff;
    text-decoration: none;
}

.post-cat {
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    padding: 0.25rem;
    background-color: #d0e0e3;
    color: #000;
    font-weight: 500;
    font-family: sans-serif;
    font-size: 1.5em;
}

a.post-cat-link {
    color: #000;
    text-decoration: none;
}

.post-cat-label {
    display: block;
    text-align: right;
    color: #000;
    font-size: 0.4em;
}

.prev-next-container {
    overflow: auto;
}

.prev-page {
    float: left;
    line-height: 2em;
}

.next-page {
    float: right;
    line-height: 2em;
}

h1, h2, h3, h4, h5, h6 {
    font-family: sans-serif;
    font-weight: bold;
}

.text-hide {
    font: 0/0 a;
    color: transparent;
    text-shadow: none;
    background-color: transparent;
    border: 0;
}

td p {
    margin: 0;
}


</style>
</head>

<body>

<header class="blog-header">

    <div class="no-margin-container banner-bg-image text-hide">
        Site Banner Image
    </div>

    <div class="title-container">
        <a href="https://www.alfray.com/trains/">Ralf's Train Pages</a>
        
        /
        <a href="index.html">Blog: Model Train-related Notes</a>
        
    </div>
</header>

<main role="main">
<div class="main">
<div class="container center-horiz">

<p><span> </span></p>
<p><span></span></p>
<p><span> </span></p>
<p><span style="font-style:italic">Model Train-related Notes Blog -- t</span><span style="font-style:italic">hese are personal notes and musings on the subject of model train control, automation, electronics, or whatever I find interesting. I also have more posts in a blog dedicated to the maintenance of the </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);font-style:italic;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/blog/randall/" style="color:inherit;text-decoration:inherit">Randall Museum Model Railroad</a></span><span style="font-style:italic">.</span></p>
<p><span></span></p>

<div class="prev-next-container">


    <span class="prev-page"></span>
    <span class="next-page"><a href="2025-07-07_new_wazz_web_dashboard.html">Older Post ⇒</a><br/></span>

</div>


    <div class="post-container">
    <div class="post-title-container"><h2 class="post-title">2025-08-23 - Wazz Web Dashboard Update</h2>
    <span class="post-cat" title="Category">
            <span class="post-cat-label">Category</span>
            <span class="post-cat-text">Train</span>
    </span>
    </div>


    <p></p>
<p><span>“</span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/randall/wazz/" style="color:inherit;text-decoration:inherit">Wazz</a></span><span>” is my own web-based dashboard to get an instant overview of the automation at the Randall Museum Model Railroad. </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/blog/train/2025-07-07_new_wazz_web_dashboard.html" style="color:inherit;text-decoration:inherit">Last month, I started revamping the web site</a></span><span>&nbsp;with a more modern implementation, and after about a month of work, I’ve just finished this major rework on the status dashboard with the following architecture:</span></p>
<p></p>
<p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:0.00px solid #000000;display:inline-block;height:196.08px;margin:0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:796.80px"><img alt="" src="img_940d6c4be6094d2d9b07997b3831fb09ac0e2659ed6ad72d94a95f6ea8a39198d.jpg" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p>
<p></p>
<p><span>This now results in a web page giving a dashboard like this: </span></p>
<p></p>
<p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:1.33px solid #b7b7b7;display:inline-block;height:321.50px;margin:0.00px -0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:575.81px"><img alt="" src="img_4b35daa447ac582316576154103a0fb48d7a5d76d9e4cbd341a11902254fff0ci.jpg" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p>
<p></p>
<p><span>This page gives me an overview of which computers are on, wherever the automated lines are active (the “toggles”), and which train ran last, and whether it completed its run properly.</span></p>
<p></p>
<p><span>The major visible part is this new “performance” tab that lets me see how the trains behave on their respective route:</span></p>
<p><span></span></p>
<p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:1.33px solid #b7b7b7;display:inline-block;height:424.50px;margin:0.00px -0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:575.39px"><img alt="" src="img_8e32d6fce9c3cd7728dc819c8f1bf3240f8609a75e517ac64fdff216fe70035bi.jpg" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p>
<p></p>
<p><span>For each block, the automation keeps track of the time the train should spend in that block -- there’s a minimum time, a maximum, and the performance tab shows a color based on the “ideal” time spent in each block:</span></p>
<p></p>
<p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:1.33px solid #b7b7b7;display:inline-block;height:131.04px;margin:-0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:383.90px"><img alt="" src="img_d9b461825c0936afc81b022c0ad829d23e216c0faf809146075ae292e281da1ai.jpg" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p>
<p></p>
<p><span>That allows the automation to detect anomalies as soon as possible. If a train spends too long in a block, that means either the engine has a problem or maybe it derailed and it’s not moving. The minimum timing also detects anomalies -- since the trains move at a very specific speed, they can’t magically cross a block too fast. Since we rely on electrical detection of the train in a block, that’s generally the sign there’s a problem with a sensor or a train that derailed and shorts the track for example, among other possible causes. In any case, the automation program will automatically stop the current train and attempt to do a “recovery” where it runs </span><span style="font-style:italic">another</span><span>&nbsp;program to bring the train back to the station. </span></p>
<p></p>
<p><span>It used to be that I needed to </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/blog/train/2024-10-14_conductor_2_freight_starts_w_ce787171.html" style="color:inherit;text-decoration:inherit">carefully go through the automation logs</a></span><span>&nbsp;to figure issues after the fact. I still expect to do that in specific situations. However, the dashboard “performance” page above should help with the most common cases by directly highlighting where a train has performed out of its expected timing range.</span></p>
<p></p>
<p><span>That said, the web page dashboard is only the tip of the iceberg, and updating the dashboard web site was the easiest part. </span></p>
<p></p>
<p><span>The real magic starts by an update to the </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://github.com/model-railroad/conductor/tree/main/jmri/conductor" style="color:inherit;text-decoration:inherit">Conductor Automation Script Engine</a></span><span>. The script language gets a new </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://github.com/model-railroad/conductor/blob/main/jmri/conductor/engine2k/src/main/kotlin/com/alfray/conductor/v2/script/dsl/IConductor.kt#L99" style="color:inherit;text-decoration:inherit">“dazz event” command</a></span><span>&nbsp;that lets the script register any kind of event to be reported to the dashboard. This is used, for example, to keep track of the automation toggles on the main control panel, and the </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://github.com/model-railroad/conductor/blob/main/jmri/conductor/engine2k/src/main/resources/v2/script/script_v35.01_bl191%2Bml9538%2B1072%2Btl6885.conductor.kts" style="color:inherit;text-decoration:inherit">latest script_v35</a></span><span>&nbsp;uses it as such:</span></p>
<p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:1.33px solid #b7b7b7;display:inline-block;height:139.00px;margin:-0.00px -0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:692.00px"><img alt="" src="img_012fd7bf69498100a79a3fee0ada9e74ef87d243daae6831ccd97213fd038adci.png" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p>
<p></p>
<p><span>This allows the automation script to dictate which events get reported and collected, instead of just hardcoding them in the Conductor program. Right now I only collect when computers turn on and off, and when the automation is started or stopped -- which happens automatically when the museum staff turns the exhibit on and off, but can also be the result of the Saturday Operators manually turning the system on and off.</span></p>
<p></p>
<p><span>The other part of the Conductor script engine is the </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://github.com/model-railroad/conductor/blob/main/jmri/conductor/engine2k/src/main/kotlin/com/alfray/conductor/v2/script/impl/SequenceRoute.kt" style="color:inherit;text-decoration:inherit">SequenceRoute class</a></span><span>. This is the core route management that drives a train through a defined route, and it has been updated to emit route statistics when a train starts and when a train ends its route:</span></p>
<p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:1.33px solid #b7b7b7;display:inline-block;height:272.00px;margin:0.00px -0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:579.00px"><img alt="" src="img_f7e55c69d47a990d5b2a5472f57e5f393d1ff1c45d4bc03a000e319c3434fbd1i.png" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p>
<p></p>
<p><span>That one is a bit more interesting because we have 3 cases:</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>A route starts, e.g. in our case a train is leaving the station. We want to collect an event indicating a train started running. We have its start time only.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>A route ends normally, meaning the train travelled through its entire route as expected -- in our case, the train has returned to its station. In this case, we want to </span><span style="font-style:italic">update</span><span>&nbsp;the same event to indicate the train route has ended; we now have an end time, and we also collect the time spent by the train on every single block that it travelled.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>A route ends with an error, meaning there was an issue and the train never finished its route. We also want to </span><span style="font-style:italic">update</span><span>&nbsp;the event, this time collecting an error indication, as well as the list of all the blocks traveled by the train.</span></li>
</ul>
<p></p>
<p><span>The only other kind of route handled by Conductor are “idle routes”, which denote a train sitting idle e.g. at a station waiting to leave. These don’t have any events associated with them for now.</span></p>
<p></p>
<p><span>Finally, the other interesting part of the work was the piece “in the middle”: we have </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/randall/rtac.html" style="color:inherit;text-decoration:inherit">Conductor</a></span><span>&nbsp;emitting events, and we have a web site that needs to collect event statistics from some place… That’s where </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://github.com/model-railroad/conductor/tree/main/web/DazzServ" style="color:inherit;text-decoration:inherit">DazzServ</a></span><span>&nbsp;comes in, a small server running on the local network and accumulating all these statistics and events, to serve them later to </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://github.com/model-railroad/conductor/tree/main/web/wazz" style="color:inherit;text-decoration:inherit">Wazz</a></span><span>.</span></p>
<p><span>For the </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://github.com/model-railroad/conductor/tree/main/web/DazzServ" style="color:inherit;text-decoration:inherit">Dazz implementation</a></span><span>, I considered a few options. Maybe some cool hype stuff in Rust, or a server framework like Ktor and Netty? After considering a few options for the Dazz implementation, I threw all these choices away and opted for something fairly classic: it’s a simple </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://jetty.org/" style="color:inherit;text-decoration:inherit">Jetty</a></span><span>&nbsp;REST server written in Kotlin, and using </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://gradle.org/" style="color:inherit;text-decoration:inherit">Gradle</a></span><span>, </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://dagger.dev/dev-guide/" style="color:inherit;text-decoration:inherit">Dagger</a></span><span>&nbsp;and JUnit4. The server has a minimalist REST API and JSON payloads. It’s a 100% no-hype implementation, it works well, I’ve used all of these before so I know the APIs well, and it’s rock solid. Low learning curve, and, most importantly, very easy to maintain later. I run it locally on one of the layout’s Linux computers with a simple </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://wiki.debian.org/systemd/Services" style="color:inherit;text-decoration:inherit">Debian systemd service</a></span><span>.</span></p>
<p></p>
<hr>
<p></p>
<p><span></span></p>


    </div>



<div class="prev-next-container">


    <span class="prev-page"></span>
    <span class="next-page"><a href="2025-07-07_new_wazz_web_dashboard.html">Older Post ⇒</a><br/></span>

</div>

</div> <!-- container -->
</div> <!-- main -->

<div class="sharethis-inline-share-buttons"></div>

<div class="bottom-container">&nbsp;Generated on 2025-09-02 by Rig4j 0.1-Exp-05cc7b2&nbsp;</div>

</main>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-M1KDMEFC4D"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-M1KDMEFC4D');
</script>

</body>
</html>

