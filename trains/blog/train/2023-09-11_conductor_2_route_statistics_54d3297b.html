<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport"    content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author"      content="">

<link href="atom.xml" type="application/atom+xml" rel="alternate" title="Atom feed for Blog: Model Train-related Notes" />

<meta property="og:url"         content="https://www.alfray.com/trains/blog/train/2023-09-11_conductor_2_route_statistics_54d3297b.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Conductor 2: Route Statistics with Numbers" />

<meta property="og:description" content="In the latest version of Conductor 2, I’ve added “end-of-route statistics”. I’ve now accumulated enough data to start looking at it." />
<meta property="og:image"       content="https://www.alfray.com/trains/blog/train/img_760b8f575b3446206b3838ffac86549adef764ce20af115f258dec590d943fc8i.png" />

<meta name="twitter:card"        content="summary" />
<!-- meta name="twitter:site"    content="@flickr" / -->
<meta name="twitter:title"       content="Conductor 2: Route Statistics with Numbers" />

<meta name="twitter:description" content="In the latest version of Conductor 2, I’ve added “end-of-route statistics”. I’ve now accumulated enough data to start looking at it." />
<meta name="twitter:image"       content="https://www.alfray.com/trains/blog/train/img_760b8f575b3446206b3838ffac86549adef764ce20af115f258dec590d943fc8i.png" />

<title>Blog: Model Train-related Notes</title>

<script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5c66171070e9220011ed1c61&product=inline-share-buttons" async="async"></script>

<!-- Custom styles for this template -->
<style type="text/css">
body {
    font-family: sans-serif;
    margin: 0;
}

.main {
    margin: 8px;
}

p, span {
    line-height: 1.2;
    text-align: justify;
}

p.console {
    margin: 0;
    padding: 0;
}

.container {
    max-width: 95%;
}

@media screen and (min-width: 600px) {
    .container {
        max-width: 60rem;
    }
}

.center-horiz {
    margin: auto;
}

.no-margin-container {
}

/* Header + Title */
.blog-header {
  margin-bottom: 3rem;
  background-color: #428bca;
  box-shadow: inset 0 -.1rem .25rem rgba(0,0,0,.1);
}


.banner-bg-image {
    height: 50px;
    background-image: url("header.jpg");
    background-position: center;
    background-size: 100% auto;
}

@media screen and (min-width: 600px) {
    .banner-bg-image {
        height: 200px;
    }
}


.title-container {
    color: #fff;
    padding: 1rem;
    line-height: 1.5;
    font-weight: 500;
    font-size: 24px;
    font-family: sans-serif;
}

.title-container a {
    color: #fff;
    text-decoration: none;
}

.post-container {
}

.bottom-container {
    margin-top: 8px;
    color: #fff;
    background-color: #428bca;
    font-family: sans-serif;
    text-align: center;
    font-size: small;
    line-height: 1rem;
}

@media screen and (min-width: 600px) {
    .bottom-container {
        font-size: x-small;
    }
}

.post-title-container {
    position: relative;
    background-color: #428bca;
    padding: 0.5rem;
}

.post-title {
    display: inline;
    color: #fff;
    font-weight: 500;
    font-family: sans-serif;
    font-size: 1.5em;
}

a.post-title-link {
    color: #fff;
    text-decoration: none;
}

.post-cat {
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    padding: 0.25rem;
    background-color: #d0e0e3;
    color: #000;
    font-weight: 500;
    font-family: sans-serif;
    font-size: 1.5em;
}

a.post-cat-link {
    color: #000;
    text-decoration: none;
}

.post-cat-label {
    display: block;
    text-align: right;
    color: #000;
    font-size: 0.4em;
}

.prev-next-container {
    overflow: auto;
}

.prev-page {
    float: left;
    line-height: 2em;
}

.next-page {
    float: right;
    line-height: 2em;
}

h1, h2, h3, h4, h5, h6 {
    font-family: sans-serif;
    font-weight: bold;
}

.text-hide {
    font: 0/0 a;
    color: transparent;
    text-shadow: none;
    background-color: transparent;
    border: 0;
}

td p {
    margin: 0;
}


</style>
</head>

<body>

<header class="blog-header">

    <div class="no-margin-container banner-bg-image text-hide">
        Site Banner Image
    </div>

    <div class="title-container">
        <a href="https://www.alfray.com/trains/">Ralf's Train Pages</a>
        
        /
        <a href="0001.html">Blog: Model Train-related Notes</a>
        
    </div>
</header>

<main role="main">
<div class="main">
<div class="container center-horiz">

<p><span> </span></p>
<p><span></span></p>
<p><span> </span></p>
<p><span style="font-style:italic">Model Train-related Notes Blog -- t</span><span style="font-style:italic">hese are personal notes and musings on the subject of model train control, automation, electronics, or whatever I find interesting. I also have more posts in a blog dedicated to the maintenance of the </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);font-style:italic;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/blog/randall/" style="color:inherit;text-decoration:inherit">Randall Museum Model Railroad</a></span><span style="font-style:italic">.</span></p>
<p><span></span></p>

<div class="prev-next-container">


    <span class="prev-page"><a href="2023-09-18_converting_a_bachmann_spectr_f4f13891.html">⇐ Newer Post</a><br/></span>
    <span class="next-page"><a href="2023-08-23_conductor_2_route_statistics.html">Older Post ⇒</a><br/></span>

</div>


    <div class="post-container">
    <div class="post-title-container"><h2 class="post-title">2023-09-11 - Conductor 2: Route Statistics with Numbers</h2>
    <span class="post-cat" title="Category">
            <span class="post-cat-label">Category</span>
            <span class="post-cat-text">Rtac</span>
    </span>
    </div>


    <p><span></span></p>
<p></p>
<p><span>In the latest version of </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/randall/rtac" style="color:inherit;text-decoration:inherit">Conductor 2</a></span><span>, I’ve </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/blog/train/2023-08-23_conductor_2_route_statistics.html" style="color:inherit;text-decoration:inherit">added “end-of-route statistics”</a></span><span>. I’ve now accumulated enough data to start looking at it.</span></p>
<p></p>
<p><span>First, I needed to parse a JSON log file (a log file with one JSON entry per line per day per run), and I needed a way to convert that to CSV to dump it in a Google Spreadsheet. I briefly considered writing a short python script to do that, then realized that nothing can beat the awesomeness of </span><span style="font-style:italic">sed</span><span>, so I ended up with this:</span></p>
<p></p>
<table style="border-collapse:collapse;border-spacing:0;margin-right:auto">
 <tbody>
  <tr style="height:0pt">
   <td colspan="1" rowspan="1" style="border-bottom-color:rgb(0, 0, 0);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(0, 0, 0);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(0, 0, 0);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(0, 0, 0);border-top-style:solid;border-top-width:1pt;padding:5pt 5pt 5pt 5pt;vertical-align:top;width:597.6pt"><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:9pt;vertical-align:baseline">$ grep '{"name"' conductor-log-2023-09-* | sed -E -n '/Recovery/d; /true/d; s/^[^0-9]+//; s/([0-9-]{10})[^:]+:/\1 /; s/ R Seq[^\{]+/@ /; s/":/" /g; s/[^a-zA-Z0-9@.:-]+/,/g; s/@/,/g; s/,ms,([0-9]{3,})/,\1,ms/g; s/([0-9])([0-9]{3}),ms/\1.\2,ms/g; s/,name,|,th|,act|,err,false,nodes|,n|,ms//g; p' &nbsp;| tee ~/temp/_csv.txt</span></p></td>
  </tr>
 </tbody>
</table>
<p></p>
<p><span>I regret nothing. &lt;insert appropriate meme&gt;</span></p>
<p></p>
<p><span>I shall note that this expression purposely only selects log lines that have no errors, that is, successful runs that have completed with no issue. This will become relevant later.</span></p>
<p></p>
<p><span>Now let’s look at the collected data.</span></p>
<p></p>
<p><span style="font-weight:700">Freight Route</span></p>
<p></p>
<p><span>This is a simple shuttle route over two blocks: we’re moving from block B311 (the </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/randall/about.html#h.1a30ydkpyo99" style="color:inherit;text-decoration:inherit">Stockton Station</a></span><span>) to B321 (the Sonora Station), stopping there, and then back again to B311. The way I wrote the route stats aggregator, I add an index number when a block is repeated, so “B311.1” means “block B311 when leaving”, and “B311.2” means “block B311 when coming back”.</span></p>
<p></p>
<p><span>I have 98 runs for this one, and when we compute the stats we get a very nice result:</span></p>
<p></p>
<p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:0.00px solid #000000;display:inline-block;height:418.67px;margin:0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:796.80px"><img alt="" src="img_760b8f575b3446206b3838ffac86549adef764ce20af115f258dec590d943fc8i.png" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p>
<p><span></span></p>
<p></p>
<p><span>All the times are in seconds, per length of block occupation. It takes about 26 seconds to move to the second block, and we spend a total of about 160 seconds on that block -- and that includes the 30 second paused time at the 2nd station before reversing back.</span></p>
<p></p>
<p><span>As a reminder, one of the major revamps I did in Conductor 2 is to have the ability to define min/max times per block. In this case, I have a min of 10 seconds, and a max of 180 seconds. These are hard limits -- if the trains do not spent at least 10 seconds in a block or spend more than 180 seconds on a block, something’s wrong and the entire route automation stops. </span></p>
<p></p>
<p><span>So that’s good: here we have a good margin. The min time is 25 seconds, well above the 10 seconds limit, and the max time is 164 seconds, well below our max limit.</span></p>
<p></p>
<p><span>It’s all nice looking and smooth and almost boring, so let’s move on.</span></p>
<p></p>
<p><span style="font-weight:700">Passenger Route</span></p>
<p></p>
<p><span>This is the longest route. We’re crossing a good part of the mainline, also in a shuttle (back-and-worth). We’re starting from block B503b (the </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/randall/about.html#h.1a30ydkpyo99" style="color:inherit;text-decoration:inherit">Stockton Station</a></span><span>) up the way to B370 at the top of the mountain, then back down again.</span></p>
<p></p>
<p><span>We have 102 data points, however this time there’s a lot of variation, and a few surprises:</span></p>
<p></p>
<p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:0.00px solid #000000;display:inline-block;height:421.33px;margin:0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:796.80px"><img alt="" src="img_074ce8f422cb0c01f1867d2f322a1127cac46f5086ffe6900bbc6fff55c6108fi.jpg" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p>
<p></p>
<p><span>Clearly, there’s a lot of variability in the duration it takes to cross each block. A few blocks have a variation of 20 seconds between their min and their max -- B360 and B340 have a fairly high standard deviation of almost 6 seconds in their return trip. I’m not sure how I’d explain that, because these are the blocks where the train is going down the mountain.</span></p>
<p></p>
<p><span>I highlighted some cells: some blocks have a minimum time of 10 seconds, or very close to it. B503a notably is really close or strictly equal to 10 seconds in this minimum. </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/blog/randall/2023-09-10_adjusting_the_conductor_2_program.html" style="color:inherit;text-decoration:inherit">This turned out to be a problem</a></span><span>.</span></p>
<p></p>
<p><span>Remember how I said the logs here are filtered to only show successful runs? Well it turns out that for the last 2 days, the automation was stopping for that specific train. Investigation showed that the crossing time for B503a could be as low as 9.5 seconds, yet the block was programmed with a minimum crossing time of 10 seconds. Since the </span><span style="font-style:italic">next</span><span>&nbsp;block was activated too soon, the automation was stopping the train and entering error mode. The fix was to change the minimum time for this block -- I’ve set it to 5 seconds -- that seems safe, there’s no way the train can cross that block that fast. &nbsp;I had also noticed that B504 was fairly close to 10 seconds and adjusted its minimum time accordingly.</span></p>
<p></p>
<p><span>In case it’s not obvious, there’s a rationale behind that “minimum time to cross a block”: it’s designed to detect accidental block occupancy. Let’s say a train is running its route, and the next block suddenly appears occupied… I use electric-current based block detection, and the computer only knows that something is on the block, drawing electricity without really knowing what or why. If a train is running on block A and should logically move to block B next, and then that block B suddenly gets activated, that can only mean 2 things: either the train has successfully crossed from block A to B (that’s good), or </span><span style="font-style:italic">something else</span><span>&nbsp;is suddenly occupying block B, and we should really stop as soon as possible. By default, I set the minimum time to 10 seconds, so if the next block gets activated before 10 seconds, that means either that something is now occupying the block (not good), or the train moved too fast (suspicious), or that my timing is not adequate enough. And here we have an example of the latter. My ballpark conservative figure of “at least 10 seconds on every block” was only </span><span style="font-style:italic">mostly</span><span>&nbsp;right.</span></p>
<p></p>
<p><span>Now, this data here shows me we have a similar potential problem on B340.2, so I should adjust its min time to something appropriate, after I physically measure the crossing time by manually running the engine at various (reasonable) speeds.</span></p>
<p></p>
<p><span style="font-weight:700">Branchline Route</span></p>
<p></p>
<p><span>The branchline is yet another shuttle (back-and-worth). We’re starting from block B801 (aptly named “BL Parked”) up the way to B860 (a.k.a. “BL Reverse”) at the </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/randall/about.html#h.3cdwb8y0iemy" style="color:inherit;text-decoration:inherit">You Bet station</a></span><span>, then back down again.</span></p>
<p></p>
<p><span>I have 190 data points:</span></p>
<p></p>
<p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:0.00px solid #000000;display:inline-block;height:445.33px;margin:0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:796.80px"><img alt="" src="img_0230bbf1d6a24c089fb90a93069d49834c4050e74f5009c0d95b1a9b30a2e395i.jpg" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p>
<p></p>
<p><span>Although there’s a bit of noise, this is a well behaved run, fairly consistent. The timings are well within the enforced ranges (10 seconds min, 120 seconds max), and the standard deviation looks fairly reasonable.</span></p>
<p></p>
<p></p>
<p></p>
<hr>
<p></p>


    </div>



<div class="prev-next-container">


    <span class="prev-page"><a href="2023-09-18_converting_a_bachmann_spectr_f4f13891.html">⇐ Newer Post</a><br/></span>
    <span class="next-page"><a href="2023-08-23_conductor_2_route_statistics.html">Older Post ⇒</a><br/></span>

</div>

</div> <!-- container -->
</div> <!-- main -->

<div class="sharethis-inline-share-buttons"></div>

<div class="bottom-container">&nbsp;Generated on 2025-09-01 by Rig4j 0.1-Exp-0c45755&nbsp;</div>

</main>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-M1KDMEFC4D"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-M1KDMEFC4D');
</script>

</body>
</html>

