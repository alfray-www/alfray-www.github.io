<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport"    content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author"      content="">

<link href="atom.xml" type="application/atom+xml" rel="alternate" title="Atom feed for Blog: Model Train-related Notes" />

<meta property="og:url"         content="https://www.alfray.com/trains/blog/train/2025-03-20_indicator_for_turnout_t330.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Indicator for Turnout T330" />

<meta property="og:description" content="Here’s a new a experiment: we now have a new visual indicator of the position of the Sonora turnout T330, designed to be visible by the Saturday operators when standing at the Stockton Yard:" />
<meta property="og:image"       content="https://www.alfray.com/trains/blog/train/img_3fa2e233e5c3ffc585168fee9c57e5c5ea4ca1ea4e7314043e042be6405549f8d.jpg" />

<meta name="twitter:card"        content="summary" />
<!-- meta name="twitter:site"    content="@flickr" / -->
<meta name="twitter:title"       content="Indicator for Turnout T330" />

<meta name="twitter:description" content="Here’s a new a experiment: we now have a new visual indicator of the position of the Sonora turnout T330, designed to be visible by the Saturday operators when standing at the Stockton Yard:" />
<meta name="twitter:image"       content="https://www.alfray.com/trains/blog/train/img_3fa2e233e5c3ffc585168fee9c57e5c5ea4ca1ea4e7314043e042be6405549f8d.jpg" />

<title>Blog: Model Train-related Notes</title>

<script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5c66171070e9220011ed1c61&product=inline-share-buttons" async="async"></script>

<!-- Custom styles for this template -->
<style type="text/css">
body {
    font-family: sans-serif;
    margin: 0;
}

.main {
    margin: 8px;
}

p, span {
    line-height: 1.2;
    text-align: justify;
}

p.console {
    margin: 0;
    padding: 0;
}

.container {
    max-width: 95%;
}

@media screen and (min-width: 600px) {
    .container {
        max-width: 60rem;
    }
}

.center-horiz {
    margin: auto;
}

.no-margin-container {
}

/* Header + Title */
.blog-header {
  margin-bottom: 3rem;
  background-color: #428bca;
  box-shadow: inset 0 -.1rem .25rem rgba(0,0,0,.1);
}


.banner-bg-image {
    height: 50px;
    background-image: url("header.jpg");
    background-position: center;
    background-size: 100% auto;
}

@media screen and (min-width: 600px) {
    .banner-bg-image {
        height: 200px;
    }
}


.title-container {
    color: #fff;
    padding: 1rem;
    line-height: 1.5;
    font-weight: 500;
    font-size: 24px;
    font-family: sans-serif;
}

.title-container a {
    color: #fff;
    text-decoration: none;
}

.post-container {
}

.bottom-container {
    margin-top: 8px;
    color: #fff;
    background-color: #428bca;
    font-family: sans-serif;
    text-align: center;
    font-size: small;
    line-height: 1rem;
}

@media screen and (min-width: 600px) {
    .bottom-container {
        font-size: x-small;
    }
}

.post-title-container {
    position: relative;
    background-color: #428bca;
    padding: 0.5rem;
}

.post-title {
    display: inline;
    color: #fff;
    font-weight: 500;
    font-family: sans-serif;
    font-size: 1.5em;
}

a.post-title-link {
    color: #fff;
    text-decoration: none;
}

.post-cat {
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    padding: 0.25rem;
    background-color: #d0e0e3;
    color: #000;
    font-weight: 500;
    font-family: sans-serif;
    font-size: 1.5em;
}

a.post-cat-link {
    color: #000;
    text-decoration: none;
}

.post-cat-label {
    display: block;
    text-align: right;
    color: #000;
    font-size: 0.4em;
}

.prev-next-container {
    overflow: auto;
}

.prev-page {
    float: left;
    line-height: 2em;
}

.next-page {
    float: right;
    line-height: 2em;
}

h1, h2, h3, h4, h5, h6 {
    font-family: sans-serif;
    font-weight: bold;
}

.text-hide {
    font: 0/0 a;
    color: transparent;
    text-shadow: none;
    background-color: transparent;
    border: 0;
}

td p {
    margin: 0;
}


</style>
</head>

<body>

<header class="blog-header">

    <div class="no-margin-container banner-bg-image text-hide">
        Site Banner Image
    </div>

    <div class="title-container">
        <a href="https://www.alfray.com/trains/">Ralf's Train Pages</a>
        
        /
        <a href="index.html">Blog: Model Train-related Notes</a>
        
    </div>
</header>

<main role="main">
<div class="main">
<div class="container center-horiz">

<p><span> </span></p>
<p><span></span></p>
<p><span> </span></p>
<table style="border-collapse:collapse;border-spacing:0;margin-left:auto;margin-right:auto">
 <tbody>
  <tr style="height:0pt">
   <td colspan="1" rowspan="1" style="background-color:rgb(103, 78, 167);border-bottom-color:rgb(255, 255, 255);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(255, 255, 255);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(255, 255, 255);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(255, 255, 255);border-top-style:solid;border-top-width:1pt;padding:7.2pt 7.2pt 7.2pt 7.2pt;vertical-align:top;width:149.4pt"><p style="text-align:center"><span style="-webkit-text-decoration-skip:none;color:rgb(255, 217, 102);font-size:14pt;font-weight:700;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/" style="color:inherit;text-decoration:inherit">Train Pages</a></span></p></td>
   <td colspan="1" rowspan="1" style="background-color:rgb(103, 78, 167);border-bottom-color:rgb(255, 255, 255);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(255, 255, 255);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(255, 255, 255);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(255, 255, 255);border-top-style:solid;border-top-width:1pt;padding:7.2pt 7.2pt 7.2pt 7.2pt;vertical-align:top;width:149.4pt"><p style="text-align:center"><span style="-webkit-text-decoration-skip:none;color:rgb(255, 217, 102);font-size:14pt;font-weight:700;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/blog/train/" style="color:inherit;text-decoration:inherit">Tech Blog</a></span></p></td>
   <td colspan="1" rowspan="1" style="background-color:rgb(103, 78, 167);border-bottom-color:rgb(255, 255, 255);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(255, 255, 255);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(255, 255, 255);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(255, 255, 255);border-top-style:solid;border-top-width:1pt;padding:7.2pt 7.2pt 7.2pt 7.2pt;vertical-align:top;width:149.4pt"><p style="text-align:center"><span style="-webkit-text-decoration-skip:none;color:rgb(255, 217, 102);font-size:14pt;font-weight:700;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/randall/rtac.html" style="color:inherit;text-decoration:inherit">RTAC Software</a></span></p></td>
   <td colspan="1" rowspan="1" style="background-color:rgb(103, 78, 167);border-bottom-color:rgb(255, 255, 255);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(255, 255, 255);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(255, 255, 255);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(255, 255, 255);border-top-style:solid;border-top-width:1pt;padding:7.2pt 7.2pt 7.2pt 7.2pt;vertical-align:top;width:149.4pt"><p style="text-align:center"><span style="-webkit-text-decoration-skip:none;color:rgb(255, 217, 102);font-size:14pt;font-weight:700;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.youtube.com/c/raphaelmoll" style="color:inherit;text-decoration:inherit">Videos</a></span></p></td>
  </tr>
 </tbody>
</table>
<p></p>
<p><span style="font-style:italic">Model Train-related Notes Blog -- t</span><span style="font-style:italic">hese are personal notes and musings on the subject of model train control, automation, electronics, or whatever I find interesting. I also have more posts in a blog dedicated to the maintenance of the </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);font-style:italic;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/blog/randall/" style="color:inherit;text-decoration:inherit">Randall Museum Model Railroad</a></span><span style="font-style:italic">.</span></p>
<p><span></span></p>

<div class="prev-next-container">


    <span class="prev-page"><a href="2025-03-26_distant_signal_matrix_displa_08700264.html">⇐ Newer Post</a><br/></span>
    <span class="next-page"><a href="2025-01-16_conductor_2_email_notificati_0ac70a31.html">Older Post ⇒</a><br/></span>

</div>


    <div class="post-container">
    <div class="post-title-container"><h2 class="post-title">2025-03-20 - Indicator for Turnout T330</h2>
    <span class="post-cat" title="Category">
            <span class="post-cat-label">Category</span>
            <span class="post-cat-text">Arduino</span>
    </span>
    </div>


    <p><span></span></p>
<p></p>
<p><span>Here’s a new a experiment: we now have a new visual indicator of the position of the Sonora turnout T330, designed to be visible by the Saturday operators when standing at the Stockton Yard:</span></p>
<p></p>
<p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:0.00px solid #000000;display:inline-block;height:469.79px;margin:0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:796.80px"><img alt="" src="img_3fa2e233e5c3ffc585168fee9c57e5c5ea4ca1ea4e7314043e042be6405549f8d.jpg" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p>
<p></p>
<p><span>Sonora has the two mainline tracks that merge together at turnout T330, and there’s a signal bridge with signals that clearly indicate the position of the turnout. The problem is that the signal bridge is not visible from across the layout, where the operators are typically standing.</span></p>
<p></p>
<p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:0.00px solid #000000;display:inline-block;height:342.59px;margin:0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:624.00px"><img alt="" src="img_cf53c7f85304da11ad968321df649438f5918f6b3e4274aa6a5ab903e1b84b8fd.jpg" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p>
<p></p>
<p><span>Thus this new experimental signal is located on the pillar -- it’s facing the operators, and it’s high behind the window, hopefully high enough to be visible even when the public is present in front of the layout.</span></p>
<p></p>
<p><span>I kept the new signal as simple as possible: green indicates the turnout is aligned straight for the “inner” track (block B320) and red indicates it is thrown for the “outer track” (block B321). Behind the signal, I placed a short explanation to hopefully make it clear what the color represents:</span></p>
<p></p>
<table style="border-collapse:collapse;border-spacing:0;margin-left:auto;margin-right:auto">
 <tbody>
  <tr style="height:0pt">
   <td colspan="1" rowspan="1" style="border-bottom-color:rgb(0, 0, 0);border-bottom-style:solid;border-bottom-width:0pt;border-left-color:rgb(0, 0, 0);border-left-style:solid;border-left-width:0pt;border-right-color:rgb(0, 0, 0);border-right-style:solid;border-right-width:0pt;border-top-color:rgb(0, 0, 0);border-top-style:solid;border-top-width:0pt;vertical-align:middle;width:298.8pt"><p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:0.00px solid #000000;display:inline-block;height:240.00px;margin:0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:396.00px"><img alt="" src="img_79c196b7dca280b7ae02da40991a05ea9b6277925a3ce5c5dc6dd6b2bf253bbdi.jpg" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p></td>
   <td colspan="1" rowspan="1" style="border-bottom-color:rgb(0, 0, 0);border-bottom-style:solid;border-bottom-width:0pt;border-left-color:rgb(0, 0, 0);border-left-style:solid;border-left-width:0pt;border-right-color:rgb(0, 0, 0);border-right-style:solid;border-right-width:0pt;border-top-color:rgb(0, 0, 0);border-top-style:solid;border-top-width:0pt;vertical-align:middle;width:298.8pt"><p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:0.00px solid #000000;display:inline-block;height:241.33px;margin:0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:396.00px"><img alt="" src="img_163ba01bbabb938139972baf366c147804433809fb50f4d23b56071485fd427ai.jpg" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p></td>
  </tr>
 </tbody>
</table>
<p><span></span></p>
<p><span>Originally I was going to design this using a pure “analog” solution by plugging two LEDs (green and red) to the output of the auxiliary contacts of the turnout switch machine, like the existing signal bridge does. That turned out to be a bit more complicated than I wanted as it would likely interfere with the existing signal bridge.</span></p>
<p></p>
<p><span>And then I realized I could actually "simplify" and reuse stuff I already have -- I came up with a clever trick, namely in this case the signal LED is the onboard LED of an ESP32 using the exact same software as </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/blog/randall/2024-12-16_ambiance.html" style="color:inherit;text-decoration:inherit">Ambiance, my animated LED strip display along the fascia of the layout</a></span><span>!</span></p>
<p></p>
<p><span>And the second part of the trick is that it’s really the automation script that drives the color of the LED:</span></p>
<p></p>
<p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:0.00px solid #000000;display:inline-block;height:206.67px;margin:0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:796.80px"><img alt="" src="img_020841ff91ce469a3a21220b4bde96b94e49219eec4084eaa7dec1c551819d77d.jpg" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p>
<p></p>
<p><span>That’s a lot easier than hooking up to the auxiliary contacts of the turnout switch machine, mainly because it’s reusing all the components I </span><span style="font-style:italic">already</span><span>&nbsp;have in place on the layout for the automation, so there was actually not a lot of work to do when doing it this way!</span></p>
<p></p>
<p><span>I started by modifying the </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://github.com/model-railroad/ambiance" style="color:inherit;text-decoration:inherit">Ambiance software</a></span><span>&nbsp;to be easier to customize its setup: in the </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://github.com/model-railroad/ambiance/blob/main/setup/settings.toml" style="color:inherit;text-decoration:inherit">CircuitPython settings.toml file</a></span><span>, I can now configure the length of the LED strip, its data control pin on the ESP32, and the name of the MQTT topic to control it. In this case, I simply have a LED strip of… 1 LED. That’s the trick! Once I do that, it’s basically the same thing as the animated LED strip display. </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://github.com/model-railroad/ambiance" style="color:inherit;text-decoration:inherit">Ambiance</a></span><span>&nbsp;is really event-oriented, thus here I just create events that “animate” the “one LED” with what is essentially a static color that just stays the same until changed.</span></p>
<p></p>
<p><span>Once I’ve done that, I can simply </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://github.com/model-railroad/conductor/blob/HEAD/jmri/conductor/engine2k/src/main/resources/v2/script/script_v33.03_bl010%2Bml9538%2B1072%2Btl6885.conductor.kts#L161" style="color:inherit;text-decoration:inherit">program the automation script in Conductor 2</a></span><span>&nbsp;to monitor the state of the turnout T330, and publish a color change to the “1 LED strip” via MQTT:</span></p>
<p></p>
<p style="background-color:rgb(0, 0, 0);text-align:left"><span style="color:rgb(0, 255, 0);font-family:&quot;Courier New&quot;;font-size:10.5pt;font-style:italic;font-weight:700">// The T330 LED is GREEN when the junction B320 --&gt; B330 via T330 Normal is ready.<br></span><span style="color:rgb(255, 255, 255);font-family:&quot;Courier New&quot;;font-size:10.5pt">on </span><span style="color:rgb(255, 249, 0);font-family:&quot;Courier New&quot;;font-size:10.5pt;font-weight:700">{ &nbsp;</span><span style="color:rgb(255, 255, 255);font-family:&quot;Courier New&quot;;font-size:10.5pt">T330</span><span style="color:rgb(255, 249, 0);font-family:&quot;Courier New&quot;;font-size:10.5pt;font-weight:700">.</span><span style="color:rgb(255, 255, 255);font-family:&quot;Courier New&quot;;font-size:10.5pt">normal </span><span style="color:rgb(255, 249, 0);font-family:&quot;Courier New&quot;;font-size:10.5pt;font-weight:700">} </span><span style="color:rgb(255, 255, 255);font-family:&quot;Courier New&quot;;font-size:10.5pt">then </span><span style="color:rgb(255, 249, 0);font-family:&quot;Courier New&quot;;font-size:10.5pt;font-weight:700">{<br> &nbsp; </span><span style="color:rgb(255, 255, 255);font-family:&quot;Courier New&quot;;font-size:10.5pt">mqtt</span><span style="color:rgb(255, 249, 0);font-family:&quot;Courier New&quot;;font-size:10.5pt;font-weight:700">.</span><span style="color:rgb(255, 255, 255);font-family:&quot;Courier New&quot;;font-size:10.5pt">publish</span><span style="color:rgb(255, 249, 0);font-family:&quot;Courier New&quot;;font-size:10.5pt;font-weight:700">(</span><span style="color:rgb(255, 0, 255);font-family:&quot;Courier New&quot;;font-size:10.5pt;font-weight:700">"turnout/t330/script/event"</span><span style="color:rgb(255, 249, 0);font-family:&quot;Courier New&quot;;font-size:10.5pt;font-weight:700">, </span><span style="color:rgb(255, 0, 255);font-family:&quot;Courier New&quot;;font-size:10.5pt;font-weight:700">"Brightness 0.75; Fill #00FF00 1; Trigger"</span><span style="color:rgb(255, 249, 0);font-family:&quot;Courier New&quot;;font-size:10.5pt;font-weight:700">)<br>}<br></span><span style="color:rgb(255, 255, 255);font-family:&quot;Courier New&quot;;font-size:10.5pt">on </span><span style="color:rgb(255, 249, 0);font-family:&quot;Courier New&quot;;font-size:10.5pt;font-weight:700">{ !</span><span style="color:rgb(255, 255, 255);font-family:&quot;Courier New&quot;;font-size:10.5pt">T330</span><span style="color:rgb(255, 249, 0);font-family:&quot;Courier New&quot;;font-size:10.5pt;font-weight:700">.</span><span style="color:rgb(255, 255, 255);font-family:&quot;Courier New&quot;;font-size:10.5pt">normal </span><span style="color:rgb(255, 249, 0);font-family:&quot;Courier New&quot;;font-size:10.5pt;font-weight:700">} </span><span style="color:rgb(255, 255, 255);font-family:&quot;Courier New&quot;;font-size:10.5pt">then </span><span style="color:rgb(255, 249, 0);font-family:&quot;Courier New&quot;;font-size:10.5pt;font-weight:700">{<br> &nbsp; </span><span style="color:rgb(255, 255, 255);font-family:&quot;Courier New&quot;;font-size:10.5pt">mqtt</span><span style="color:rgb(255, 249, 0);font-family:&quot;Courier New&quot;;font-size:10.5pt;font-weight:700">.</span><span style="color:rgb(255, 255, 255);font-family:&quot;Courier New&quot;;font-size:10.5pt">publish</span><span style="color:rgb(255, 249, 0);font-family:&quot;Courier New&quot;;font-size:10.5pt;font-weight:700">(</span><span style="color:rgb(255, 0, 255);font-family:&quot;Courier New&quot;;font-size:10.5pt;font-weight:700">"turnout/t330/script/event"</span><span style="color:rgb(255, 249, 0);font-family:&quot;Courier New&quot;;font-size:10.5pt;font-weight:700">, </span><span style="color:rgb(255, 0, 255);font-family:&quot;Courier New&quot;;font-size:10.5pt;font-weight:700">"Brightness 0.75; Fill #FF0000 1; Trigger"</span><span style="color:rgb(255, 249, 0);font-family:&quot;Courier New&quot;;font-size:10.5pt;font-weight:700">)<br>}</span></p>
<p></p>
<p><span>It’s that simple!</span></p>
<p></p>
<p><span>The neat side effect of doing it that way is that the signal light responds to turnout changes done both by the automation but also when operators manually use the NCE controller to throw T330. Both actions will change the state in JMRI, which will change the state in Conductor, which will change the state in MQTT, which will change the state on the ESP32 😛</span></p>
<p></p>
<hr>
<p></p>


    </div>



<div class="prev-next-container">


    <span class="prev-page"><a href="2025-03-26_distant_signal_matrix_displa_08700264.html">⇐ Newer Post</a><br/></span>
    <span class="next-page"><a href="2025-01-16_conductor_2_email_notificati_0ac70a31.html">Older Post ⇒</a><br/></span>

</div>

</div> <!-- container -->
</div> <!-- main -->

<div class="sharethis-inline-share-buttons"></div>

<div class="bottom-container">&nbsp;Generated on 2025-09-04 by Rig4j 0.1-Exp-05cc7b2&nbsp;</div>

</main>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-M1KDMEFC4D"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-M1KDMEFC4D');
</script>

</body>
</html>

