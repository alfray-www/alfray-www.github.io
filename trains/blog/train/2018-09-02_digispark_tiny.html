<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport"    content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author"      content="">

<link href="atom.xml" type="application/atom+xml" rel="alternate" title="Atom feed for Blog: Model Train-related Notes" />

<meta property="og:url"         content="https://www.alfray.com/trains/blog/train/2018-09-02_digispark_tiny.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Digispark Tiny" />

<meta property="og:description" content="The Digispark Tiny is probably the most basic and compact Arduino-like I’ve worked with. It’s about the size of an USB A plug. It is powered by an ATTiny85 and offers 1-5 I/Os depending on usage (typically 2-3)." />
<meta property="og:image"       content="https://www.alfray.com/trains/blog/train/img_c10803a1d56aa2209b2af52a2170c662aef4d78da0df32d3b018a7a6ef5a9af3i.jpg" />

<meta name="twitter:card"        content="summary" />
<!-- meta name="twitter:site"    content="@flickr" / -->
<meta name="twitter:title"       content="Digispark Tiny" />

<meta name="twitter:description" content="The Digispark Tiny is probably the most basic and compact Arduino-like I’ve worked with. It’s about the size of an USB A plug. It is powered by an ATTiny85 and offers 1-5 I/Os depending on usage (typically 2-3)." />
<meta name="twitter:image"       content="https://www.alfray.com/trains/blog/train/img_c10803a1d56aa2209b2af52a2170c662aef4d78da0df32d3b018a7a6ef5a9af3i.jpg" />

<title>Blog: Model Train-related Notes</title>

<script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5c66171070e9220011ed1c61&product=inline-share-buttons" async="async"></script>

<!-- Custom styles for this template -->
<style type="text/css">
body {
    font-family: sans-serif;
    margin: 0;
}

.main {
    margin: 8px;
}

p, span {
    line-height: 1.2;
    text-align: justify;
}

p.console {
    margin: 0;
    padding: 0;
}

.container {
    max-width: 95%;
}

@media screen and (min-width: 600px) {
    .container {
        max-width: 60rem;
    }
}

.center-horiz {
    margin: auto;
}

.no-margin-container {
}

/* Header + Title */
.blog-header {
  margin-bottom: 3rem;
  background-color: #428bca;
  box-shadow: inset 0 -.1rem .25rem rgba(0,0,0,.1);
}


.banner-bg-image {
    height: 50px;
    background-image: url("header.jpg");
    background-position: center;
    background-size: 100% auto;
}

@media screen and (min-width: 600px) {
    .banner-bg-image {
        height: 200px;
    }
}


.title-container {
    color: #fff;
    padding: 1rem;
    line-height: 1.5;
    font-weight: 500;
    font-size: 24px;
    font-family: sans-serif;
}

.title-container a {
    color: #fff;
    text-decoration: none;
}

.post-container {
}

.bottom-container {
    margin-top: 8px;
    color: #fff;
    background-color: #428bca;
    font-family: sans-serif;
    text-align: center;
    font-size: small;
    line-height: 1rem;
}

@media screen and (min-width: 600px) {
    .bottom-container {
        font-size: x-small;
    }
}

.post-title-container {
    position: relative;
    background-color: #428bca;
    padding: 0.5rem;
}

.post-title {
    display: inline;
    color: #fff;
    font-weight: 500;
    font-family: sans-serif;
    font-size: 1.5em;
}

a.post-title-link {
    color: #fff;
    text-decoration: none;
}

.post-cat {
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    padding: 0.25rem;
    background-color: #d0e0e3;
    color: #000;
    font-weight: 500;
    font-family: sans-serif;
    font-size: 1.5em;
}

a.post-cat-link {
    color: #000;
    text-decoration: none;
}

.post-cat-label {
    display: block;
    text-align: right;
    color: #000;
    font-size: 0.4em;
}

.prev-next-container {
    overflow: auto;
}

.prev-page {
    float: left;
    line-height: 2em;
}

.next-page {
    float: right;
    line-height: 2em;
}

h1, h2, h3, h4, h5, h6 {
    font-family: sans-serif;
    font-weight: bold;
}

.text-hide {
    font: 0/0 a;
    color: transparent;
    text-shadow: none;
    background-color: transparent;
    border: 0;
}

td p {
    margin: 0;
}


</style>
</head>

<body>

<header class="blog-header">

    <div class="no-margin-container banner-bg-image text-hide">
        Site Banner Image
    </div>

    <div class="title-container">
        <a href="https://www.alfray.com/trains/">Ralf's Train Pages</a>
        
        /
        <a href="0007.html">Blog: Model Train-related Notes</a>
        
    </div>
</header>

<main role="main">
<div class="main">
<div class="container center-horiz">

<p><span> </span></p>
<p><span></span></p>
<p><span> </span></p>
<p><span style="font-style:italic">Model Train-related Notes Blog -- t</span><span style="font-style:italic">hese are personal notes and musings on the subject of model train control, automation, electronics, or whatever I find interesting. I also have more posts in a blog dedicated to the maintenance of the </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);font-style:italic;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/blog/randall/" style="color:inherit;text-decoration:inherit">Randall Museum Model Railroad</a></span><span style="font-style:italic">.</span></p>
<p><span></span></p>

<div class="prev-next-container">


    <span class="prev-page"><a href="2018-09-15_nce_aiu01_and_motion_sensor.html">⇐ Newer Post</a><br/></span>
    <span class="next-page"><a href="2018-09-01_conductor_1_and_e-stop.html">Older Post ⇒</a><br/></span>

</div>


    <div class="post-container">
    <div class="post-title-container"><h2 class="post-title">2018-09-02 - Digispark Tiny</h2>
    <span class="post-cat" title="Category">
            <span class="post-cat-label">Category</span>
            <span class="post-cat-text">Arduino</span>
    </span>
    </div>


    <p><span></span></p>
<p></p>
<p><span>The Digispark Tiny is probably the most basic and compact Arduino-like I’ve worked with. It’s about the size of an USB A plug. It is powered by an ATTiny85 and offers 1-5 I/Os depending on usage (typically 2-3).</span></p>
<p></p>
<p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:0.00px solid #000000;display:inline-block;height:191.00px;margin:0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:263.00px"><img alt="" src="img_c10803a1d56aa2209b2af52a2170c662aef4d78da0df32d3b018a7a6ef5a9af3i.jpg" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p>
<p style="text-align:center"><span style="font-size:9pt">(image source: mister-bidouilles.fr)</span></p>
<p><span>Kickstarter Date: 2014.</span></p>
<p></p>
<p><span>Example of the Digispark Tiny connected to an USB OTG with a PIR sensor:</span></p>
<p></p>
<p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:0.00px solid #000000;display:inline-block;height:303.00px;margin:0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:777.00px"><img alt="" src="img_dcb2b5c80735f6aa2b8f323917b7727cb659d5f55b96eba4fa9b2cf93bcc69d4i.jpg" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p>
<p></p>
<p></p>
<p><span></span></p>
<p><span>The Digispark Tiny is made by </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="http://digistump.com/" style="color:inherit;text-decoration:inherit">Digistump</a></span><span>. That was the first mini Arduino made by this manufacturer and the actual product name is just “Digispark”. Since there has been other versions after (Digispark Pro, Digispark Oak), I call the first one “Digispark Tiny” to differentiate it.</span></p>
<p></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>Manufacturer: </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="http://digistump.com/" style="color:inherit;text-decoration:inherit">Digistump</a></span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>Wiki link: </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="http://digistump.com/wiki/digispark" style="color:inherit;text-decoration:inherit">http://digistump.com/wiki/digispark</a></span></li>
</ul>
<p></p>
<p><span>I don’t think it’s being sold or even manufactured anymore (there are some lingering on eBay or Amazon). It used to cost $10 a piece, which back in 2014 was a good price for this. For half that price Digistump now offers the next version, the </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="http://digistump.com/products/109" style="color:inherit;text-decoration:inherit">Digispark Pro</a></span><span>&nbsp;(it’s really $5 in packs of 10, or $10 for one),</span><span>&nbsp;which has more I/Os, and drastically less limitations.</span></p>
<p></p>
<p><span>The DigiSpark Tiny (as well as the Pro) are not pure-Arduino compatible. I call them “Arduiino-like” instead. Digistump used to provide a custom version of the Arduino IDE with a specific toolchain for the Digispark. These days the regular Arduino IDE can be used and the custom tool chain added to it using the Board Manager. The other specific detail is that the serial port does not work like a regular Arduino serial port.</span></p>
<p></p>
<p><span>To use this Arduino, the older Arduino IDE 1.6.5 is needed (not the newer ones); there are instructions on the wiki to setup the AVR Board in the Board Manager: </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="http://digistump.com/wiki/digispark/tutorials/connecting" style="color:inherit;text-decoration:inherit">http://digistump.com/wiki/digispark/tutorials/connecting</a></span><span>&nbsp;</span></p>
<p></p>
<p><span>Following are my usage notes, just my shorthand for info gathered from the forums &amp; wiki so always refer to these when not sure about specs.</span></p>
<p></p>
<p><span>DigiSpark Tiny Pin Guide: </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="http://digistump.com/wiki/digispark/tutorials/pinguide" style="color:inherit;text-decoration:inherit">http://digistump.com/wiki/digispark/tutorials/pinguide</a></span></p>
<p></p>
<p><span>Pins summary:</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>P0 = AREF, I2C SDA, DI (or D1?), PWM.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>P1 = D0 , PWM, Led on Rev2.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>P2 = D/A, I2C SCK, ADC1.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>P3 = D/A USB+, ADC3, &nbsp;(1.5 kΩ pull up).</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>P4 = PWM, D/A, USB-, ADC2.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>P5 = D/A, ADC0 -- says it's 3V at high instead of 5V, use for non-current application.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>VIN pin takes 7-12V and can output 500ma (but over 100-200ma or over 6V might need some heat sinking).</span></li>
</ul>
<p></p>
<p><span>Notes:</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>P0 is safe to use for digital I/O, 5V.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>P1 is connected to the LED.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>P2 is safe to use for digital I/O or Analog input (ADC1), 5V.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>P3 &amp; P4 are used for software USB. Can’t use them and USB at the same time. They have 3.6 V zener diodes. P3 has a pull up.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>P5 is 3V max with “limited” current application.</span></li>
</ul>
<p></p>
<p><span>The really nice thing about the Digispark is that I’d just plug it in a regular sized USB A connector, and this has a great advantage: I can plug it on any Android device using any USB OTG adapter, and read from it via the USB interface.</span></p>
<p></p>
<p><span>Contrary to traditional Arduinos, the Digispark Tiny does not provide a real serial port over USB. USB handling is done in software and basically uses a hack by exchanging characters using USB control messages. There’s a small C binary provided to read it from the host side, and I have reverse-worked how to use that on Android.</span></p>
<p></p>
<p style="text-align:left"><span>I wrote a post on the Digistump Forum explaining how to read the USB “serial port” from Android: </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://digistump.com/board/index.php?topic=1675.0" style="color:inherit;text-decoration:inherit">https://digistump.com/board/index.php?topic=1675.0</a></span></p>
<p></p>
<h2 id="h.d0f22oz56b9q" style="line-height:1.14;padding-bottom:6pt;padding-top:4pt;page-break-after:avoid"><span style="font-size:16pt">Example 1: Reading a potentiometer</span></h2>
<p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:0.00px solid #000000;display:inline-block;height:298.70px;margin:0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:527.50px"><img alt="" src="img_d02aeb6c98ea1ede2a9a9025e89d8696bfaf012385fa5d22e0c65899981a114cd.jpg" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p>
<p></p>
<p></p>
<p><span>To use with a Tiny: variable resistor is powered between GND and 5V. The analog input P2 is used (aka ADC1). The Arduino API by default samples with a 10-bit value (1024). R2 would be something like 10 kΩ (5V / 10 kΩ ⇒ 0.5 mA). R1 can be omitted unless you want some kind of offset.</span></p>
<p></p>
<p><span>In the Arduino sketch, I made a micro serial protocol: Android device sends a “r” character to read the value, which comes back as a decimal number. Android device can also send a “b” character to make the on-board LED blink. Then an Android AsyncTask runs this in a loop, blinking the LED each time a value is read.</span></p>
<p></p>
<p><span>Arduino sketch:</span></p>
<p></p>
<p style="text-align:left"><span></span></p>
<table style="border-collapse:collapse;border-spacing:0;margin-right:auto">
 <tbody>
  <tr style="height:0pt">
   <td colspan="1" rowspan="1" style="background-color:rgb(255, 255, 255);border-bottom-color:rgb(0, 0, 0);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(0, 0, 0);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(0, 0, 0);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(0, 0, 0);border-top-style:solid;border-top-width:1pt;padding:5pt 5pt 5pt 5pt;vertical-align:top;width:597.6pt"><p style="text-align:left" class="console "><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">#define USB_CFG_DEVICE_NAME &nbsp; &nbsp; 'D','i','g','i','T','h','r','o','t'</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt"><br></span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">#define USB_CFG_DEVICE_NAME_LEN 9</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt"><br></span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">#include &lt;DigiUSB.h&gt;</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt"><br><br></span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">#define LED &nbsp; &nbsp; 1 &nbsp; &nbsp;</span><span style="color:rgb(0, 106, 0);font-family:&quot;Consolas&quot;;font-size:10pt">// on-board led on digital pin 1</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt"><br></span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">#define ADC1 &nbsp; &nbsp;1 &nbsp; &nbsp;</span><span style="color:rgb(0, 106, 0);font-family:&quot;Consolas&quot;;font-size:10pt">// ADC channel 1</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt"><br></span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">#define ADC1_P2 2 &nbsp; &nbsp;</span><span style="color:rgb(0, 106, 0);font-family:&quot;Consolas&quot;;font-size:10pt">// ADC1 is connected to digital pin 2</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt"><br><br></span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">byte</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;in = </span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">0</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">;<br></span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">int</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;value = </span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">0</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">; &nbsp;</span><span style="color:rgb(0, 106, 0);font-family:&quot;Consolas&quot;;font-size:10pt">// ADC value is 10-bits</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt"><br></span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">char</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;buf[</span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">12</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">]; &nbsp; </span><span style="color:rgb(0, 106, 0);font-family:&quot;Consolas&quot;;font-size:10pt">// "-2147483648\0" = 12 characters.</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt"><br><br></span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">void</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">setup</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">() {<br> &nbsp;DigiUSB.</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">begin</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">();<br> &nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">pinMode</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">(LED, &nbsp; &nbsp; </span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">OUTPUT</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">);<br> &nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">pinMode</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">(ADC1_P2, </span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">INPUT</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">);<br> &nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">blink</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">();<br> &nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">digitalWrite</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">(LED, </span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">LOW</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">);<br>}<br><br></span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">void</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">blink</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">() {<br> &nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">digitalWrite</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">(LED, </span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">LOW</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">);<br> &nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">delay</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">(</span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">50</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;</span><span style="color:rgb(0, 106, 0);font-family:&quot;Consolas&quot;;font-size:10pt">/*ms*/</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">);<br> &nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">digitalWrite</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">(LED, </span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">HIGH</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">);<br> &nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">delay</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">(</span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">200</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;</span><span style="color:rgb(0, 106, 0);font-family:&quot;Consolas&quot;;font-size:10pt">/*ms*/</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">);<br> &nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">digitalWrite</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">(LED, </span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">LOW</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">);<br>}<br><br></span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">void</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">loop</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">() {<br> &nbsp;DigiUSB.refresh();<br> &nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">if</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;(DigiUSB.</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">available</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">() &gt; </span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">0</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">) {<br> &nbsp; &nbsp;in = DigiUSB.</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">read</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">();<br> &nbsp; &nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">if</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;(in == </span><span style="color:rgb(196, 26, 22);font-family:&quot;Consolas&quot;;font-size:10pt">'r'</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">) {<br> &nbsp; &nbsp; &nbsp;</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">readAdc</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">();<br> &nbsp; &nbsp;} </span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">else</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">if</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;(in == </span><span style="color:rgb(196, 26, 22);font-family:&quot;Consolas&quot;;font-size:10pt">'b'</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">) {<br> &nbsp; &nbsp; &nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">blink</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">();<br> &nbsp; &nbsp;}<br> &nbsp;}<br>}<br><br></span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">void</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">readAdc</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">() {<br> &nbsp;</span><span style="color:rgb(0, 106, 0);font-family:&quot;Consolas&quot;;font-size:10pt">// Read 10-bit ADC value and output to usb</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt"><br> &nbsp;</span><span style="color:rgb(0, 106, 0);font-family:&quot;Consolas&quot;;font-size:10pt">// Take average of 4 reads</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt"><br> &nbsp;</span><span style="color:rgb(0, 106, 0);font-family:&quot;Consolas&quot;;font-size:10pt">// 10-bits = 1024.</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt"><br> &nbsp;value &nbsp;= </span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">analogRead</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">(ADC1);<br> &nbsp;value += </span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">analogRead</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">(ADC1);<br> &nbsp;value += </span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">analogRead</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">(ADC1);<br> &nbsp;value += </span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">analogRead</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">(ADC1);<br> &nbsp;value /= </span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">4</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">;<br> &nbsp;buf[</span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">5</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">] = </span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">0</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">;<br> &nbsp;buf[</span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">4</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">] = </span><span style="color:rgb(196, 26, 22);font-family:&quot;Consolas&quot;;font-size:10pt">'0'</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">+ (value % </span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">10</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">); &nbsp; &nbsp;</span><span style="color:rgb(0, 106, 0);font-family:&quot;Consolas&quot;;font-size:10pt">// 123x</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt"><br> &nbsp;value /= </span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">10</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">;<br> &nbsp;buf[</span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">3</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">] = </span><span style="color:rgb(196, 26, 22);font-family:&quot;Consolas&quot;;font-size:10pt">'0'</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">+ (value % </span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">10</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">); &nbsp; &nbsp;</span><span style="color:rgb(0, 106, 0);font-family:&quot;Consolas&quot;;font-size:10pt">// 12x4</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt"><br> &nbsp;value /= </span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">10</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">;<br> &nbsp;buf[</span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">2</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">] = </span><span style="color:rgb(196, 26, 22);font-family:&quot;Consolas&quot;;font-size:10pt">'0'</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">+ (value % </span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">10</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">); &nbsp; &nbsp;</span><span style="color:rgb(0, 106, 0);font-family:&quot;Consolas&quot;;font-size:10pt">// 1x34</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt"><br> &nbsp;value /= </span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">10</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">;<br> &nbsp;buf[</span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">1</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">] = </span><span style="color:rgb(196, 26, 22);font-family:&quot;Consolas&quot;;font-size:10pt">'0'</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">+ (value % </span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">10</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">); &nbsp; &nbsp;</span><span style="color:rgb(0, 106, 0);font-family:&quot;Consolas&quot;;font-size:10pt">// x234</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt"><br> &nbsp;value /= </span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">10</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">;<br> &nbsp;buf[</span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">0</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">] = </span><span style="color:rgb(196, 26, 22);font-family:&quot;Consolas&quot;;font-size:10pt">'0'</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">+ (value % </span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">10</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">); &nbsp; &nbsp;</span><span style="color:rgb(0, 106, 0);font-family:&quot;Consolas&quot;;font-size:10pt">// x1234 -- should be zero</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt"><br> &nbsp;DigiUSB.</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">println</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">(buf);<br>}</span></p></td>
  </tr>
 </tbody>
</table>
<p></p>
<p><span>See </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://digistump.com/board/index.php?topic=1675.0" style="color:inherit;text-decoration:inherit">https://digistump.com/board/index.php?topic=1675.0</a></span><span>&nbsp;for an overview of how to use this on the Android side.</span></p>
<p></p>
<h2 id="h.op5cnrsvdhi" style="line-height:1.14;padding-bottom:6pt;padding-top:4pt;page-break-after:avoid"><span style="font-size:16pt">Example 2: Reading an HC SR501 PIR Sensor</span></h2>
<p></p>
<p><span>PIR arduino sensors (1 pack of 5 for $10ish): </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://amzn.to/2IB9P20" style="color:inherit;text-decoration:inherit">https://amzn.to/2IB9P20</a></span></p>
<p></p>
<p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:0.00px solid #000000;display:inline-block;height:396.00px;margin:0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:598.00px"><img alt="" src="img_2d64e0263dd84010b2affeb20ccfb9754012f05029f09b3a7fb80fe25dcf6ee7i.jpg" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p>
<p style="text-align:center"><span style="font-size:9pt">(image source: the internet)</span></p>
<p><span>To use with a Tiny:</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>PIR VCC to Tiny 5V</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>PIG OUT to Tiny P0 or P2, mapped as digital input.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>PIR GND to Tiny Gnd</span></li>
</ul>
<p></p>
<p><span>Arduino sketch:</span></p>
<p></p>
<p style="text-align:left"><span></span></p>
<table style="border-collapse:collapse;border-spacing:0;margin-right:auto">
 <tbody>
  <tr style="height:0pt">
   <td colspan="1" rowspan="1" style="background-color:rgb(255, 255, 255);border-bottom-color:rgb(0, 0, 0);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(0, 0, 0);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(0, 0, 0);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(0, 0, 0);border-top-style:solid;border-top-width:1pt;padding:5pt 5pt 5pt 5pt;vertical-align:top;width:597.6pt"><p style="text-align:left" class="console "><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">#define USB_CFG_DEVICE_NAME &nbsp; &nbsp; 'D','i','g','i','S','R','5','0','1'</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt"><br></span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">#define USB_CFG_DEVICE_NAME_LEN 9</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt"><br></span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">#include &lt;DigiUSB.h&gt;</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt"><br><br></span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">#define LED &nbsp; &nbsp;1 &nbsp; &nbsp;</span><span style="color:rgb(0, 106, 0);font-family:&quot;Consolas&quot;;font-size:10pt">// on-board led on digital pin 1</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt"><br></span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">#define PIR_IN 0 &nbsp; &nbsp;</span><span style="color:rgb(0, 106, 0);font-family:&quot;Consolas&quot;;font-size:10pt">// PIR on P0</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt"><br></span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">char</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;buf[</span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">2</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">];<br><br></span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">void</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">setup</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">() {<br> &nbsp;DigiUSB.</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">begin</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">();<br> &nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">pinMode</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">(LED, &nbsp; &nbsp;</span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">OUTPUT</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">);<br> &nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">pinMode</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">(PIR_IN, </span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">INPUT</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">);<br> &nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">blink</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">();<br>}<br></span><span style="font-family:&quot;Consolas&quot;;font-size:10pt"><br></span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">void</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">blink</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">() {<br> &nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">digitalWrite</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">(LED, </span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">LOW</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">);<br> &nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">delay</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">(</span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">50</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;</span><span style="color:rgb(0, 106, 0);font-family:&quot;Consolas&quot;;font-size:10pt">/*ms*/</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">);<br> &nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">digitalWrite</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">(LED, </span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">HIGH</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">);<br> &nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">delay</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">(</span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">200</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;</span><span style="color:rgb(0, 106, 0);font-family:&quot;Consolas&quot;;font-size:10pt">/*ms*/</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">);<br> &nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">digitalWrite</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">(LED, </span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">LOW</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">);<br>}<br></span><span style="font-family:&quot;Consolas&quot;;font-size:10pt"><br></span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">void</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">loop</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">() {<br> &nbsp;DigiUSB.refresh();<br> &nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">if</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;(DigiUSB.</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">available</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">() &gt; </span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">0</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">) {<br> &nbsp; &nbsp;in = DigiUSB.</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">read</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">();<br> &nbsp; &nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">if</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;(in == </span><span style="color:rgb(196, 26, 22);font-family:&quot;Consolas&quot;;font-size:10pt">'r'</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">) {<br> &nbsp; &nbsp; &nbsp;readPir();<br> &nbsp; &nbsp;} </span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">else</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">if</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;(in == </span><span style="color:rgb(196, 26, 22);font-family:&quot;Consolas&quot;;font-size:10pt">'b'</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">) {<br> &nbsp; &nbsp; &nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">blink</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">();<br> &nbsp; &nbsp;}<br> &nbsp;}<br>}<br><br></span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">void</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;readPir() {<br> &nbsp;</span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">int</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;pir_on = </span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">0</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">;<br> &nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">if</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;(</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">millis</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">() &gt; </span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">1000</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">*</span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">60</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">) { </span><span style="color:rgb(0, 106, 0);font-family:&quot;Consolas&quot;;font-size:10pt">// 1 minute to stabilize HC SR501</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt"><br> &nbsp; &nbsp;pir_on = </span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">digitalRead</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">(PIR_IN) == </span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">HIGH</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">;<br> &nbsp; &nbsp;</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">digitalWrite</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">(LED, pir_on ? </span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">HIGH</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;: </span><span style="color:rgb(170, 13, 145);font-family:&quot;Consolas&quot;;font-size:10pt">LOW</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">);<br> &nbsp;}<br> &nbsp;buf[</span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">0</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">] = pir_on ? </span><span style="color:rgb(196, 26, 22);font-family:&quot;Consolas&quot;;font-size:10pt">'1'</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">&nbsp;: </span><span style="color:rgb(196, 26, 22);font-family:&quot;Consolas&quot;;font-size:10pt">'0'</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">;<br> &nbsp;buf[</span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">1</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">] = </span><span style="color:rgb(28, 0, 207);font-family:&quot;Consolas&quot;;font-size:10pt">0</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">;<br> &nbsp;DigiUSB.</span><span style="color:rgb(92, 38, 153);font-family:&quot;Consolas&quot;;font-size:10pt">println</span><span style="font-family:&quot;Consolas&quot;;font-size:10pt">(buf);<br>}</span></p></td>
  </tr>
 </tbody>
</table>
<p style="text-align:left"></p>
<p style="text-align:left"><span>There’s a bit of a subtlety here: The SR501 is internally a 3V device so the OUT pin is 3V when on. Since the Digispark is a 5V device, the I/O pins reads a high when the input is 3V. So “normally” that works out fine. Unless for example you place a LED on the SR501 output, or anything else that may causes enough voltage drop to not register the high state on the IO pin. A workaround is to measure it in analog with a lower threshold. Here’s an example doing just that:</span></p>
<p style="text-align:left"></p>
<p style="text-align:left"><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://github.com/model-railroad/conductor/blob/main/arduino/Digi_PIR_HC_SR501/Digi_PIR_HC_SR501.ino" style="color:inherit;text-decoration:inherit">https://github.com/model-railroad/conductor/blob/main/arduino/Digi_PIR_HC_SR501/Digi_PIR_HC_SR501.ino</a></span></p>
<p style="text-align:left"></p>
<p style="text-align:left"><span>~~</span></p>
<p></p>
<hr>
<p></p>


    </div>



<div class="prev-next-container">


    <span class="prev-page"><a href="2018-09-15_nce_aiu01_and_motion_sensor.html">⇐ Newer Post</a><br/></span>
    <span class="next-page"><a href="2018-09-01_conductor_1_and_e-stop.html">Older Post ⇒</a><br/></span>

</div>

</div> <!-- container -->
</div> <!-- main -->

<div class="sharethis-inline-share-buttons"></div>

<div class="bottom-container">&nbsp;Generated on 2025-09-01 by Rig4j 0.1-Exp-0c45755&nbsp;</div>

</main>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-M1KDMEFC4D"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-M1KDMEFC4D');
</script>

</body>
</html>

