<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport"    content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author"      content="">

<link href="atom.xml" type="application/atom+xml" rel="alternate" title="Atom feed for Blog: Model Train-related Notes" />

<meta property="og:url"         content="https://www.alfray.com/trains/blog/train/2014-09-07_jmri_withrottle_protocol.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="JMRI WiThrottle protocol" />

<meta property="og:description" content="This is my own understanding of the JMRI WiThrottle protocol based on reading the JMRI source code and connecting to a local JMRI server. I apologize in advance for the highly condensed notation style. I originally started looking into this to create my own python program; then back in 2014/2015 I used this &nbsp;to create a Python extension of Scratch running on a Raspberry Pi to control JMRI. It was pointless yet it was absolutely cool and totally worth it. Eventually I used that same information to create my own Cab Engineer: DCC Throttle&nbsp;android app." />


<meta name="twitter:card"        content="summary" />
<!-- meta name="twitter:site"    content="@flickr" / -->
<meta name="twitter:title"       content="JMRI WiThrottle protocol" />

<meta name="twitter:description" content="This is my own understanding of the JMRI WiThrottle protocol based on reading the JMRI source code and connecting to a local JMRI server. I apologize in advance for the highly condensed notation style. I originally started looking into this to create my own python program; then back in 2014/2015 I used this &nbsp;to create a Python extension of Scratch running on a Raspberry Pi to control JMRI. It was pointless yet it was absolutely cool and totally worth it. Eventually I used that same information to create my own Cab Engineer: DCC Throttle&nbsp;android app." />


<title>Blog: Model Train-related Notes</title>

<script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5c66171070e9220011ed1c61&product=inline-share-buttons" async="async"></script>

<!-- Custom styles for this template -->
<style type="text/css">
body {
    font-family: sans-serif;
    margin: 0;
}

.main {
    margin: 8px;
}

p, span {
    line-height: 1.2;
    text-align: justify;
}

p.console {
    margin: 0;
    padding: 0;
}

.container {
    max-width: 95%;
}

@media screen and (min-width: 600px) {
    .container {
        max-width: 60rem;
    }
}

.center-horiz {
    margin: auto;
}

.no-margin-container {
}

/* Header + Title */
.blog-header {
  margin-bottom: 3rem;
  background-color: #428bca;
  box-shadow: inset 0 -.1rem .25rem rgba(0,0,0,.1);
}


.banner-bg-image {
    height: 50px;
    background-image: url("header.jpg");
    background-position: center;
    background-size: 100% auto;
}

@media screen and (min-width: 600px) {
    .banner-bg-image {
        height: 200px;
    }
}


.title-container {
    color: #fff;
    padding: 1rem;
    line-height: 1.5;
    font-weight: 500;
    font-size: 24px;
    font-family: sans-serif;
}

.title-container a {
    color: #fff;
    text-decoration: none;
}

.post-container {
}

.bottom-container {
    margin-top: 8px;
    color: #fff;
    background-color: #428bca;
    font-family: sans-serif;
    text-align: center;
    font-size: small;
    line-height: 1rem;
}

@media screen and (min-width: 600px) {
    .bottom-container {
        font-size: x-small;
    }
}

.post-title-container {
    position: relative;
    background-color: #428bca;
    padding: 0.5rem;
}

.post-title {
    display: inline;
    color: #fff;
    font-weight: 500;
    font-family: sans-serif;
    font-size: 1.5em;
}

a.post-title-link {
    color: #fff;
    text-decoration: none;
}

.post-cat {
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    padding: 0.25rem;
    background-color: #d0e0e3;
    color: #000;
    font-weight: 500;
    font-family: sans-serif;
    font-size: 1.5em;
}

a.post-cat-link {
    color: #000;
    text-decoration: none;
}

.post-cat-label {
    display: block;
    text-align: right;
    color: #000;
    font-size: 0.4em;
}

.prev-next-container {
    overflow: auto;
}

.prev-page {
    float: left;
    line-height: 2em;
}

.next-page {
    float: right;
    line-height: 2em;
}

h1, h2, h3, h4, h5, h6 {
    font-family: sans-serif;
    font-weight: bold;
}

.text-hide {
    font: 0/0 a;
    color: transparent;
    text-shadow: none;
    background-color: transparent;
    border: 0;
}

td p {
    margin: 0;
}


</style>
</head>

<body>

<header class="blog-header">

    <div class="no-margin-container banner-bg-image text-hide">
        Site Banner Image
    </div>

    <div class="title-container">
        <a href="https://www.alfray.com/trains/">Ralf's Train Pages</a>
        
        /
        <a href="000a.html">Blog: Model Train-related Notes</a>
        
    </div>
</header>

<main role="main">
<div class="main">
<div class="container center-horiz">

<p><span> </span></p>
<p><span></span></p>
<p><span> </span></p>
<table style="border-collapse:collapse;border-spacing:0;margin-left:auto;margin-right:auto">
 <tbody>
  <tr style="height:0pt">
   <td colspan="1" rowspan="1" style="background-color:rgb(103, 78, 167);border-bottom-color:rgb(255, 255, 255);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(255, 255, 255);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(255, 255, 255);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(255, 255, 255);border-top-style:solid;border-top-width:1pt;padding:7.2pt 7.2pt 7.2pt 7.2pt;vertical-align:top;width:149.4pt"><p style="text-align:center"><span style="-webkit-text-decoration-skip:none;color:rgb(255, 217, 102);font-size:14pt;font-weight:700;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/" style="color:inherit;text-decoration:inherit">Train Pages</a></span></p></td>
   <td colspan="1" rowspan="1" style="background-color:rgb(103, 78, 167);border-bottom-color:rgb(255, 255, 255);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(255, 255, 255);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(255, 255, 255);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(255, 255, 255);border-top-style:solid;border-top-width:1pt;padding:7.2pt 7.2pt 7.2pt 7.2pt;vertical-align:top;width:149.4pt"><p style="text-align:center"><span style="-webkit-text-decoration-skip:none;color:rgb(255, 217, 102);font-size:14pt;font-weight:700;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/blog/train/" style="color:inherit;text-decoration:inherit">Tech Blog</a></span></p></td>
   <td colspan="1" rowspan="1" style="background-color:rgb(103, 78, 167);border-bottom-color:rgb(255, 255, 255);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(255, 255, 255);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(255, 255, 255);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(255, 255, 255);border-top-style:solid;border-top-width:1pt;padding:7.2pt 7.2pt 7.2pt 7.2pt;vertical-align:top;width:149.4pt"><p style="text-align:center"><span style="-webkit-text-decoration-skip:none;color:rgb(255, 217, 102);font-size:14pt;font-weight:700;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/randall/rtac.html" style="color:inherit;text-decoration:inherit">RTAC Software</a></span></p></td>
   <td colspan="1" rowspan="1" style="background-color:rgb(103, 78, 167);border-bottom-color:rgb(255, 255, 255);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(255, 255, 255);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(255, 255, 255);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(255, 255, 255);border-top-style:solid;border-top-width:1pt;padding:7.2pt 7.2pt 7.2pt 7.2pt;vertical-align:top;width:149.4pt"><p style="text-align:center"><span style="-webkit-text-decoration-skip:none;color:rgb(255, 217, 102);font-size:14pt;font-weight:700;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.youtube.com/c/raphaelmoll" style="color:inherit;text-decoration:inherit">Videos</a></span></p></td>
  </tr>
 </tbody>
</table>
<p></p>
<p><span style="font-style:italic">Model Train-related Notes Blog -- t</span><span style="font-style:italic">hese are personal notes and musings on the subject of model train control, automation, electronics, or whatever I find interesting. I also have more posts in a blog dedicated to the maintenance of the </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);font-style:italic;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/blog/randall/" style="color:inherit;text-decoration:inherit">Randall Museum Model Railroad</a></span><span style="font-style:italic">.</span></p>
<p><span></span></p>

<div class="prev-next-container">


    <span class="prev-page"><a href="2016-04-09_use_an_nce_aiu_and_ir_sensors.html">⇐ Newer Post</a><br/></span>
    <span class="next-page"></span>

</div>


    <div class="post-container">
    <div class="post-title-container"><h2 class="post-title">2014-09-07 - JMRI WiThrottle protocol</h2>
    <span class="post-cat" title="Category">
            <span class="post-cat-label">Category</span>
            <span class="post-cat-text">Jmri</span>
    </span>
    </div>


    <p><span></span></p>
<p><span>This is my own understanding of the JMRI WiThrottle protocol based on reading the JMRI source code and connecting to a local JMRI server. I apologize in advance for the highly condensed notation style. I originally started looking into this to create my own python program; then back in 2014/2015 I used this &nbsp;to create a Python extension of Scratch running on a Raspberry Pi to control JMRI. It was pointless yet it was absolutely cool and totally worth it. Eventually I used that same information to create my own </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/cab_app.html" style="color:inherit;text-decoration:inherit">Cab Engineer: DCC Throttle</a></span><span>&nbsp;android app.</span></p>
<p></p>
<p><span>-- (start of info dump) --</span></p>
<p></p>
<p style="text-align:left"><span>JRMI WiThrottle protocol in action using [</span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="http://jmri.sourceforge.net/help/en/package/jmri/jmrit/withrottle/Protocol.shtml" style="color:inherit;text-decoration:inherit">WiThrottle protocol doc</a></span><span>].</span></p>
<p style="text-align:left"><span>Server code: </span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://github.com/JMRI/JMRI/blob/master/java/src/jmri/jmrit/withrottle/DeviceServer.java" style="color:inherit;text-decoration:inherit">DeviceServer.java</a></span><span>&nbsp;for main codes (</span><span style="-webkit-text-decoration-skip:none;text-decoration:line-through;text-decoration-skip-ink:none">old sourceforge link: </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline line-through;text-decoration-skip-ink:none"><a href="http://sourceforge.net/p/jmri/code/HEAD/tree/trunk/jmri/java/src/jmri/jmrit/withrottle/DeviceServer.java" style="color:inherit;text-decoration:inherit">DeviceServer.java</a></span><span>).</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://github.com/JMRI/JMRI/blob/master/java/src/jmri/jmrit/withrottle/ThrottleController.java" style="color:inherit;text-decoration:inherit">ThrottleController.java</a></span><span>&nbsp;for single throttle (T and S codes) (</span><span style="-webkit-text-decoration-skip:none;text-decoration:line-through;text-decoration-skip-ink:none">old sourceforge link: </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline line-through;text-decoration-skip-ink:none"><a href="http://sourceforge.net/p/jmri/code/HEAD/tree/trunk/jmri/java/src/jmri/jmrit/withrottle/ThrottleController.java" style="color:inherit;text-decoration:inherit">ThrottleController.java</a></span><span style="-webkit-text-decoration-skip:none;text-decoration:line-through;text-decoration-skip-ink:none">)</span><span>:</span></li>
</ul>
<p style="text-align:left"></p>
<p style="text-align:left"><span>[2020 update: code now at </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://github.com/JMRI/JMRI" style="color:inherit;text-decoration:inherit">https://github.com/JMRI/JMRI</a></span><span>. Also note that all T/S throttle commands are now considered obsolete, using the MT multi-throttle commands is pretty much a given.</span><span>]</span></p>
<p style="text-align:left"><span></span></p>
<table style="border-collapse:collapse;border-spacing:0;margin-right:auto">
 <tbody>
  <tr style="height:0pt">
   <td colspan="1" rowspan="1" style="border-bottom-color:rgb(0, 0, 0);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(0, 0, 0);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(0, 0, 0);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(0, 0, 0);border-top-style:solid;border-top-width:1pt;padding:5pt 5pt 5pt 5pt;vertical-align:top;width:597.6pt"><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">$ sudo apt-get install nc</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">$ nc 192.168.1.39 20004</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&lt; VN2.0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- this is the protocol version number</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&lt; RL4]\[RS3 #36}|{36}|{S]\[RS3 #38}|{38}|{S]\[Steam 260}|{4}|{S]\[Yellow SD70}|{3}|{S</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- this is the roster, Entries are delimited by ]\[ and fields by }|{.</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- so 4 entries with name|address|short-or-long for each entry.</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&lt; PPA2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- TrackPowerController</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&lt; PTT]\[Turnouts}|{Turnout]\[Closed}|{2]\[Thrown}|{4</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&lt; PTL]\[NT1}|{Yard_1}|{4]\[NT2}|{Yard_2}|{2]\[NT3}|{Maintenance}|{2]\[NT4}|{Spur}|{2</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&lt; PRT]\[Routes}|{Route]\[Active}|{2]\[Inactive}|{4</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&lt; RCC1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- number of consists to follow (0 if none)</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&lt; RCD}|{86(S)}|{86(S)]\[38(S)}|{true]\[36(S)}|{false</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- this is obviously the consist roster: 86 address composed of 38 front + 36 rear.</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&lt; PW12080&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- port web site</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">Them my turn to control:</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&gt;NSomeName -- sets the name of the throttle for the JRMI server</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&nbsp;</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&nbsp;</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&gt; TS3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- select loco at short address 3 (or TL1538)</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- replies with the capabilities of the loco (function names + function states.)</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- running it again reply "TNot Set", which 'releases' the loco.</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&gt; TR0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- set direction to reverse</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&gt; TR1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- set direction to forward</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&gt; TV0 … TV126&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- set speed</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&gt; TI&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- idle, sort-of similar to TV0, stop loco</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&gt; TX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- emergency stop, stops really right away + deactivate sound/functions.</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">-- Restoring speed deactivates the emergency stop.</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&gt; TF18&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- push (1) button F8. So that's mute toggle on/off</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- For toggles use 1 (push), then 0=light, 1=bell, 2=horn</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">-- and send it again to toggle.</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">-- replies with the *new* state:</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&lt; RPF}|{T]\[F8}|{true</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&gt; TF02&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- that seems the only one that releases the horn.</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- so TF12 &nbsp;+ TF12 (push horn button twice) does the same as TF12 + TF02</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">(push then release)</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&gt; TQ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- quit / releases loco (which stops them) + closes TCP connection.</span></p></td>
  </tr>
 </tbody>
</table>
<p style="text-align:left"></p>
<p style="text-align:left"><span>Switching locos with TS (e.g. TS3, TS4) stops the other loco as soon as a new command is given. There's a S prefix for a "secondary throttle" but when using it, it also stops the main loco. So this doesn't allow me to control more than one at the same time. Instead there's a "multi throttle" protocol:</span></p>
<p style="text-align:left"></p>
<table style="border-collapse:collapse;border-spacing:0;margin-right:auto">
 <tbody>
  <tr style="height:0pt">
   <td colspan="1" rowspan="1" style="border-bottom-color:rgb(0, 0, 0);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(0, 0, 0);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(0, 0, 0);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(0, 0, 0);border-top-style:solid;border-top-width:1pt;padding:5pt 5pt 5pt 5pt;vertical-align:top;width:597.6pt"><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&gt; NTelnet</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&gt; MT+1&lt;;&gt;S3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- register multi-throttle T id 1 for DCC S3. &lt;;&gt; is the field separator.</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&gt; MTA1&lt;;&gt;V4 ...</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&gt; MT-1&lt;;&gt;S3</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">(replies with loco caps / functions).</span></p></td>
  </tr>
 </tbody>
</table>
<p style="text-align:left"></p>
<p style="text-align:left"><span>OK I get it, both the MT (multi controller) and the T/S (single controller) commands work the same: T &amp; S can be effectively used to control 2 engines at the same time without releasing them; *however* when using DCC addresses 3 and 4, there's a conflict with the DCC Twin and this one takes over for whichever address is not being addressed. e.g:</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>Set speed V5 for S3 ⇒ takes over the DCC Twin A (S3)</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>Set speed V5 for S86 ⇒ both engines 3 and 4 change to match the DCC Twin A/B speeds.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>Changing speed of S3 / S4 seems OK and does not remove control. However changing directions (R0 / R1) or applying any function or changing the speed of something else than S3 / S4 does affect speed.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>When using TQ (quit), the S3/S4 locos immediately adopt the DCC Twin's speed.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>The behavior is the same when using the EngineDriver android app.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>Using MT, there's no difference between using MT+1/2/3 vs MS (secondary controller in multi-controller mode), e.g. using the T/S controller entries vs the multi-controller IDs does not change the behavior.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>Once I start this route, it seems the potar speed control on the DCC Twin A (S3) doesn't work anymore yet the B (S4) still works. Powering off/on fixes it.</span></li>
</ul>
<p style="text-align:left"></p>
<p style="text-align:left"><span>WiThrottle is exposed via zeroconf:</span></p>
<p style="text-align:left"></p>
<table style="border-collapse:collapse;border-spacing:0;margin-right:auto">
 <tbody>
  <tr style="height:0pt">
   <td colspan="1" rowspan="1" style="border-bottom-color:rgb(0, 0, 0);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(0, 0, 0);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(0, 0, 0);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(0, 0, 0);border-top-style:solid;border-top-width:1pt;padding:5pt 5pt 5pt 5pt;vertical-align:top;width:597.6pt"><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">$ sudo apt-get install mdns-scan</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">$ mdns-scan</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">+ Home Layout._withrottle._tcp.local</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">…</span></p></td>
  </tr>
 </tbody>
</table>
<p style="text-align:left"></p>
<p style="text-align:left"><span>There is a [</span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://github.com/paulsm/pyzeroconf" style="color:inherit;text-decoration:inherit">pyzeroconf in python</a></span><span>] library (and a </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://github.com/jstasiak/python-zeroconf" style="color:inherit;text-decoration:inherit">fork here</a></span><span>) but I failed to see how to use it right away to get the IP address of the JMRI WiThrottle server.</span></p>
<p style="text-align:left"></p>
<p style="text-align:left"><span>The goal is to make a python "module" for the lapse timer, and then adapt it for Scratch.</span></p>
<p style="text-align:left"></p>
<p style="text-align:left"><span>Standalone module, create a single class that:</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>Init: create socket, send the throttle name, takes single loco address.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>Close: send a TI (idle) before closing with TQ.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>Use T with that loco short address.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>Commands:</span></li>
 <ul>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>direction forward / reverse</span></li>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>speed 0..126</span></li>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>toggle_bell</span></li>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>toggle_horn</span></li>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>short_horn</span></li>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>toggle_sound</span></li>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>toggle_light</span></li>
 </ul>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>Trivial toggles: just send command, ignore response.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>More advanced toggles: take on/off argument. Send command, check response matches (true/false); if not, send command again.</span></li>
</ul>
<p style="text-align:left"></p>
<p style="text-align:left"><span>API to expose for Scratch:</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>Scratch can have broadcasts or variables</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>Simple API: control a single loco at a time.</span></li>
 <ul>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>var: loco_number (3, 4, 86)</span></li>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>var: loco_speed (0..126)</span></li>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>broadcast: loco_forward ; loco_reverse (apply R0/R1 + V) ; loco_stop (TI)</span></li>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>remember moving state internally</span></li>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>changing loco_speed if moving sends a V.</span></li>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>optional: changing loco_number sends a TI first if moving.</span></li>
 </ul>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>Complex API: control multiple locos.</span></li>
 <ul>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>provide 3 vars: loco3_speed ; loco4_speed ; loco86_speed.</span></li>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>3 broadcasts per loco = 9 broadcasts.</span></li>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>seems harder to use.</span></li>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>⇒ Not doing this right now.</span></li>
 </ul>
</ul>
<p style="text-align:left"></p>
<p style="text-align:left"></p>
<p style="text-align:left"><span>[2014-12-23] More on the WiThrottle protocol:</span></p>
<p style="text-align:left"><span>Server source main file is at </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline line-through;text-decoration-skip-ink:none"><a href="http://sourceforge.net/p/jmri/code/HEAD/tree/trunk/jmri/java/src/jmri/jmrit/withrottle/DeviceServer.java" style="color:inherit;text-decoration:inherit">http://sourceforge.net/p/jmri/code/HEAD/tree/trunk/jmri/java/src/jmri/jmrit/withrottle/DeviceServer.java</a></span><span>&nbsp;:</span></p>
<p style="text-align:left"><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://github.com/JMRI/JMRI/blob/master/java/src/jmri/jmrit/withrottle/DeviceServer.java" style="color:inherit;text-decoration:inherit">https://github.com/JMRI/JMRI/blob/master/java/src/jmri/jmrit/withrottle/DeviceServer.java</a></span><span>&nbsp;:</span></p>
<p style="text-align:left"></p>
<table style="border-collapse:collapse;border-spacing:0;margin-right:auto">
 <tbody>
  <tr style="height:0pt">
   <td colspan="1" rowspan="1" style="border-bottom-color:rgb(0, 0, 0);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(0, 0, 0);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(0, 0, 0);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(0, 0, 0);border-top-style:solid;border-top-width:1pt;padding:5pt 5pt 5pt 5pt;vertical-align:top;width:597.6pt"><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">- "*" is an heartbeat:</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&nbsp; *+ &nbsp;starts heartbeat</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&nbsp; *- &nbsp;stops heartbeat</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">&nbsp; * &nbsp; heartbeat</span></p></td>
  </tr>
 </tbody>
</table>
<p style="text-align:left"></p>
<p style="text-align:left"><span>Roster:</span></p>
<p style="text-align:left"></p>
<table style="border-collapse:collapse;border-spacing:0;margin-right:auto">
 <tbody>
  <tr style="height:0pt">
   <td colspan="1" rowspan="1" style="border-bottom-color:rgb(0, 0, 0);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(0, 0, 0);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(0, 0, 0);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(0, 0, 0);border-top-style:solid;border-top-width:1pt;padding:5pt 5pt 5pt 5pt;vertical-align:top;width:597.6pt"><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">sendRoster() "documents" the roster entry</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">- FS field sep }|{</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">- ES entry sep ]\[</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">- syntax RL &lt;num-entries&gt; N*[ ES &lt;name&gt; FS &lt;dcc-address&gt; FS &lt;S|L&gt; ]</span></p></td>
  </tr>
 </tbody>
</table>
<p style="text-align:left"></p>
<p style="text-align:left"></p>
<p style="text-align:left"><span>On connection, various controllers send their states:</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>RouteController.java sends PRT (Panel Routes Titles) + PRL (Panel Route List)</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>TrackPowerController.java sends PPA</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>TurnoutController.java sends PTT (Panel Turnout Titles)<br></span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://github.com/JMRI/JMRI/blob/master/java/src/jmri/jmrit/withrottle/TurnoutController.java" style="color:inherit;text-decoration:inherit">https://github.com/JMRI/JMRI/blob/master/java/src/jmri/jmrit/withrottle/TurnoutController.java</a></span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>Command: PTA&lt;one letter command&gt;&lt;system name or user name or number&gt;<br>Command letter: 2=toggle, C=closed, T=thrown</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>⇒ a single “turnout” number is converted into the default system prefix (e.g. 3 ⇒ NT3).</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>⇒ reply is PTA&lt;2 or 4&gt;&lt;name&gt; or “HM” with human error string for unknown turnouts.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>⇒ an invalid command is ignored..</span></li>
</ul>
<p style="text-align:left"><span>Enumeration syntax:</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>FS field sep }|{</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>ES entry sep ]\[</span></li>
</ul>
<p style="text-align:left"></p>
<p style="text-align:left"><span>PTT gives </span><span style="font-style:italic">generic</span><span>&nbsp;state names: name for closed, thrown, turnout table:</span></p>
<p style="text-align:left"></p>
<table style="border-collapse:collapse;border-spacing:0;margin-right:auto">
 <tbody>
  <tr style="height:0pt">
   <td colspan="1" rowspan="1" style="border-bottom-color:rgb(0, 0, 0);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(0, 0, 0);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(0, 0, 0);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(0, 0, 0);border-top-style:solid;border-top-width:1pt;padding:5pt 5pt 5pt 5pt;vertical-align:top;width:597.6pt"><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">PTT]\[value}|{turnoutKey]\[value}|{closedKey]\[value}|{thrownKey</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">- keys are “Turnout”, “2” (closed) and “4” (thrown)</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">PTL lists the actual turnouts and states:</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">PTL N*&lt; ]\[SysName}|{UsrName}|{CurrentState &gt;</span></p><p style="text-align:left" class="console "><span style="font-family:&quot;Consolas&quot;;font-size:8pt;vertical-align:baseline">- States are 1=Unknown, 2=Closed, 4=Thrown.</span></p></td>
  </tr>
 </tbody>
</table>
<p style="text-align:left"></p>
<p style="text-align:left"><span>ConsistController.java sends RCC + one RCD per consist</span></p>
<p style="text-align:left"><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="http://sourceforge.net/p/jmri/code/HEAD/tree/trunk/jmri/java/src/jmri/jmrit/withrottle/ConsistController.java" style="color:inherit;text-decoration:inherit">http://sourceforge.net/p/jmri/code/HEAD/tree/trunk/jmri/java/src/jmri/jmrit/withrottle/ConsistController.java</a></span><span>&nbsp;</span></p>
<p style="text-align:left"><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://github.com/JMRI/JMRI/blob/master/java/src/jmri/jmrit/withrottle/ConsistController.java" style="color:inherit;text-decoration:inherit">https://github.com/JMRI/JMRI/blob/master/java/src/jmri/jmrit/withrottle/ConsistController.java</a></span></p>
<p style="text-align:left"><span>Formal syntax:</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>FS field sep }|{</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>ES entry sep ]\[</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>syntax RCC &lt;num-consists&gt; or RCL &lt;num-consists&gt;</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>syntax RCD FS &lt;consist-address&gt; FS empty-string or &lt;consist-ID&gt; N*[ ES &lt;address-string&gt; FS &lt;is-forward:bool&gt; ]</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>is-forward is true (forward) or false (reverse)</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>consist-ID seems to be be the consist-address</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>address string: &lt;number&gt; "(" [S|L] ")"</span></li>
</ul>
<p style="text-align:left"></p>
<p style="text-align:left"><span>For the "T" (throttle) commands:</span></p>
<p style="text-align:left"><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="http://sourceforge.net/p/jmri/code/HEAD/tree/trunk/jmri/java/src/jmri/jmrit/withrottle/ThrottleController.java" style="color:inherit;text-decoration:inherit">http://sourceforge.net/p/jmri/code/HEAD/tree/trunk/jmri/java/src/jmri/jmrit/withrottle/ThrottleController.java</a></span><span>&nbsp;</span></p>
<p style="text-align:left"><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://github.com/JMRI/JMRI/blob/master/java/src/jmri/jmrit/withrottle/ThrottleController.java" style="color:inherit;text-decoration:inherit">https://github.com/JMRI/JMRI/blob/master/java/src/jmri/jmrit/withrottle/ThrottleController.java</a></span></p>
<p style="text-align:left"><span>- on connection, throttle sends:</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>Address</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>function labels =&gt; RF</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>all function states =&gt; RPF</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>current speed &nbsp;=&gt; empty, not sent</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>current direction =&gt; empty, not sent</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>speed step mode =&gt; empty, not sent</span></li>
</ul>
<p style="text-align:left"></p>
<p style="text-align:left"><span>property change: RPF FS &lt;throttle-prefix=T&gt; ES &lt;event-name&gt; FS &lt;value&gt;</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>even name: for example "F18"</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>sources notes event name can be "F##Momentary" instead of "F##"</span></li>
</ul>
<p style="text-align:left"></p>
<p style="text-align:left"><span>Function labels: RF &lt;number=29&gt; FS &lt;address-string&gt; N=29*[ ES &lt;label&gt; or empty ]</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>address string: &lt;number&gt; "(" [S|L] ")"</span></li>
</ul>
<p style="text-align:left"></p>
<p style="text-align:left"><span>Function states: RPF FS &lt;throttle-prefix=T&gt; 29* [ ES &lt;F&gt; &lt;0..28&gt; FS &lt;value:bool&gt; ]</span></p>
<p style="text-align:left"></p>
<p style="text-align:left"><span>Throttle received commands with a T prefix:</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>V &lt;int&gt; = velocity, range 0..126</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>X = eStop</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>F &lt;c&gt; &lt;int&gt; = function, c: 1=button down, 0=button up, maps directly on internal getFn method.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>f = *force* function if VN &gt;= 2.0</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>R &lt;0|1&gt; = 0=reverse, 1=forward (in fact: bool is-forward)</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>r = address release</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>d = address dispatch (?)</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>L &lt;int&gt; = release current + set long address</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>S &lt;int&gt; = release current + set short address</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>E = address from roster entry if VN &gt;= 1.7</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>C = set loco for consist functions</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>c = Consist Lead from RosterEntry if VN &gt;= 1.7</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>I = idle (internally does set-speed-0)</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>s = VN &gt;= 2.0, set speed step mode</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>m = VN &gt;= 2.0, handle momentary : similar to F&lt;0|1&gt;&lt;int&gt; but for throttle getFnMomentary methods.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>q = VN &gt;= 2.0, handle request : ask throttle to send a state.</span></li>
 <ul>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>qV: send current speed (method is void)</span></li>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>qR: send current direction (method is void)</span></li>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>qs: send current speed step mode (method is void)</span></li>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>qm: send current momentary states</span></li>
 </ul>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>Q alone with no prefix: shutdown throttle connection</span></li>
</ul>
<p></p>
<p><span>2021 Update from </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://github.com/JMRI/JMRI/blob/master/java/src/jmri/jmrit/withrottle/DeviceServer.java" style="color:inherit;text-decoration:inherit">DeviceServer</a></span><span>:</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>N&lt;string&gt; = device name.</span></li>
 <ul>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>Replies back with “*&lt;int&gt;”, number of seconds to send a heartbeat before triggering eStop.</span></li>
 </ul>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>H = hardware</span></li>
 <ul>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>HU&lt;string&gt; = device UUID.</span></li>
 </ul>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>* = Heartbeat (alone)</span></li>
 <ul>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>*+ = start HB.</span></li>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>*- = stop HB.</span></li>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>Server side HB is a repeat timer task that sends an eStop on all throttles.</span></li>
  <ul>
   <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>Default interval is 16 seconds.</span></li>
   <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>However the Java Timer object is created using (interval * 900) milliseconds, so it’s going to execute sooner than the advertised 16 seconds, in this case 14.4 seconds!</span></li>
  </ul>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>Suggestion is to send a “*” hb at half the requested time.</span></li>
 </ul>
</ul>
<p></p>
<hr>
<p></p>


    </div>



<div class="prev-next-container">


    <span class="prev-page"><a href="2016-04-09_use_an_nce_aiu_and_ir_sensors.html">⇐ Newer Post</a><br/></span>
    <span class="next-page"></span>

</div>

</div> <!-- container -->
</div> <!-- main -->

<div class="sharethis-inline-share-buttons"></div>

<div class="bottom-container">&nbsp;Generated on 2025-09-04 by Rig4j 0.1-Exp-05cc7b2&nbsp;</div>

</main>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-M1KDMEFC4D"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-M1KDMEFC4D');
</script>

</body>
</html>

