<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport"    content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author"      content="">

<link href="atom.xml" type="application/atom+xml" rel="alternate" title="Atom feed for Blog: Model Train-related Notes" />

<meta property="og:url"         content="https://www.alfray.com/trains/blog/train/2018-12-08_conductor_2_route_sequences.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Conductor 2: Route Sequences" />

<meta property="og:description" content="Above I mentioned the key features for Conductor 2&nbsp;would be profiles, configuration language, and routes." />


<meta name="twitter:card"        content="summary" />
<!-- meta name="twitter:site"    content="@flickr" / -->
<meta name="twitter:title"       content="Conductor 2: Route Sequences" />

<meta name="twitter:description" content="Above I mentioned the key features for Conductor 2&nbsp;would be profiles, configuration language, and routes." />


<title>Blog: Model Train-related Notes</title>

<script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5c66171070e9220011ed1c61&product=inline-share-buttons" async="async"></script>

<!-- Custom styles for this template -->
<style type="text/css">
body {
    font-family: sans-serif;
    margin: 0;
}

.main {
    margin: 8px;
}

p, span {
    line-height: 1.2;
    text-align: justify;
}

p.console {
    margin: 0;
    padding: 0;
}

.container {
    max-width: 95%;
}

@media screen and (min-width: 600px) {
    .container {
        max-width: 60rem;
    }
}

.center-horiz {
    margin: auto;
}

.no-margin-container {
}

/* Header + Title */
.blog-header {
  margin-bottom: 3rem;
  background-color: #428bca;
  box-shadow: inset 0 -.1rem .25rem rgba(0,0,0,.1);
}


.banner-bg-image {
    height: 50px;
    background-image: url("header.jpg");
    background-position: center;
    background-size: 100% auto;
}

@media screen and (min-width: 600px) {
    .banner-bg-image {
        height: 200px;
    }
}


.title-container {
    color: #fff;
    padding: 1rem;
    line-height: 1.5;
    font-weight: 500;
    font-size: 24px;
    font-family: sans-serif;
}

.title-container a {
    color: #fff;
    text-decoration: none;
}

.post-container {
}

.bottom-container {
    margin-top: 8px;
    color: #fff;
    background-color: #428bca;
    font-family: sans-serif;
    text-align: center;
    font-size: small;
    line-height: 1rem;
}

@media screen and (min-width: 600px) {
    .bottom-container {
        font-size: x-small;
    }
}

.post-title-container {
    position: relative;
    background-color: #428bca;
    padding: 0.5rem;
}

.post-title {
    display: inline;
    color: #fff;
    font-weight: 500;
    font-family: sans-serif;
    font-size: 1.5em;
}

a.post-title-link {
    color: #fff;
    text-decoration: none;
}

.post-cat {
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    padding: 0.25rem;
    background-color: #d0e0e3;
    color: #000;
    font-weight: 500;
    font-family: sans-serif;
    font-size: 1.5em;
}

a.post-cat-link {
    color: #000;
    text-decoration: none;
}

.post-cat-label {
    display: block;
    text-align: right;
    color: #000;
    font-size: 0.4em;
}

.prev-next-container {
    overflow: auto;
}

.prev-page {
    float: left;
    line-height: 2em;
}

.next-page {
    float: right;
    line-height: 2em;
}

h1, h2, h3, h4, h5, h6 {
    font-family: sans-serif;
    font-weight: bold;
}

.text-hide {
    font: 0/0 a;
    color: transparent;
    text-shadow: none;
    background-color: transparent;
    border: 0;
}

td p {
    margin: 0;
}


</style>
</head>

<body>

<header class="blog-header">

    <div class="no-margin-container banner-bg-image text-hide">
        Site Banner Image
    </div>

    <div class="title-container">
        <a href="https://www.alfray.com/trains/">Ralf's Train Pages</a>
        
        /
        <a href="0007.html">Blog: Model Train-related Notes</a>
        
    </div>
</header>

<main role="main">
<div class="main">
<div class="container center-horiz">

<p><span> </span></p>
<p><span></span></p>
<p><span> </span></p>
<p><span style="font-style:italic">Model Train-related Notes Blog -- t</span><span style="font-style:italic">hese are personal notes and musings on the subject of model train control, automation, electronics, or whatever I find interesting. I also have more posts in a blog dedicated to the maintenance of the </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);font-style:italic;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/blog/randall/" style="color:inherit;text-decoration:inherit">Randall Museum Model Railroad</a></span><span style="font-style:italic">.</span></p>
<p><span></span></p>

<div class="prev-next-container">


    <span class="prev-page"><a href="2018-12-09_sq23_mini_camera_for_cab_rides.html">⇐ Newer Post</a><br/></span>
    <span class="next-page"><a href="2018-12-01_sq12_mini_camera_for_cab_rides.html">Older Post ⇒</a><br/></span>

</div>


    <div class="post-container">
    <div class="post-title-container"><h2 class="post-title">2018-12-08 - Conductor 2: Route Sequences</h2>
    <span class="post-cat" title="Category">
            <span class="post-cat-label">Category</span>
            <span class="post-cat-text">Rtac</span>
    </span>
    </div>


    <p><span></span></p>
<p></p>
<p><span>Above I mentioned the key features for </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/randall/rtac" style="color:inherit;text-decoration:inherit">Conductor 2</a></span><span>&nbsp;would be profiles, configuration language, and routes.</span></p>
<p></p>
<p><span>I should elaborate a bit on this, especially the routes.</span></p>
<p></p>
<p><span>First the profiles: A profile is simply a DCC address number and a map of variables values. Routes will define variables for, e.g., timers and speeds. The profile will fill in these values to adjust them to a specific train.</span></p>
<p style="text-align:left"><span></span></p>
<p></p>
<p><span>Profiles should be dedicated to a specific route. For example: PA route, with 2 profiles (freight, amtrak, UP, etc.) There should probably be some kind of sanity check to ensure that a route with no profile cannot be started, and also that all the variables have a value.</span></p>
<p></p>
<p><span>To get started, profiles will be assigned via the script (“PA.profile = Amtrak506”). Later I’d like this to be on the tablet so that they can be changed, with the latest value persisted on disk.</span></p>
<p></p>
<p><span>Now let’s look at routes.</span></p>
<p></p>
<p><span>A route is a sequence of blocks and turnouts used by a specific engine/train, with events defined on how to move the train from one place to another.</span></p>
<p></p>
<p><span>There are 3 goals for routes:</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>Provide a way to do interlocking (globally or locally).</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>Define the </span><span style="font-style:italic">sequence</span><span>&nbsp;of movements required by the train.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>Provide sanity checks on the train’s whereabouts.</span></li>
</ul>
<p></p>
<p><span>Let’s look at these individually.</span></p>
<p></p>
<p><span>Interlocking can be either global or local. A global interlock would validate that only one active route can use a given block / turnout at all times. A good example is the current passenger alternance animation: either the full Amtrak runs or the freight runs (on a limited portion of the same route). In the new system these would be defined as 2 separate routes, unaware of each other. One route could not be started if the other one is active as it would use at least one of the same blocks or turnouts.</span></p>
<p></p>
<p><span>Global interlocking is in a way a reservation mode. The whole set of blocks / turnouts are reserved for a particular route and cannot be changed by any other route.</span></p>
<p></p>
<p><span>The reservation is dynamic; it starts when the route becomes active, and ends when the route is no longer active. It’s important for the route events to determine when the route stops being active (e.g. when the train returned at the station and is known to be there). This way in case of error (e.g. derailment), the route stays active, and prevents further reservation.</span></p>
<p></p>
<p><span>Local interlocking would be a “smarter” way to do interlocking with a finer granularity. This is the simple ABS scheme used by railroads: check 2 blocks ahead in the desired sequence direction, and only advance into the next block if it is guaranteed to be free. There are some limitations:</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>In our case, we would need to enforce 2 free blocks ahead. Since typically we detect only a train engine, we do not know if the rest of the train overlaps the next or previous block; for automation purposes we can safely assume each train fits on a block.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>The scheme does not work in a “dual shuttle” configuration, as is the case with the current Amtrak vs Freight automations, as it can create deadlocks if 2 trains are moving towards each other. They would typically stop 2 block away from each other, locked in their opposite direction and unable to resolve the deadlock. It’s possible to identify this and solve it but it’s extra finicky work which is a tad overkill here. </span></li>
</ul>
<p><span>The ABS kind of interlock works well for trains running in a loop in the same direction. It means a faster train can follow a slower train and stop automatically when needed.</span></p>
<p><span>This kind of interlock works well when 2 routes need to cross through the same interchange block or turnout as this is a shared resource that is simply reserved by the first route to acquire the resource.</span></p>
<p></p>
<p><span>Global interlocking can be somewhat too overwhelming, reserving too many blocks in advance. There are 2 ways to work around this:</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>By using some kind of window, e.g. lock 2-3 resources around the current train position. That can result in the kind of contention explained in a dual shuttle setup.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>By reserving all resources ahead of the train and progressively freeing resources </span><span style="font-style:italic">behind</span><span>&nbsp;the train if they are not used again in the route sequence.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>By defining reservation sub-sequences (in essence “sub-routes” within the route).</span></li>
</ul>
<p></p>
<p><span>The last one would work well in the Amtrak case:</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>Global reservation would lock all from B503b-B503a and B321 up to B370.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>2 sub-routes could be defined with T330 as the junction: B503b-B321 and B330-B370.</span></li>
</ul>
<p><span>In that example, a free running train would be allocated a route of B320-B370, overlapping the second sub-route of the Amtrak, whereas the Freight would be allocated a route of B311-B321, overlapping the first sub-route.</span></p>
<p></p>
<p><span>Freeing global interlocked resources automatically behind a train would also work. In this case the Amtrak route would be defined as B503b-B321 | B330-B370 | B370-B330 | B321-B503b. Note that this is an ordered sequence, no longer just a set. When the train is going up, we can detect that it is going to use the same blocks again so they cannot be freed. When the train is going down, we can detect that the blocks are not used again and can be freed on the fly. This would allow a secondary train with a B320-B370 reservation to go through as soon as B330 + 1 block is freed.</span></p>
<p></p>
<p><span>In the case of sub-routes or automatic freeing, it’s important to realize we still want that extra one block of padding as we do not really control the location of the end of the train. In this regard, since we have fixed equipment for the automation, we could install wheel resistors. However we have no such requirement for regular non-automated trains.</span></p>
<p></p>
<p><span>Next we’ll discuss how to use a route sequence programmatically, events for it, and such.</span></p>
<p></p>
<hr>
<p></p>


    </div>



<div class="prev-next-container">


    <span class="prev-page"><a href="2018-12-09_sq23_mini_camera_for_cab_rides.html">⇐ Newer Post</a><br/></span>
    <span class="next-page"><a href="2018-12-01_sq12_mini_camera_for_cab_rides.html">Older Post ⇒</a><br/></span>

</div>

</div> <!-- container -->
</div> <!-- main -->

<div class="sharethis-inline-share-buttons"></div>

<div class="bottom-container">&nbsp;Generated on 2025-09-02 by Rig4j 0.1-Exp-05cc7b2&nbsp;</div>

</main>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-M1KDMEFC4D"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-M1KDMEFC4D');
</script>

</body>
</html>

