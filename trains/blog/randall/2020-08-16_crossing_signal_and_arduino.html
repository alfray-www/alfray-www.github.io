<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport"    content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author"      content="">

<link href="atom.xml" type="application/atom+xml" rel="alternate" title="Atom feed for Blog: Randall Museum Model Railroad" />

<meta property="og:url"         content="https://www.alfray.com/trains/blog/randall/2020-08-16_crossing_signal_and_arduino.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Crossing Signal and Arduino" />

<meta property="og:description" content="Jim is getting a new crossing signal&nbsp;for the Fairfield station:" />
<meta property="og:image"       content="https://www.alfray.com/trains/blog/randall/img_bced8a847f00e14dcf95b04c02bd1b23f963bbcb6af8309341a8c05aa3aa78a4i.jpg" />

<meta name="twitter:card"        content="summary" />
<!-- meta name="twitter:site"    content="@flickr" / -->
<meta name="twitter:title"       content="Crossing Signal and Arduino" />

<meta name="twitter:description" content="Jim is getting a new crossing signal&nbsp;for the Fairfield station:" />
<meta name="twitter:image"       content="https://www.alfray.com/trains/blog/randall/img_bced8a847f00e14dcf95b04c02bd1b23f963bbcb6af8309341a8c05aa3aa78a4i.jpg" />

<title>Blog: Randall Museum Model Railroad</title>

<script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5c66171070e9220011ed1c61&product=inline-share-buttons" async="async"></script>

<!-- Custom styles for this template -->
<style type="text/css">
body {
    font-family: sans-serif;
    margin: 0;
}

.main {
    margin: 8px;
}

p, span {
    line-height: 1.2;
    text-align: justify;
}

p.console {
    margin: 0;
    padding: 0;
}

.container {
    max-width: 95%;
}

@media screen and (min-width: 600px) {
    .container {
        max-width: 60rem;
    }
}

.center-horiz {
    margin: auto;
}

.no-margin-container {
}

/* Header + Title */
.blog-header {
  margin-bottom: 3rem;
  background-color: #428bca;
  box-shadow: inset 0 -.1rem .25rem rgba(0,0,0,.1);
}


.banner-bg-image {
    height: 50px;
    background-image: url("header.jpg");
    background-position: center;
    background-size: 100% auto;
}

@media screen and (min-width: 600px) {
    .banner-bg-image {
        height: 200px;
    }
}


.title-container {
    color: #fff;
    padding: 1rem;
    line-height: 1.5;
    font-weight: 500;
    font-size: 24px;
    font-family: sans-serif;
}

.title-container a {
    color: #fff;
    text-decoration: none;
}

.post-container {
}

.bottom-container {
    margin-top: 8px;
    color: #fff;
    background-color: #428bca;
    font-family: sans-serif;
    text-align: center;
    font-size: small;
    line-height: 1rem;
}

@media screen and (min-width: 600px) {
    .bottom-container {
        font-size: x-small;
    }
}

.post-title-container {
    position: relative;
    background-color: #428bca;
    padding: 0.5rem;
}

.post-title {
    display: inline;
    color: #fff;
    font-weight: 500;
    font-family: sans-serif;
    font-size: 1.5em;
}

a.post-title-link {
    color: #fff;
    text-decoration: none;
}

.post-cat {
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    padding: 0.25rem;
    background-color: #d0e0e3;
    color: #000;
    font-weight: 500;
    font-family: sans-serif;
    font-size: 1.5em;
}

a.post-cat-link {
    color: #000;
    text-decoration: none;
}

.post-cat-label {
    display: block;
    text-align: right;
    color: #000;
    font-size: 0.4em;
}

.prev-next-container {
    overflow: auto;
}

.prev-page {
    float: left;
    line-height: 2em;
}

.next-page {
    float: right;
    line-height: 2em;
}

h1, h2, h3, h4, h5, h6 {
    font-family: sans-serif;
    font-weight: bold;
}

.text-hide {
    font: 0/0 a;
    color: transparent;
    text-shadow: none;
    background-color: transparent;
    border: 0;
}

td p {
    margin: 0;
}


</style>
</head>

<body>

<header class="blog-header">

    <div class="no-margin-container banner-bg-image text-hide">
        Site Banner Image
    </div>

    <div class="title-container">
        <a href="https://www.alfray.com/trains/">Ralf's Train Pages</a>
        
        /
        <a href="000f.html">Blog: Randall Museum Model Railroad</a>
        
    </div>
</header>

<main role="main">
<div class="main">
<div class="container center-horiz">

<p><span> </span></p>
<p><span></span></p>
<p><span> </span></p>
<table style="border-collapse:collapse;border-spacing:0;margin-left:auto;margin-right:auto">
 <tbody>
  <tr style="height:0pt">
   <td colspan="1" rowspan="1" style="background-color:rgb(103, 78, 167);border-bottom-color:rgb(255, 255, 255);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(255, 255, 255);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(255, 255, 255);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(255, 255, 255);border-top-style:solid;border-top-width:1pt;padding:7.2pt 7.2pt 7.2pt 7.2pt;vertical-align:top;width:119.5pt"><p style="text-align:center"><span style="-webkit-text-decoration-skip:none;color:rgb(255, 217, 102);font-size:14pt;font-weight:700;text-decoration:underline;text-decoration-skip-ink:none"><a href="http://ralf.alfray.com/trains/randall/index.html" style="color:inherit;text-decoration:inherit">Introduction</a></span></p></td>
   <td colspan="1" rowspan="1" style="background-color:rgb(103, 78, 167);border-bottom-color:rgb(255, 255, 255);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(255, 255, 255);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(255, 255, 255);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(255, 255, 255);border-top-style:solid;border-top-width:1pt;padding:7.2pt 7.2pt 7.2pt 7.2pt;vertical-align:top;width:119.5pt"><p style="text-align:center"><span style="-webkit-text-decoration-skip:none;color:rgb(255, 217, 102);font-size:14pt;font-weight:700;text-decoration:underline;text-decoration-skip-ink:none"><a href="http://ralf.alfray.com/trains/blog/randall/" style="color:inherit;text-decoration:inherit">Blog &amp; News</a></span></p></td>
   <td colspan="1" rowspan="1" style="background-color:rgb(103, 78, 167);border-bottom-color:rgb(255, 255, 255);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(255, 255, 255);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(255, 255, 255);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(255, 255, 255);border-top-style:solid;border-top-width:1pt;padding:7.2pt 7.2pt 7.2pt 7.2pt;vertical-align:top;width:119.5pt"><p style="text-align:center"><span style="-webkit-text-decoration-skip:none;color:rgb(255, 217, 102);font-size:14pt;font-weight:700;text-decoration:underline;text-decoration-skip-ink:none"><a href="http://ralf.alfray.com/trains/randall/about.html" style="color:inherit;text-decoration:inherit">About the Model Railroad</a></span></p></td>
   <td colspan="1" rowspan="1" style="background-color:rgb(103, 78, 167);border-bottom-color:rgb(255, 255, 255);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(255, 255, 255);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(255, 255, 255);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(255, 255, 255);border-top-style:solid;border-top-width:1pt;padding:7.2pt 7.2pt 7.2pt 7.2pt;vertical-align:top;width:119.5pt"><p style="text-align:center"><span style="-webkit-text-decoration-skip:none;color:rgb(255, 217, 102);font-size:14pt;font-weight:700;text-decoration:underline;text-decoration-skip-ink:none"><a href="http://ralf.alfray.com/trains/randall/rtac.html" style="color:inherit;text-decoration:inherit">RTAC Software</a></span></p></td>
   <td colspan="1" rowspan="1" style="background-color:rgb(103, 78, 167);border-bottom-color:rgb(255, 255, 255);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(255, 255, 255);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(255, 255, 255);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(255, 255, 255);border-top-style:solid;border-top-width:1pt;padding:7.2pt 7.2pt 7.2pt 7.2pt;vertical-align:top;width:119.5pt"><p style="text-align:center"><span style="-webkit-text-decoration-skip:none;color:rgb(255, 217, 102);font-size:14pt;font-weight:700;text-decoration:underline;text-decoration-skip-ink:none"><a href="http://ralf.alfray.com/trains/randall/videos.html" style="color:inherit;text-decoration:inherit">Videos</a></span></p></td>
  </tr>
 </tbody>
</table>
<p></p>
<p><span style="font-style:italic">The Randall Museum in San Francisco hosts a large HO-scale model model railroad. Created by the </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);font-style:italic;text-decoration:underline;text-decoration-skip-ink:none"><a href="http://www.ggmrc.org" style="color:inherit;text-decoration:inherit">Golden Gate Model Railroad Club</a></span><span style="font-style:italic">&nbsp;starting in 1961, the layout was donated to the Museum in 2015. Since then I have started automatizing trains running on the layout. I am also the model railroad maintainer. </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);font-style:italic;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/blog/randall/" style="color:inherit;text-decoration:inherit">This blog</a></span><span style="font-style:italic">&nbsp;describes various updates on the Randall project and I maintain a separate </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);font-style:italic;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/blog/train/" style="color:inherit;text-decoration:inherit">blog for all my electronics</a></span><span style="font-style:italic">&nbsp;not directly related to Randall. </span><span></span></p>

<div class="prev-next-container">


    <span class="prev-page"><a href="2020-09-27_state_of_projects.html">⇐ Newer Post</a><br/></span>
    <span class="next-page"><a href="2020-06-14__train_motion_video_display__d300ac8f.html">Older Post ⇒</a><br/></span>

</div>


    <div class="post-container">
    <div class="post-title-container"><h2 class="post-title">2020-08-16 - Crossing Signal and Arduino</h2>
    <span class="post-cat" title="Category">
            <span class="post-cat-label">Category</span>
            <span class="post-cat-text">Randall</span>
    </span>
    </div>


    <p></p>
<p><span>Jim is getting a </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.walthers.com/modern-cantilever-grade-crossing-signal-single-lane" style="color:inherit;text-decoration:inherit">new crossing signal</a></span><span>&nbsp;for the Fairfield station:</span></p>
<p></p>
<p><span>This is to replace the previous version I did:</span></p>
<p style="text-align:center"><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><iframe width="560" height="315" src="https://www.youtube.com/embed/3ywDCjbAZ-o" frameborder="0" allowfullscreen></iframe></span></p>
<p></p>
<p><span>A bit of history on what happened to the signal that can be seen in the video, and a personal rant:</span></p>
<p style="margin-left:36pt"><span>The old signal and its controller were removed by Marvin Chow when the GGRMC closed in 2015 -- from what I understand, he had donated such a signal a decade or so ago before leaving the club; the signal had failed and I had replaced it, and then he removed the one I had installed without asking anyone, claiming it was his and proceeded to donate it </span><span style="font-style:italic">again</span><span>&nbsp;to the Carquinez MRR. Rather pathetic to even claim to donate something and then take it back with the typical sleazy excuse of “well I didn’t really donate it, it was a loan”... sure. Whatever.</span></p>
<p></p>
<p><span>Anyhow, Jim got a new crossing signal, and we need to power it. Last time I connected it to a </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.logicrailtech.com/xcart/home.php?cat=260" style="color:inherit;text-decoration:inherit">LogicRail Tech</a></span><span>&nbsp;Grade Crossing Pro and its associated Bell sound module. These are the elements that were taken out unceremoniously. I could reuse the same -- they work well, within their limitations, or I could try to make an Arduino version and experiment in the process.</span></p>
<p><span></span></p>
<p></p>
<p><span>We are not getting a controller, at least not the Walthers controller for it: </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.walthers.com/grade-crossing-signal-controller?ref=1" style="color:inherit;text-decoration:inherit">Crossing Signal Controller (949-4359)</a></span><span>. I checked the PDF and this is a typical 4-photoresistor setup, however it also needs a connection to the DC track to know the direction of the train. It expressly indicates it will not work with DCC.</span></p>
<p></p>
<p><span>In my </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/randall/about.html#h.dcct9cs2zllo" style="color:inherit;text-decoration:inherit">plan to redo Fairfield and its automation</a></span><span>, I was planning to also automate the crossing signal. However it makes more sense to build that automation separately. That will result in a more timely process, and it’s easier to simplify problems and deal with them separately.</span></p>
<p></p>
<p><span>I have these choices in mind:</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>Arduino with photo-resistor setup.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>Arduino with Ultrasonic Ranging module HC-SR04.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>Arduino + ESP32-CAM using OpenCV for camera detection of trains.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>Arduino + ESP32-CAM and infrared LEDs.</span></li>
</ul>
<p></p>
<p><span>Let’s explore this. Please keep in mind that I use “Arduino” loosely. By Arduino, I mean any small logic board, either an actual Arduino, or an ESP32, or ESP8266, or anything similar.</span></p>
<p><span>&nbsp;</span></p>
<p></p>
<p><span style="font-weight:700">1- Arduino with photo-resistor setup</span><span>.</span></p>
<p><span>The “trivial” choice is to replicate the typical photo-resistor setup. Crossing modules for model trains typically use 4 sensors -- 2 on each side of the crossing: A / B / &lt;crossing&gt; / C / D. The benefit of this is that the 2 sensors on one side are used to determine the direction of a train. For example sensors must be triggered in the direction of A then B, or D then C… that detects a train is arriving as well as establishes its direction, and signals the start of the flashing sequence. Similarly, the sensors being triggered in the proper direction in the other side trigger the end of the sequence.</span></p>
<p></p>
<p><span>The down side of photo-resistors is that they need to be calibrated for the room illumination, which can vary greatly. For generic control modules, we need to take into account that operators can obscure the sensors or create shadows, or that in a given room lights can be individually turned on or off. At Randall, for the Fairfield crossing we generally don’t have to care about operators casting shadows, however we are at the mercy of the operators or museum staff not turning on all the lights all the time. That’s a frequent occurrence.</span></p>
<p></p>
<p><span>This is typically solved by adding a 5th photo-sensor that is not located between the track, used to measure global illumination of the room. I don’t know many commercial modules which use that, however it is a common setup for DIY arduino-based setups.</span></p>
<p></p>
<p><span>The system needs to account that a photo-resistor may be covered by either one single engine for a very short period of time, or a long train, and space in the cars will create a “pulsing” effect. Thus a fairly high scan rate or some kind of window filter is required here, which any Arduino can trivially achieve -- as long as one keep in mind the idiosyncrasies of different Arduinos or ESP32 ADCs -- see that </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.youtube.com/watch?v=UAJMLTzrM9Q" style="color:inherit;text-decoration:inherit">video from Andreas Spiess on the subject of ADC measurements</a></span><span>.</span></p>
<p></p>
<p><span>A nice side-effect of having 2 sensors on each side is that we can approximate the speed of the incoming train, and potentially use that to delay when to start the crossing signal (modern real crossings try to start their warning at a constant time before the train arrives). </span></p>
<p></p>
<p><span style="font-weight:700">2- Arduino with Ultrasonic Ranging module HC-SR04</span><span>.</span></p>
<p><span>This one is more about “brainstorming” than reality. Could the photo-resistors be omitted and an </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://amzn.to/3390kEt" style="color:inherit;text-decoration:inherit">HC-SR04 module</a></span><span>&nbsp;be used instead? For those not familiar, this is a very typical ultrasonic sensor that comes in many Arduino kits. It’s fairly easy to use -- start a pulse, measure how long it takes for the pulse to bounce back.</span></p>
<p></p>
<p><span>The immediate downside I’d see here is that these modules are fairly bulky -- at least from an HO-model size point of view. A typical sensor is about 1.5~2 inches wide. The other downside is that, from personally playing with some, I find them finicky and not very precise.</span></p>
<p></p>
<p><span>In the case of the Fairfield crossing, I could imagine us having two of these sensors, each looking at opposite sides of the crossing towards oncoming trains. Mounting them maybe ½ or one foot on some support pillars looking at the incoming track. On the track leading from Sultan towards Fairfield, we have the advantage that the scenery + the window barrier creates a “natural” canyon where the incoming train is the only thing that would move. On the side by the Fairfield station, we have the disadvantage that the scenery is an open town and there’s a lot less “tunneling” thus a lot more likelihood to measure some unrelated train. </span></p>
<p></p>
<p><span>The obvious question is whether the small cross section of an HO train would be enough to be detected by the sensor. I’ve played with these before and from memory they were both not precise, nor very sensitive. In particular, one issue was distance is measured by measuring the return pulse width, and that was a fairly noisy process.</span></p>
<p></p>
<p><span style="font-weight:700">3. Arduino + ESP32-CAM using OpenCV for camera detection of trains</span><span>.</span></p>
<p><span>A while ago I was toying with the idea of using a Kinect for train detection. Although prices for this particular device have fallen drastically, most applications require a full computer to process the signal and do something with it via their SDK. In between, there’s been a wide interest into the usage of LIDAR and </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://en.wikipedia.org/wiki/Structured_light" style="color:inherit;text-decoration:inherit">structured light</a></span><span>&nbsp;sensors for depth sensing. Since this started exploding 5-10 years ago, luckily what needed a “full computer” back then can be reduced to a mere Raspberry Pi 4 or similar hardware today. Still the main issues with the tech remain, such as calibration, lighting consistency, and a limited depth range. Even though these solutions make for impressive demos, I am not sure about their long term reliability -- what I want is a solution that requires little to no maintenance, and can run for 300 days/year without calibration.</span></p>
<p></p>
<p><span>Years ago I experimented with using “dumb” </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/blog/train/2018-10-01_cameras_opencv_and_occupancy_d4e79a5c.html" style="color:inherit;text-decoration:inherit">video-based detection by detecting trains masking IR-reflective tape</a></span><span>. No machine learning needed, no complex LIDAR nor </span><span>structured light</span><span>&nbsp;sensor. Processing was no different than using photo-resistors, essentially, however I had the benefit of being able to use cheap ipcams locked in infrared mode -- meaning the system was able to adapt to room illumination </span><span style="font-style:italic">fairly</span><span>&nbsp;easily</span><span>.</span></p>
<p></p>
<p><span>In between I’ve been playing with the </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://amzn.to/2S3Wzd8" style="color:inherit;text-decoration:inherit">ESP32-CAM</a></span><span>, which is a sub-$10 module combining a dual-core processor, and a camera. The camera can do 1600x1200, but more importantly we can do the processing right there in the ESP32 module. Using OpenCV, we can do the same kind of very basic pixel-based motion detection I had in my </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/blog/randall/2020-06-14__train_motion_video_display__d300ac8f.html" style="color:inherit;text-decoration:inherit">recent train-motion video project</a></span><span>. No machine learning is needed here. All we need to do is detect motion against a known path.</span></p>
<p></p>
<p><span>Here’s the ESP32-CAM which I’ve been working with recently and which I’d be using:</span></p>
<p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:0.00px solid #000000;display:inline-block;height:361.33px;margin:0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:796.80px"><img alt="" src="img_bced8a847f00e14dcf95b04c02bd1b23f963bbcb6af8309341a8c05aa3aa78a4i.jpg" style="margin-left:0.00px;margin-top:0.00px" title=""></span><span><br></span><span style="font-style:italic">Left: ESP32-CAM with sdcard and OV2640 camera. 4 MB SPI RAM, 2 cores @ 240 MHz. Wifi + BT.<br>Right: Red board is an USB FTDI adapter. Quarter for size comparison.</span></p>
<p></p>
<p><span>This would work using one or two components. One is the ESP32-CAM, with the camera attached to it. These typically come with a camera attached to a ribbon cable of either ½ inch or 2-3 inches thus the camera cannot be too far from the ESP32. It would have to be mounted high enough to cover the desired area of track on both sides of the sensor.</span></p>
<p><span>To reduce false positives, an initial setup phase would have the operator setup the path of the track on a captured still. This does not need to be too precise, the goal is to be able to separate motion from parallel tracks. In an advanced version we could imagine a setup phase where OpenCV is used to find tracks in the image and let the user select the desired tracks -- yet for an initial version, just drawing a few straight line segments would be good enough. Most notably the setup must identify both sides of the crossing.</span></p>
<p><span>Once that setup is done, we can run basic motion detection to determine where motion happens on that path, and in which direction. From there we can apply the standard crossing signal algorithms.</span></p>
<p></p>
<p><span>One nice thing here is that we don’t need the full camera resolution. Downgrading the image to 800x600 or even 400x300 will result in faster processing for the pixel-based motion detection, yet provide enough detail to detect a single engine or a large train on the track.. We are interested in fast detection rather than visual detail.</span></p>
<p></p>
<p><span>The second component would drive the actual crossing lights. Depending on where the ESP32-CAM needs to be mounted to get a good view, it may not be possible to drive the crossing signal lights from the same ESP32. If possible, it would be great to use a single device, yet we need to account for the fact that may not be an option. In this case a secondary Arduino such as a Nano or another ESP could be used to drive the lights. Communication between both could be achieved using a simple wired connection (raising a signal on a pin, or 2-wire serial port), or via wifi or any other wireless option shared between both modules (such as </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/network/esp_now.html" style="color:inherit;text-decoration:inherit">ESP-NOW</a></span><span>).</span></p>
<p></p>
<p><span>One of my goals is to use a similar setup to create software-defined block detection at the whole layout level.</span></p>
<p></p>
<p><span>Cost wise: An ESP32-CAM is around $10-15, and for the other side an ESP32-S2 is around $8 or cheaper.</span></p>
<p><span>This is my preferred approach for now.</span></p>
<p></p>
<p><span style="font-weight:700">4- Arduino + ESP32-CAM and infrared LEDs</span><span>.</span></p>
<p><span>This is basically the same setup as the Camera + OpenCV version above, except we use the reverse of photo-resistors: infrared LEDs are embedded in the track, 2 on each side of the crossing. Thus instead of measuring ambient light, we use the camera to detect illumination from the track-mounted IR LEDs. When the IR beam is cut, it simply means a train is obscuring the sensor. </span></p>
<p><span>This can be beneficial if we want to narrow the detection area on the image feed. After an initial automated setup phase, the ESP32 could analyze just the location of the IR sensor on the image instead of doing generic motion detection on the whole image.</span></p>
<p><span>With this system, we can trivially automate the setup: when the module starts, it can detect each LED one by one, automatically finding their location in the image -- assuming the ESP32 is controlling these LEDs (directly or indirectly), it can turn them on one by one to identify them. The only fairly reasonable assumption is that the sensors are not covered by a train during that phase (which we can detect since we expect to find 4 IRs LEDs).</span></p>
<p></p>
<p><span>Ironically that is a tad more work to install than the pure camera-based motion detection version as it requires a bit more hardware (namely four extra IR LEDs and their wiring). However the possibility to automate the setup phase makes this particularly attractive and a good step up from the pixel-based motion detection.</span></p>
<p></p>
<p><span style="font-weight:700">5- If all fails</span><span>…</span></p>
<p><span>The nice thing about this R&amp;D is that “failure is an option”. I know I can deliver something using any of the options above. Eventually it’s not just about delivering “something”, it’s about delivering a solid and reliable experience that will not need ongoing maintenance once finalized. </span></p>
<p><span>If all fails, I will revert to the old and trusted </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.logicrailtech.com/xcart/home.php?cat=260" style="color:inherit;text-decoration:inherit">LogicRail Tech</a></span><span>&nbsp;Grade Crossing Pro and its associated Bell sound module. I’ve used these before, I can purchase them again and set them up just as I did before. Cost is around $100 for these.</span></p>
<p></p>
<hr>
<p></p>


    </div>



<div class="prev-next-container">


    <span class="prev-page"><a href="2020-09-27_state_of_projects.html">⇐ Newer Post</a><br/></span>
    <span class="next-page"><a href="2020-06-14__train_motion_video_display__d300ac8f.html">Older Post ⇒</a><br/></span>

</div>

</div> <!-- container -->
</div> <!-- main -->

<div class="sharethis-inline-share-buttons"></div>

<div class="bottom-container">&nbsp;Generated on 2025-09-01 by Rig4j 0.1-Exp-0c45755&nbsp;</div>

</main>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-M1KDMEFC4D"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-M1KDMEFC4D');
</script>

</body>
</html>

