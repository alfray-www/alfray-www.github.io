<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport"    content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author"      content="">

<link href="atom.xml" type="application/atom+xml" rel="alternate" title="Atom feed for Blog: Randall Museum Model Railroad" />

<meta property="og:url"         content="https://www.alfray.com/trains/blog/randall/2018-03-28_error_conditions.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Error Conditions" />

<meta property="og:description" content="Now that we have some basic automation running and, most importantly, some feedback on how it is running, it’s time to account for error conditions. The post from 2018-02-12 did mention that earlier but it was more academic with any actual basis. Now I do have basis:" />
<meta property="og:image"       content="https://www.alfray.com/trains/blog/randall/img_dc83c7b24c1286a1c6ba7ef7c9010f87d28ab93840f732b035c4991b6a80c847i.jpg" />

<meta name="twitter:card"        content="summary" />
<!-- meta name="twitter:site"    content="@flickr" / -->
<meta name="twitter:title"       content="Error Conditions" />

<meta name="twitter:description" content="Now that we have some basic automation running and, most importantly, some feedback on how it is running, it’s time to account for error conditions. The post from 2018-02-12 did mention that earlier but it was more academic with any actual basis. Now I do have basis:" />
<meta name="twitter:image"       content="https://www.alfray.com/trains/blog/randall/img_dc83c7b24c1286a1c6ba7ef7c9010f87d28ab93840f732b035c4991b6a80c847i.jpg" />

<title>Blog: Randall Museum Model Railroad</title>

<script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5c66171070e9220011ed1c61&product=inline-share-buttons" async="async"></script>

<!-- Custom styles for this template -->
<style type="text/css">
body {
    font-family: sans-serif;
    margin: 0;
}

.main {
    margin: 8px;
}

p, span {
    line-height: 1.2;
    text-align: justify;
}

p.console {
    margin: 0;
    padding: 0;
}

.container {
    max-width: 95%;
}

@media screen and (min-width: 600px) {
    .container {
        max-width: 60rem;
    }
}

.center-horiz {
    margin: auto;
}

.no-margin-container {
}

/* Header + Title */
.blog-header {
  margin-bottom: 3rem;
  background-color: #428bca;
  box-shadow: inset 0 -.1rem .25rem rgba(0,0,0,.1);
}


.banner-bg-image {
    height: 50px;
    background-image: url("header.jpg");
    background-position: center;
    background-size: 100% auto;
}

@media screen and (min-width: 600px) {
    .banner-bg-image {
        height: 200px;
    }
}


.title-container {
    color: #fff;
    padding: 1rem;
    line-height: 1.5;
    font-weight: 500;
    font-size: 24px;
    font-family: sans-serif;
}

.title-container a {
    color: #fff;
    text-decoration: none;
}

.post-container {
}

.bottom-container {
    margin-top: 8px;
    color: #fff;
    background-color: #428bca;
    font-family: sans-serif;
    text-align: center;
    font-size: small;
    line-height: 1rem;
}

@media screen and (min-width: 600px) {
    .bottom-container {
        font-size: x-small;
    }
}

.post-title-container {
    position: relative;
    background-color: #428bca;
    padding: 0.5rem;
}

.post-title {
    display: inline;
    color: #fff;
    font-weight: 500;
    font-family: sans-serif;
    font-size: 1.5em;
}

a.post-title-link {
    color: #fff;
    text-decoration: none;
}

.post-cat {
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    padding: 0.25rem;
    background-color: #d0e0e3;
    color: #000;
    font-weight: 500;
    font-family: sans-serif;
    font-size: 1.5em;
}

a.post-cat-link {
    color: #000;
    text-decoration: none;
}

.post-cat-label {
    display: block;
    text-align: right;
    color: #000;
    font-size: 0.4em;
}

.prev-next-container {
    overflow: auto;
}

.prev-page {
    float: left;
    line-height: 2em;
}

.next-page {
    float: right;
    line-height: 2em;
}

h1, h2, h3, h4, h5, h6 {
    font-family: sans-serif;
    font-weight: bold;
}

.text-hide {
    font: 0/0 a;
    color: transparent;
    text-shadow: none;
    background-color: transparent;
    border: 0;
}

td p {
    margin: 0;
}


</style>
</head>

<body>

<header class="blog-header">

    <div class="no-margin-container banner-bg-image text-hide">
        Site Banner Image
    </div>

    <div class="title-container">
        <a href="https://www.alfray.com/trains/">Ralf's Train Pages</a>
        
        /
        <a href="0017.html">Blog: Randall Museum Model Railroad</a>
        
    </div>
</header>

<main role="main">
<div class="main">
<div class="container center-horiz">

<p><span> </span></p>
<p><span></span></p>
<p><span> </span></p>
<table style="border-collapse:collapse;border-spacing:0;margin-left:auto;margin-right:auto">
 <tbody>
  <tr style="height:0pt">
   <td colspan="1" rowspan="1" style="background-color:rgb(103, 78, 167);border-bottom-color:rgb(255, 255, 255);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(255, 255, 255);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(255, 255, 255);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(255, 255, 255);border-top-style:solid;border-top-width:1pt;padding:7.2pt 7.2pt 7.2pt 7.2pt;vertical-align:top;width:119.5pt"><p style="text-align:center"><span style="-webkit-text-decoration-skip:none;color:rgb(255, 217, 102);font-size:14pt;font-weight:700;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/randall/index.html" style="color:inherit;text-decoration:inherit">Introduction</a></span></p></td>
   <td colspan="1" rowspan="1" style="background-color:rgb(103, 78, 167);border-bottom-color:rgb(255, 255, 255);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(255, 255, 255);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(255, 255, 255);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(255, 255, 255);border-top-style:solid;border-top-width:1pt;padding:7.2pt 7.2pt 7.2pt 7.2pt;vertical-align:top;width:119.5pt"><p style="text-align:center"><span style="-webkit-text-decoration-skip:none;color:rgb(255, 217, 102);font-size:14pt;font-weight:700;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/blog/randall/" style="color:inherit;text-decoration:inherit">Blog &amp; News</a></span></p></td>
   <td colspan="1" rowspan="1" style="background-color:rgb(103, 78, 167);border-bottom-color:rgb(255, 255, 255);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(255, 255, 255);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(255, 255, 255);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(255, 255, 255);border-top-style:solid;border-top-width:1pt;padding:7.2pt 7.2pt 7.2pt 7.2pt;vertical-align:top;width:119.5pt"><p style="text-align:center"><span style="-webkit-text-decoration-skip:none;color:rgb(255, 217, 102);font-size:14pt;font-weight:700;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/randall/about.html" style="color:inherit;text-decoration:inherit">About the Model Railroad</a></span></p></td>
   <td colspan="1" rowspan="1" style="background-color:rgb(103, 78, 167);border-bottom-color:rgb(255, 255, 255);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(255, 255, 255);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(255, 255, 255);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(255, 255, 255);border-top-style:solid;border-top-width:1pt;padding:7.2pt 7.2pt 7.2pt 7.2pt;vertical-align:top;width:119.5pt"><p style="text-align:center"><span style="-webkit-text-decoration-skip:none;color:rgb(255, 217, 102);font-size:14pt;font-weight:700;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/randall/rtac.html" style="color:inherit;text-decoration:inherit">RTAC Software</a></span></p></td>
   <td colspan="1" rowspan="1" style="background-color:rgb(103, 78, 167);border-bottom-color:rgb(255, 255, 255);border-bottom-style:solid;border-bottom-width:1pt;border-left-color:rgb(255, 255, 255);border-left-style:solid;border-left-width:1pt;border-right-color:rgb(255, 255, 255);border-right-style:solid;border-right-width:1pt;border-top-color:rgb(255, 255, 255);border-top-style:solid;border-top-width:1pt;padding:7.2pt 7.2pt 7.2pt 7.2pt;vertical-align:top;width:119.5pt"><p style="text-align:center"><span style="-webkit-text-decoration-skip:none;color:rgb(255, 217, 102);font-size:14pt;font-weight:700;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/randall/videos.html" style="color:inherit;text-decoration:inherit">Videos</a></span></p></td>
  </tr>
 </tbody>
</table>
<p></p>
<p><span style="font-style:italic">The Randall Museum in San Francisco hosts a large HO-scale model railroad. Created by the </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);font-style:italic;text-decoration:underline;text-decoration-skip-ink:none"><a href="http://www.ggmrc.org" style="color:inherit;text-decoration:inherit">Golden Gate Model Railroad Club</a></span><span style="font-style:italic">&nbsp;starting in 1961, the layout was donated to the Museum in 2015. Since then I have started automatizing trains running on the layout. I am also the model railroad maintainer. </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);font-style:italic;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/blog/randall/" style="color:inherit;text-decoration:inherit">This blog</a></span><span style="font-style:italic">&nbsp;describes various updates on the Randall project and I maintain a separate </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);font-style:italic;text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.alfray.com/trains/blog/train/" style="color:inherit;text-decoration:inherit">blog for all my electronics</a></span><span style="font-style:italic">&nbsp;not directly related to Randall. </span><span></span></p>

<div class="prev-next-container">


    <span class="prev-page"><a href="2018-03-30_doodlebug.html">⇐ Newer Post</a><br/></span>
    <span class="next-page"><a href="2018-02-28_atlas_master_amtrak_ge_dash_8-32bwh.html">Older Post ⇒</a><br/></span>

</div>


    <div class="post-container">
    <div class="post-title-container"><h2 class="post-title">2018-03-28 - Error Conditions</h2>
    <span class="post-cat" title="Category">
            <span class="post-cat-label">Category</span>
            <span class="post-cat-text">Randall</span>
    </span>
    </div>


    <p><span>Now that we have some basic automation running and, most importantly, some feedback on how it is running, it’s time to account for error conditions. The post from 2018-02-12 did mention that earlier but it was more academic with any actual basis. Now I do have basis:</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>On the Branchline, a repeated issue is the RDC failing to stop and reverse on the reverse block.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>Now that the RDC is moved to the mainline, I did experience the same issue at least once. However that’s not clear cut as in this instance I was also trying to update/restart RTAC remotely. It happened in a second instance for the RDC.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>At least once the same issue happened with the Amtrak train.</span></li>
</ul>
<p></p>
<p><span>That picture is, ironically, exactly what I want to avoid and which happened:</span></p>
<p style="text-align:center"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:0.00px solid #000000;display:inline-block;height:325.00px;margin:0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:578.00px"><img alt="" src="img_dc83c7b24c1286a1c6ba7ef7c9010f87d28ab93840f732b035c4991b6a80c847i.jpg" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p>
<p></p>
<p><span>In trains parlance, this is called a runaway.</span></p>
<p></p>
<p><span></span></p>
<p><span>There is an obvious yet naive way to avoid this specific kind of runaway: turn blocks off at the boundaries of the automation. So if a train overshoots its stopping or reversal point, it will run in the dead block and natural stop. This “solution” has its share of issues though:</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>The mainline passenger train is a push-pull configuration. Entering a dead block means the lead engine will stop being powered and the rear engine will continue pushing. That is an ideal condition to make the whole train derail by pushing on the coaches in the middle. As a side effect, if the rear engine does not also reach the dead block, it will try to keep rolling yet be stationary, thus creating wear on wheels and track.</span></li>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>The automation is not detecting or fixing the condition. This relies on a human report that “something went wrong” and implies human intervention to fix the situation.</span></li>
</ul>
<p><span>So turning blocks off is maybe a possible failsafe scenario, yet one to be used sparingly understanding it’s not ideal.</span></p>
<p></p>
<p><span>One goal is to keep the automation simple. Too many fancy rules makes it harder to understand and/or predict what is going on for a human observer. We can’t expect to have an exhaustive set of error conditions to detect, as by definition the impredictible cannot be predicted and these are not life-threatening scenario. Worse case, the museum automation is broken for a few days or a week. </span></p>
<p></p>
<p><span>So what kind of error can we reasonably expect, and which ones can we detect, and can we fix them?</span></p>
<ul style="margin:0">
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>Train fails to stop at the expected block. </span></li>
 <ul>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>This can be seen with the Rapido RDC failing to stop at the reverse block and overshooting that block. </span></li>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>The error condition is detecting the train in the next block. My original planning was to do that for the station where trains stop by wiring a block detector on an extra block; Also turnouts need to be aligned at the same time (to avoid shorting against a turntout). </span></li>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>The fix would be in the automation to e-stop that train and reverse it to its expected location.</span></li>
 </ul>
 <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>Train failing to reach an expected next block or staying on the current block for too long. &nbsp;</span></li>
 <ul>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>This could be due to the train derailing in between or a sensor malfunction.</span></li>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>The error condition is having a timer on how long the train should be in the current block and how long before it reaches the next block. The timing should be generous enough to account for fluctuations.</span></li>
  <li style="line-height:1.15;padding-bottom:0pt;padding-left:0pt;padding-top:0pt"><span>There is no likely fix in that case except issue an e-stop to the train and wait for manual intervention.</span></li>
 </ul>
</ul>
<p></p>
<p><span>The RDC overshooting the reverse block could also be addressed using a timer. Trying to detect the “next” block may be counter-productive. For example on the branchline I can wire the next block, but I’m unlikely to detect the whole branchline, so eventually there’s always going to be a “next block” that has no detection.</span></p>
<p></p>
<p><span>On the station tracks, trying to detect the next block might also be counter-productive. Each station track starts with one turnout, a short block (about 1 foot), the main station block, another short block, and another turnout. “Ideally” I just need to detect each short block, but these blocks might actually be a tad too short. The Amtrak train makes it relatively easy since it’s composed of two engines in push-pull with three lighted cars in the middle so the whole train can be detected. However a short engine like the RDC can easily run over that block before we get a chance to detect it as the JMRI / NCE-AIU sampling time is quite slow.</span></p>
<p></p>
<p><span>Generally speaking we can model the train route as a succession of blocks, including gaps. Turnouts should be preset so that the train does not foul or run against a turnout if it overshoots its stopping blocks. In that case, given a model of the route and the known travel direction of the train, we can detect the train has been on the end-route block and is not on the block anymore. In that case, issue an e-stop followed by a reversal should “logically” bring the train back into the expected end-route block. This should be combined with a timer, e.g. if the train does not reach the expected block back within some time, issue an e-stop, stop the automation, and ask for manual intervention.</span></p>
<p></p>
<hr>
<p></p>


    </div>



<div class="prev-next-container">


    <span class="prev-page"><a href="2018-03-30_doodlebug.html">⇐ Newer Post</a><br/></span>
    <span class="next-page"><a href="2018-02-28_atlas_master_amtrak_ge_dash_8-32bwh.html">Older Post ⇒</a><br/></span>

</div>

</div> <!-- container -->
</div> <!-- main -->

<div class="sharethis-inline-share-buttons"></div>

<div class="bottom-container">&nbsp;Generated on 2025-09-04 by Rig4j 0.1-Exp-05cc7b2&nbsp;</div>

</main>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-M1KDMEFC4D"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-M1KDMEFC4D');
</script>

</body>
</html>

