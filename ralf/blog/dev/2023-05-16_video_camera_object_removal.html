<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport"    content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author"      content="">

<link href="atom.xml" type="application/atom+xml" rel="alternate" title="Atom feed for R’alf Dev Log" />

<meta property="og:url"         content="http://www.alfray.com/ralf/blog/dev/2023-05-16_video_camera_object_removal.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="Video Camera Object Removal" />

<meta property="og:description" content="Filming trains with the video car pulled by my “extended” coupler leaves that coupler visible on screen. It’s a tad distracting." />


<meta name="twitter:card"        content="summary" />
<!-- meta name="twitter:site"    content="@flickr" / -->
<meta name="twitter:title"       content="Video Camera Object Removal" />

<meta name="twitter:description" content="Filming trains with the video car pulled by my “extended” coupler leaves that coupler visible on screen. It’s a tad distracting." />


<title>R’alf Dev Log</title>


<!-- custom fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Workbench&display=swap" rel="stylesheet">

<!-- Custom styles for this template -->
<style type="text/css">
body {
    font-family: "Workbench", monospace;
    margin: 0;
    background: #000;
    color: #0A0;

    font-optical-sizing: auto;
    font-weight: 200;
    font-style: normal;
    font-variation-settings: "BLED" 0, "SCAN" 10;
}

.main {
    margin: 8px;
}

p, span {
    line-height: 1.2;
    text-align: justify;
}

p.console {
    margin: 0;
    padding: 0;
}

.container {
    max-width: 95%;
}

@media screen and (min-width: 600px) {
    .container {
        max-width: 60rem;
    }
}

.center-horiz {
    margin: auto;
}

.no-margin-container {
}

/* Header + Title */
.blog-header {
  margin-bottom: 3rem;
  background-color: #060;
  box-shadow: inset 0 -.1rem .25rem rgba(0,0,0,.1);
}



.title-container {
    color: #FF0;
    padding: 1rem;
    line-height: 1.5;
    font-weight: 500;
    font-size: 24px;
}

.title-container a {
    color: #FF0;
    text-decoration: none;
}

.post-container {
}

.bottom-container {
    margin-top: 8px;
    color: #FF0;
    background-color: #060;
    text-align: center;
    font-size: small;
    line-height: 1rem;
}

@media screen and (min-width: 600px) {
    .bottom-container {
        font-size: x-small;
    }
}

.post-title-container {
    position: relative;
    background-color: #060;
    padding: 0.5rem;
}

.post-title {
    display: inline;
    color: #FF0;
    font-weight: 500;
    font-size: 1.5em;
}

a.post-title-link {
    color: #FF0;
    text-decoration: none;
}

.post-cat {
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    padding: 0.25rem;
    background-color: #d0e0e3;
    color: #000;
    font-weight: 500;
    font-size: 1.5em;
}

a.post-cat-link {
    color: #000;
    text-decoration: none;
}

.post-cat-label {
    display: block;
    text-align: right;
    color: #000;
    font-size: 0.4em;
}

.prev-next-container {
    overflow: auto;
}

.prev-page {
    float: left;
    line-height: 2em;
}

.next-page {
    float: right;
    line-height: 2em;
}

h1, h2, h3, h4, h5, h6 {
    font-weight: bold;
}

.text-hide {
    font: 0/0 a;
    color: transparent;
    text-shadow: none;
    background-color: transparent;
    border: 0;
}

td p {
    margin: 0;
}


</style>
</head>

<body>

<header class="blog-header">

    <div class="title-container">
        <a href="http://www.alfray.com/ralf/">Ralf's Home Page</a>
        
        /
        <a href="0003.html">R’alf Dev Log</a>
        
    </div>
</header>

<main role="main">
<div class="main">
<div class="container center-horiz">

<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt"> </span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt"></span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt"> </span></p>
<p style="text-align:left"><span style="font-style:italic">The place where random ideas get written down and lost in time</span><span style="font-family:&quot;Workbench&quot;;font-size:12pt">.</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt"></span></p>

<div class="prev-next-container">


    <span class="prev-page"><a href="2023-05-17_davinci_fusion_plugin.html">⇐ Newer Post</a><br/></span>
    <span class="next-page"><a href="2023-02-24_mqtt.html">Older Post ⇒</a><br/></span>

</div>


    <div class="post-container">
    <div class="post-title-container"><h2 class="post-title">2023-05-16 - Video Camera Object Removal</h2>
    <span class="post-cat" title="Category">
            <span class="post-cat-label">Category</span>
            <span class="post-cat-text">DEV</span>
    </span>
    </div>


    <p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Filming trains with the video car pulled by my “extended” coupler leaves that coupler visible on screen. It’s a tad distracting.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">One question I had is: Can I write a Fusion plugin that would “erase” this object?</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Let’s look at the obvious part: how would I erase this object?</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">We can split the problem in two: how to detect the object, and how to erase it.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">First, the “coupler” appears as a gray-ish rectangle. It always touches the bottom edge of the screen and extends upwards. It’s roughly centered horizontally, but can move left and right as the train takes on curves. If we had to modify a movie frame by frame, one optimization would be on a given frame the coupler will very close to its position in the previous frame.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">The coupler is more or less a vertical rectangle.</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">If we were operating as a plugin in Fusion, ideally we could use a 2d ui crosshair to define its initial position, but we would also have to deal with the fact it moves slowly from frame to frame, and tracking would be ideal.</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">If we were operating as command-line script without UI, the initial position could be given as parameters.</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Its width is constant. It tapers as it gets farther from the camera, but overall we could parametrize the max/min width we are looking for -- e.g. what looks like a vertical gray box of W pixels wide and at least H pixels height starting from the bottom of the screen, roughly centered?</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">If we have a UI giving us a starting pixel position, we can use a basic flood algorithm to detect the boundaries.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">When looking at a still image capture, the coupler edges are naturally fuzzy. We cannot expect a stark transition between the coupler and its background. However we can parametrize this, as typically the fuzzy border will have a predictable width.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Although the coupler is mostly of the same gray color, that color can vary depending on illumination, not to mention tunnels, and there’s bound to be shade variation across the length of the object.</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">One option is to look at the image in HSL -- the coupler being gray should not have a hue.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Assuming we can detect the coupler, how do we “erase” it?</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">One suggestion is to treat the coupler as a mask of width W:</span></p>
<ul style="margin:0">
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Shift the image horizontally left and right by W pixels.</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Merge this over the coupler using an averaging algorithm.</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Using the luminance as the coefficient to merge it.</span></li>
</ul>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Assuming this works for one image, the obvious concern is how will it look once applied to a 30 fps movie? We may need to do some temporal averaging -- that is apply a percentage of the last frame to smooth the output.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Implementation wise, why kind of framework would be used?</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">One option is to make a standalone processing app, either in Java/Kotlin/C++, with its own movie decoding + UI rendering. The input movie decoding would take advantage of either ffmpeg or vlc as libraries or avcodec on linux. Similarly this can write a movie result on the fly.</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">In this mode, we would convert a raw footage upfront -- cam files ar 10 minutes long.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">The other option is to use a Fusion plugin as the framework -- in this case Fusion provides the input and the output. Debugging seems potentially more challenging this way. The Fuse SDK doc indicates the Lua code can be reloaded “live” to ease debugging. This has the side benefit that we can judge performance immediately, and that we can take advantage of the fuse UI widgets to e.g. select the initial position to look at or to select some parameters (width, blending, etc).</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">In this mode, we could apply the tool to only the segments being rendered in the final production rather than on the entire raw footage.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">One thing I don’t see in the Fuse SDK is a way for a “tool” to incrementally operate across frames in an animation. We want to do some basic tracking of the coupler position, and it would be nice if it could be automated. The other option is to simply animate the initial position, and/or to use a planar tracker to define it.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="height:12pt;text-align:left"></p>
<p style="height:12pt;text-align:left"></p>
<hr>
<p style="height:12pt;text-align:left"></p>


    </div>



<div class="prev-next-container">


    <span class="prev-page"><a href="2023-05-17_davinci_fusion_plugin.html">⇐ Newer Post</a><br/></span>
    <span class="next-page"><a href="2023-02-24_mqtt.html">Older Post ⇒</a><br/></span>

</div>

</div> <!-- container -->
</div> <!-- main -->

<div class="bottom-container">&nbsp;Generated on 2025-09-02 by Rig4j 0.1-Exp-05cc7b2&nbsp;</div>

</main>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-GCEQ33G1MB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-GCEQ33G1MB');
</script>

</body>
</html>

