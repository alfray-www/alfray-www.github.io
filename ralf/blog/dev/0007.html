<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport"    content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author"      content="">

<link href="atom.xml" type="application/atom+xml" rel="alternate" title="Atom feed for R’alf Dev Log" />

<meta property="og:url"         content="http://www.alfray.com/ralf/blog/dev/0007.html" />
<meta property="og:type"        content="article" />

<meta property="og:title"       content="R’alf Dev Log" />
<meta property="og:description" content="Guess what… I’m in PA and I already want to add a couple features to Bearing:" />
<meta property="og:image"       content="http://www.alfray.com/ralf/blog/dev/img_1c371a8c748fd0f0f687b8d2cabc153f90a908dc96beebcb6365a4b002645ccai.png" />

<meta name="twitter:card"        content="summary" />
<!-- meta name="twitter:site"    content="@flickr" / -->

<meta name="twitter:title"       content="R’alf Dev Log" />
<meta name="twitter:description" content="Guess what… I’m in PA and I already want to add a couple features to Bearing:" />
<meta name="twitter:image"       content="http://www.alfray.com/ralf/blog/dev/img_1c371a8c748fd0f0f687b8d2cabc153f90a908dc96beebcb6365a4b002645ccai.png" />

<title>R’alf Dev Log</title>


<!-- custom fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Workbench&display=swap" rel="stylesheet">

<!-- Custom styles for this template -->
<style type="text/css">
body {
    font-family: "Workbench", monospace;
    margin: 0;
    background: #000;
    color: #0A0;

    font-optical-sizing: auto;
    font-weight: 200;
    font-style: normal;
    font-variation-settings: "BLED" 0, "SCAN" 10;
}

.main {
    margin: 8px;
}

p, span {
    line-height: 1.2;
    text-align: justify;
}

p.console {
    margin: 0;
    padding: 0;
}

.container {
    max-width: 95%;
}

@media screen and (min-width: 600px) {
    .container {
        max-width: 60rem;
    }
}

.center-horiz {
    margin: auto;
}

.no-margin-container {
}

/* Header + Title */
.blog-header {
  margin-bottom: 3rem;
  background-color: #060;
  box-shadow: inset 0 -.1rem .25rem rgba(0,0,0,.1);
}



.title-container {
    color: #FF0;
    padding: 1rem;
    line-height: 1.5;
    font-weight: 500;
    font-size: 24px;
}

.title-container a {
    color: #FF0;
    text-decoration: none;
}

.post-container {
}

.bottom-container {
    margin-top: 8px;
    color: #FF0;
    background-color: #060;
    text-align: center;
    font-size: small;
    line-height: 1rem;
}

@media screen and (min-width: 600px) {
    .bottom-container {
        font-size: x-small;
    }
}

.post-title-container {
    position: relative;
    background-color: #060;
    padding: 0.5rem;
}

.post-title {
    display: inline;
    color: #FF0;
    font-weight: 500;
    font-size: 1.5em;
}

a.post-title-link {
    color: #FF0;
    text-decoration: none;
}

.post-cat {
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    padding: 0.25rem;
    background-color: #d0e0e3;
    color: #000;
    font-weight: 500;
    font-size: 1.5em;
}

a.post-cat-link {
    color: #000;
    text-decoration: none;
}

.post-cat-label {
    display: block;
    text-align: right;
    color: #000;
    font-size: 0.4em;
}

.prev-next-container {
    overflow: auto;
}

.prev-page {
    float: left;
    line-height: 2em;
}

.next-page {
    float: right;
    line-height: 2em;
}

h1, h2, h3, h4, h5, h6 {
    font-weight: bold;
}

.text-hide {
    font: 0/0 a;
    color: transparent;
    text-shadow: none;
    background-color: transparent;
    border: 0;
}

td p {
    margin: 0;
}


</style>
</head>

<body>

<header class="blog-header">

    <div class="title-container">
        <a href="http://www.alfray.com/ralf/">Ralf's Home Page</a>
        
        /
        <a href="0007.html">R’alf Dev Log</a>
        
    </div>
</header>

<main role="main">
<div class="main">
<div class="container center-horiz">

<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt"> </span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt"></span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt"> </span></p>
<p style="text-align:left"><span style="font-style:italic">The place where random ideas get written down and lost in time</span><span style="font-family:&quot;Workbench&quot;;font-size:12pt">.</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt"></span></p>

<div class="prev-next-container">

    <span class="prev-page"><a href="0006.html">⇐ Newer Posts</a><br/></span>
    <span class="next-page"><a href="0008.html">Older Posts ⇒</a><br/></span>


</div>



    <div class="post-container">
<div class="post-title-container">
<a class="post-title-link" href="2021-08-02_summer_project_bearing.html">
    <h2 class="post-title">2021-08-02 - Summer Project: Bearing</h2>
</a>
<span class="post-cat" title="Category">
    <span class="post-cat-label">Category</span>
    <span class="post-cat-text">
    
    <a class="post-cat-link" href="../../blog/dev" title="View All Category Posts">DEV</a>
    </span>
</span></div>

<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Guess what… I’m in PA and I already want to add a couple features to Bearing:</span></p>
<ul style="margin:0">
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Create a marked location list + auto save/load.</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">When marking a location:</span></li>
 <ul>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Add it to the list. Names a “Location 1…” + auto-inc (use list length).</span></li>
  <ul>
   <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">TBD later ⇒ dialog to edit name before adding it + cancel.</span></li>
   <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">But to get started, generate name automatically.</span></li>
  </ul>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Display name in small font below marked location.</span></li>
 </ul>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Add a little “3-dot menu” on the “Marked Loc” line. Popup a menu:</span></li>
 <ul>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Recall / Edit… &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒ goes to marked loc fragment (see below). &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[done]</span></li>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Share… &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒ share location as text/etc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[done]</span></li>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="-webkit-text-decoration-skip:none;text-decoration:line-through;text-decoration-skip-ink:none">V2: Rename… &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒ dialog with one text edit field</span><span style="font-family:&quot;Workbench&quot;;font-size:12pt">.</span></li>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="-webkit-text-decoration-skip:none;text-decoration:line-through;text-decoration-skip-ink:none">V2: Save &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⇒ enabled/visible if marked loc is not in current list (e.g. upgrade or deleted)</span><span style="font-family:&quot;Workbench&quot;;font-size:12pt">.</span></li>
 </ul>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Share bearing (as text, to google maps).&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[done]</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Marked locs fragment:</span></li>
 <ul>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Reuse the current pattern (fragments in a single activity).&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[done]</span></li>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Simple text list. Select an item : [Delete] / [Recall] / [Rename (v2)].&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[done]</span></li>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">List items: GPS loc + date/time + name on 2nd line.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[done]</span></li>
  <ul>
   <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">V1: Not listing the time</span></li>
  </ul>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Delete with confirmation ⇒ does not remove current marked loc. &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[done]</span></li>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Recall: honor the pref setting “ask before override marked loc”.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[done]</span></li>
  <ul>
   <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Recall would erase the current mark loc,</span></li>
   <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Then go directly to the compass view.</span></li>
  </ul>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">V2: Share selected mark.</span></li>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">V2: Export all marks as text.</span></li>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">V2 or +: reorder, rename.</span></li>
 </ul>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Consider renaming “marked locations” to “waypoints”?</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Split screen:</span></li>
 <ul>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Bottom is list view</span></li>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">V2: top is map view of selected list item.</span></li>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">V2: top is detail info for item. Name edit field to rename. Trash icon for delete with confirmation. Eye or compass icon to make it the mark in compass.</span></li>
 </ul>
</ul>
<p style="height:12pt;text-align:left"></p>
<p style="height:12pt;text-align:left"></p>
<hr>
<p style="height:12pt;text-align:left"></p>


</div>
<div class="post-container">
<div class="post-title-container">
<a class="post-title-link" href="2021-02-17_esp32_learning_mqtt.html">
    <h2 class="post-title">2021-02-17 - ESP32 Learning: MQTT</h2>
</a>
<span class="post-cat" title="Category">
    <span class="post-cat-label">Category</span>
    <span class="post-cat-text">
    
    <a class="post-cat-link" href="../../blog/dev" title="View All Category Posts">DEV</a>
    </span>
</span></div>

<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">This is something I need to look into at some point: MQTT to send messages between ESP32 nodes on a local network. </span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">There’s a group (MQTT4MR) that uses that to control sensors via JMRI (instead of C/MRI over RS485 wires).</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">MQTT is also used typically with LoRa and such for larger distance networks, I believe using brokers/hubs. However that’s not really my first usage.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://learn.adafruit.com/mqtt-adafruit-io-and-you?view=all" style="color:inherit;text-decoration:inherit">https://learn.adafruit.com/mqtt-adafruit-io-and-you?view=all</a></span><span style="font-family:&quot;Workbench&quot;;font-size:12pt">&nbsp;MQTT very high overview:</span></p>
<ul style="margin:0">
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Designed for sensors … small payloads, infrequent data, not heavy streams.</span></li>
 <ul>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Which is why it works well with LoRa (bandwidth vs distance, pick one).</span></li>
 </ul>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">It’s a N-to-1 design: one server somewhere, multiple clients.</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Either one device acts as a server, or a “broker” app/script runs on a network computer.</span></li>
 <ul>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">JMRI uses the latter design for obvious reasons.</span></li>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">There are internet-wide brokers like adafruit.io</span></li>
 </ul>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">To connect to a broker, need server/ip, port, username, and a key.</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">The whole concept is a pub-sub:</span></li>
 <ul>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Devices publish to the server.</span></li>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Devices subscribe to the server.</span></li>
 </ul>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Subscribers need to send a ping (e.g. every 5 minutes).</span></li>
 <ul>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Failing to ping disconnects the device.</span></li>
 </ul>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Adafruit_MQTT is such a lib for arduino.</span></li>
 <ul>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">They warn it’s single-duplex: a subscription message would be lost if the device is transmitting (ping or publication) at the same time.</span></li>
 </ul>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Quality-of-service:</span></li>
 <ul>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">QOS 0 = send publication message without checking they arrived.</span></li>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">QOS 1 = send publication message with an OK / ack.</span></li>
 </ul>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">A “will” is a message defined such that the broker sends it when the client disconnects.</span></li>
</ul>
<p style="height:12pt;text-align:left"></p>
<p style="height:12pt;text-align:left"></p>
<p style="height:12pt;text-align:left"></p>
<hr>
<p style="height:12pt;text-align:left"></p>


</div>
<div class="post-container">
<div class="post-title-container">
<a class="post-title-link" href="2021-02-07_conductor2_kotlin_vs_groovy_again.html">
    <h2 class="post-title">2021-02-07 - Conductor2… Kotlin vs Groovy again</h2>
</a>
<span class="post-cat" title="Category">
    <span class="post-cat-label">Category</span>
    <span class="post-cat-text">
    
    <a class="post-cat-link" href="../../blog/dev" title="View All Category Posts">DEV</a>
    </span>
</span></div>

<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">It’s been 2 years now that I started the rewrite of Conductor 2. Back then I chose Groovy, after trying Kotlin and deciding it wasn’t mature enough. In between, Kotlin usage has expanded a lot, so time to revisit.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">(N.D.L.R.: the goal of the Conductor 2 project is to replace the custom language from Conductor 1 by a new DSL based on top of Groovy, or Kotlin. That would allow the script to have more flexibility.)</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Overall Conductor2 with Groovy would work. Although the engine isn’t 100% operational, I rewrote most of the main automation script using Groovy and I updated it to a few new concepts that I miss in my current custom language. </span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">The Conductor 2 design doc has more details on the new syntax.</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Through the implementation, I evolved the syntax.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">In conductor 1, we have basically a “global” namespace of “conditions --&gt; actions”.</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">These can be expressed in the Groovy script using:</span></p>
<p style="margin-left:36pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">On { closure expression return a boolean } --&gt; { actions block }</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">However I later rewrote the script to be more oriented for each route / block.</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">A route is defined as a sequence of blocks that must be traversed, and there are actions for each block. This avoids the soup of global state variables that must be maintained in Conductor 1 to achieve the same thing (e.g. “passenger train on this block going forward”). The new syntax looks like this:</span></p>
<p style="margin-left:36pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Name = route {</span></p>
<p style="margin-left:36pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Route = [</span></p>
<p style="margin-left:36pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;BlockNumber.forward {</span></p>
<p style="margin-left:36pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;onStart { actions }</span></p>
<p style="margin-left:36pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;onEnter { actions } then_after delay { actions }</span></p>
<p style="margin-left:36pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;after delay { actions } then_after delay { actions }</span></p>
<p style="margin-left:36pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">} ] }</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">This scheme basically encodes most of the complexity in Conductor 1’s script, which is using timers and global state to limit actions to certain routes/blocks/directions.</span></p>
<p style="text-align:left"><span style="background-color:rgb(255, 255, 0)"></span></p>

<a href="2021-02-07_conductor2_kotlin_vs_groovy_again.html">Click here to continue reading...</a>
<p/>
<hr/>
</div>
<div class="post-container">
<div class="post-title-container">
<a class="post-title-link" href="2020-12-18_kotlin_and_rust.html">
    <h2 class="post-title">2020-12-18 - Kotlin and Rust</h2>
</a>
<span class="post-cat" title="Category">
    <span class="post-cat-label">Category</span>
    <span class="post-cat-text">
    
    <a class="post-cat-link" href="../../blog/dev" title="View All Category Posts">DEV</a>
    </span>
</span></div>

<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">I keep circling back to these and I think it’s time I consider some “real” project for it.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">I tried Rust for rig4, and I wasn’t impressed. I think of C and Rust as “embedded” development languages, not server ones.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">In fact the main reason I’ve never been impressed by neither Kotlin nor Rust is the debilitating amount of hype around them. Rust, like Go, has a lot of idiosyncrasies, not to mention arbitrary conventions on what should go where. It seems to be the new trend to endocrine the structure at the compiler level.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">I see Kotlin as pure hype. There’s nothing Kotlin seems to add that can’t be done in plain ol’ Java. Software engineers are kids, they always look at shiny new toys and disregard the perfectly valid ones they already have.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">So anyhow, are there serious projects I can try to slowly accomplish on both? Ideally they would not be long-term projects, quick yet good enough to get some real sense of the languages and move on?</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Wannabe projects I have around:</span></p>
<ul style="margin:0">
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">ESP32 grade crossing. Would be ideal for Rust, except I don’t see good ESP32 support.</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Conductor 2… Currently Groovy + Java. Could use Kotlin as a DSL instead of Groovy.</span></li>
 <ul>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">I did try Kotlin back then but its DSL was not enough for my needs.</span></li>
 </ul>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Rig4… Currently Java, with a (failed?) attempt at Rust. Could be using Kotlin.</span></li>
</ul>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">One of the new directions for Rig4 is to have 2 tools (fetch + produce) so it’s possible for each to be in their own language. Seems a bit messy and quite undesirable though. If anything, it means dealing with two toolchains.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">On the Android side, I have no immediate small project. Otherwise Kotlin would be a good choice there. I have some small game idea, and those would be in Godot / GDScript likely.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">There seems to be something for ESP32 with Rust:</span></p>
<ul style="margin:0">
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">https://github.com/esp-rs</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">https://github.com/MabezDev/rust-xtensa </span></li>
</ul>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">But one thing to remember is that I don’t just want “Rust on ESP32” (via llvmc, why not). What I really want is the Espressif SDK w/ &nbsp;FreeRTOS API, and e.g. access to the camera, hardware, etc. As the project author says “I've laid the compiler ground work, it's simply a case of writing the drivers and HAL's for it”, but really that’s the most important part of the project, there’s nothing of a “simple case” here. Without that, there’s an obvious chicken-and-egg problem.</span></p>
<p style="text-align:left"><span>The other side of the coin is that the whole point of the grade crossing project is to use OpenCV, which means I need OpenCV Rust bindings. There are some, but who knows how good they are </span><span style="font-style:italic">on ESP32</span><span style="font-family:&quot;Workbench&quot;;font-size:12pt">&nbsp;(I don’t care if Rust + OpenCV works on desktop).</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">So conclusion:</span></p>
<ul style="margin:0">
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Rust: No candidate.</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Kotlin: Maybe Rig 4.3 reboot or Conductor 2.1 ?</span></li>
</ul>
<p style="height:12pt;text-align:left"></p>
<p style="height:12pt;text-align:left"></p>
<hr>
<p style="height:12pt;text-align:left"></p>


</div>
<div class="post-container">
<div class="post-title-container">
<a class="post-title-link" href="2020-11-30_blinking_led_-_pir_approach.html">
    <h2 class="post-title">2020-11-30 - Blinking LED - PIR approach</h2>
</a>
<span class="post-cat" title="Category">
    <span class="post-cat-label">Category</span>
    <span class="post-cat-text">
    
    <a class="post-cat-link" href="../../blog/dev" title="View All Category Posts">DEV</a>
    </span>
</span></div>

<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">So here’s yet another approach: use a small PIR module, like the tiny “arduino” ones I use at Randall. This thing has a 1k Ω resistor on the output, and we can already trigger repeats &amp; duration, so it’s essentially mirroring what a 555 timer would do and at the same time it would only blink the LED when presence is detected in the garage. </span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">That would save on the battery by not blinking it when there’s no one around.</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">The sensor still needs to be powered.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Links from when I used that kind of sensor at Randall:</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span>Sensor is a HC-SR501. </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.mpja.com/download/31227sc.pdf" style="color:inherit;text-decoration:inherit">Datasheet link via Aliexpress</a></span><span style="font-family:&quot;Workbench&quot;;font-size:12pt">.</span></p>
<ul style="margin:0">
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">The SR501 uses a 7133 voltage regulator. We can feed it with the 5V from the AIU’s 7805.</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">The BISS001 drives the OUT pin directly via a 1kΩ resistor.</span></li>
</ul>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span>Main component is a BISS0001, </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="http://www.ladyada.net/media/sensors/BISS0001.pdf" style="color:inherit;text-decoration:inherit">datasheet link from Ladyada</a></span><span style="font-family:&quot;Workbench&quot;;font-size:12pt">.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Of note:</span></p>
<ul style="margin:0">
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Input voltage: 5-20 V; and on another page it says 4.5-20 V..</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Power consumption: 65 mA.</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Quiescent current: &lt; 50 uA.</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Output TTL 3.3 V.</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Jumper L = single trigger, H = repeat trigger.</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Pot on the jumper side = sensitivity.</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Pot farther from the jumper = time delay (5-300 s).</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Must be mounted horizontal for a variation left/right (e.g. pins at top or bottom).</span></li>
</ul>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">One thing I had noticed at Randall is that these do not work when powered by 3 V. The unit “blinks” the output repeatedly. My guess is it fails to initialize (they go through a 1-min stabilization phase when first powered).</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">In my case, that means I need a 3-AA battery holder instead of my current 2-AA battery holder. It does work well with a 3-AAA holder.</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">On the output side, I got the illumination I want using a 1k Ω resistor on the output and a green LED. Red one was a bit weak for the value, although I could remove the extra 1kΩ.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">I installed that and it works nicely as I want.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Update: I got about 1-2 years out of 3 AAA batteries powering this with moderate daily usage.</span></p>
<p style="height:12pt;text-align:left"></p>
<hr>
<p style="height:12pt;text-align:left"></p>


</div>
<div class="post-container">
<div class="post-title-container">
<a class="post-title-link" href="2020-11-25_blinking_led_-_astable_trans_c141203b.html">
    <h2 class="post-title">2020-11-25 - Blinking LED - Astable transistor/555 approach</h2>
</a>
<span class="post-cat" title="Category">
    <span class="post-cat-label">Category</span>
    <span class="post-cat-text">
    
    <a class="post-cat-link" href="../../blog/dev" title="View All Category Posts">DEV</a>
    </span>
</span></div>

<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Another surely doomed attempt using an RC and a transistor. As expected, it did not work.</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Although it is inherently flawed, I’ll put it here:</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:0.00px solid #000000;display:inline-block;height:266.00px;margin:0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:407.00px"><img alt="" src="img_1c371a8c748fd0f0f687b8d2cabc153f90a908dc96beebcb6365a4b002645ccai.png" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span>Transistor is a </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.onsemi.com/pub/Collateral/2N3903-D.PDF" style="color:inherit;text-decoration:inherit">2N3904</a></span><span style="font-family:&quot;Workbench&quot;;font-size:12pt">.</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">This obviously does create a delay starting the LED. Then there’s nothing to stop it. The futile idea was to add a second transistor between “ground” and the battery minus side to cut the circuit. Problem is that there’s nothing here that would generate something suitable to trigger it. Something like this:</span></p>
<p style="text-align:left"><span style="background-color:rgb(255, 255, 0)"></span></p>

<a href="2020-11-25_blinking_led_-_astable_trans_c141203b.html">Click here to continue reading...</a>
<p/>
<hr/>
</div>
<div class="post-container">
<div class="post-title-container">
<a class="post-title-link" href="2020-11-24_blinking_led_--_arduino_esp3_ae4e30a8.html">
    <h2 class="post-title">2020-11-24 - Blinking LED -- Arduino/ESP32 approach</h2>
</a>
<span class="post-cat" title="Category">
    <span class="post-cat-label">Category</span>
    <span class="post-cat-text">
    
    <a class="post-cat-link" href="../../blog/dev" title="View All Category Posts">DEV</a>
    </span>
</span></div>

<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">An even easier way to blink a LED is to not use a LED. An ESP32 or an Arduino Nano both have a LED onboard. All I need is the smallest program that would turn on the onboard LED on a timer/interrupt, and ideally keep the CPU sleeping/idle/suspended the rest of the time.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Some ESP32 dev boards come with a connector designed to power them from a battery, like the “Heltec Wifi Kit 32” ones I have.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">The Arduino Nano dev boards have 4 leds (RX, TX, PowerOn, IO). The Power-On is always one when the device is powered. The trace leading to the LED can be cut. A quick online search indicates it can be powered by 3xAA (~ 6V) using the last 2 pins (GND / VIN). However the same research indicates on a Nano board, the FTDI/USB chip will use about 30-40 mA all the time, rendering the effort quite moot.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Another choice is the Digistump Digispark 1. It also has a green Power-On LED as well as an IO LED.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">What about the Arduino? How do you “suspend” the Atmega328P in a Nano or the ATTiny?</span></p>
<ul style="margin:0">
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span>From this thread: </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://thekurks.net/blog/2018/1/24/guide-to-arduino-sleep-mode" style="color:inherit;text-decoration:inherit">https://thekurks.net/blog/2018/1/24/guide-to-arduino-sleep-mode</a></span><span style="font-family:&quot;Workbench&quot;;font-size:12pt">&nbsp;avr/sleep.h defines a sleep_enable() + set_sleep_mode(SLEEP_MODE_PWR_DOWN).</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">It also indicates the only way to wake it up is using an external RTC timer on an interrupt (for example an Adafruit DS3231 Precision RTC controlled via I2C).</span></li>
</ul>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span>The ESP32 for sure has APIs to put it in deep-sleep mode. It’s designed for that: </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/system/sleep_modes.html" style="color:inherit;text-decoration:inherit">https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/system/sleep_modes.html</a></span><span style="font-family:&quot;Workbench&quot;;font-size:12pt">&nbsp;</span></p>
<ul style="margin:0">
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">esp_bluedroid_disable(), esp_bt_controller_disable(), esp_wifi_stop().</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">rtc_gpio_isolate(pins...) to disable pullups/pulldowns on IOs.</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">esp_light_sleep_start() or esp_deep_sleep_start().</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">esp_sleep_enable_timer_wakeup() ⇒ wake up from deep sleep using timer.</span></li>
</ul>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Can the ULP Processor be used to trigger the LED directly?</span></p>
<ul style="margin:0">
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-guides/ulp.html" style="color:inherit;text-decoration:inherit">https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-guides/ulp.html</a></span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">No, it won’t drive IOs but it can wake up the processor.</span></li>
</ul>
<p style="height:12pt;text-align:left"></p>
<p style="height:12pt;text-align:left"></p>
<p style="height:12pt;text-align:left"></p>
<hr>
<p style="height:12pt;text-align:left"></p>


</div>
<div class="post-container">
<div class="post-title-container">
<a class="post-title-link" href="2020-11-17_blinking_led_--_naive_rc_approach.html">
    <h2 class="post-title">2020-11-17 - Blinking LED -- Naive RC approach</h2>
</a>
<span class="post-cat" title="Category">
    <span class="post-cat-label">Category</span>
    <span class="post-cat-text">
    
    <a class="post-cat-link" href="../../blog/dev" title="View All Category Posts">DEV</a>
    </span>
</span></div>

<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Goal: blinking led in the garage when the side bolt is closed. Ideally battery powered.</span></p>
<ul style="margin:0">
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Idea is to have it blink to save energy and work longer in battery.</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">What is the simplest way to blink a led, or more exactly the less current usage?</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">How much can I expect of e.g. an AA battery? Or a couple add I have a holder for that.</span></li>
</ul>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Random idea: use a led forward voltage, resistor slowly charging a cap and when above the led voltage it would discharge.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.digikey.com/en/resources/conversion-calculators/conversion-calculator-time-constant" style="color:inherit;text-decoration:inherit">Resistor-Capacitor (RC) Time Constant Calculator | DigiKey Electronics</a></span></p>
<ul style="margin:0">
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">To compute a RC time:</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Tau = R.C = 63% of final charge time.</span></li>
</ul>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span>This does not work, as tried in N</span><span>ational Instruments Multisim</span><span style="font-family:&quot;Workbench&quot;;font-size:12pt">:</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:0.00px solid #000000;display:inline-block;height:251.00px;margin:0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:466.00px"><img alt="" src="img_eb7218448385532ded717edf2472a1d81ecf9420b35a0fc857e4231391e809a1i.png" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="-webkit-transform:rotate(0.00rad) translateZ(0px);border:0.00px solid #000000;display:inline-block;height:375.50px;margin:0.00px 0.00px;overflow:hidden;transform:rotate(0.00rad) translateZ(0px);width:385.30px"><img alt="" src="img_c83002441b2843ce9bb89db303591a603b89a64a016a8466e0bafc52b219ec3ci.jpg" style="margin-left:0.00px;margin-top:0.00px" title=""></span></p>
<p style="height:12pt;text-align:left"></p>
<p style="height:12pt;text-align:left"></p>
<hr>
<p style="height:12pt;text-align:left"></p>


</div>
<div class="post-container">
<div class="post-title-container">
<a class="post-title-link" href="2020-11-12_remote_plug_motion.html">
    <h2 class="post-title">2020-11-12 - Remote plug + motion</h2>
</a>
<span class="post-cat" title="Category">
    <span class="post-cat-label">Category</span>
    <span class="post-cat-text">
    
    <a class="post-cat-link" href="../../blog/dev" title="View All Category Posts">DEV</a>
    </span>
</span></div>

<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">For the daily Xmas lights, what I’d like is to have:</span></p>
<ul style="margin:0">
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Person detection, likely using an existing PIR.</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Light detection, to turn it on when it gets dark.</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Server/wifi control so that I could rifle it from the phone.</span></li>
</ul>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">One option is to take the existing timer plug and control it from an ESP32. Doesn't even have to be a cam one, using a PIR in max range could work.</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">I'd like to have a second ESP+PIR across the room for more coverage. Whenever any of these detect motion, light would stay on for e.g. 15 minutes. The second ESP can send an ESP-NOW data packet to the first one.</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">A local button toggle would be ideal.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">The other option would be to use a dedicated wifi plug like the sonoff. I do want something absolutely local that does not use any cloud.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="height:12pt;text-align:left"></p>
<hr>
<p style="height:12pt;text-align:left"></p>


</div>
<div class="post-container">
<div class="post-title-container">
<a class="post-title-link" href="2020-10-11_remote_plug_control.html">
    <h2 class="post-title">2020-10-11 - Remote Plug Control</h2>
</a>
<span class="post-cat" title="Category">
    <span class="post-cat-label">Category</span>
    <span class="post-cat-text">
    
    <a class="post-cat-link" href="../../blog/dev" title="View All Category Posts">DEV</a>
    </span>
</span></div>

<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span>8 Channel Smartphone Relay WiFi Remote Control Kit: </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://amzn.to/3VZSvw1" style="color:inherit;text-decoration:inherit">https://amzn.to/3VZSvw1</a></span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Note: Not a SainSmart, seems like “TOSR08” but really looks like the former</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span>More description in the kit here: </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.tinyosshop.com/8-channel-wifi-relay-module-remote-control-kit" style="color:inherit;text-decoration:inherit">https://www.tinyosshop.com/8-channel-wifi-relay-module-remote-control-kit</a></span><span style="font-family:&quot;Workbench&quot;;font-size:12pt">&nbsp;[$88 !!]</span></p>
<ul style="margin:0">
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">TOSR0x module has a FT232RL USB-to-UART input + 5V barrel DC</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Control done by sending one byte.</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Module has a switch: USB or separate “extension port” (not both)</span></li>
</ul>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">And the kit provides:</span></p>
<ul style="margin:0">
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">WifiBee wireless module</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">XBee USB adapter</span></li>
</ul>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">(so wait, do they mean phone &gt; wifi &gt; wifi-to-xbee &gt; xbee-to-usb &gt; usb-to-uart? Very likely.)</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">A better option is to get the TOSROx module and plug that on an arduino / ESP32.</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">But that $88 cost is definitely a non-starter.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span>Sonoff 4-channel “R2” wifi w/ Android app [$28]: </span><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://amzn.to/3VXmuVf" style="color:inherit;text-decoration:inherit">https://amzn.to/3VXmuVf</a></span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Is “R2” a “revision 2”? It must be as there’s a “4CHR3” for about the same price.</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Described as “is an ESP8285 WiFi module based 4 channel (4-way) WiFi wireless switch.”</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Somehow “Sonoff” and “ITEAD” are the same thing/company/something related?</span></p>
<p style="text-align:left"><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="https://www.itead.cc/wiki/Sonoff_4CH" style="color:inherit;text-decoration:inherit">https://www.itead.cc/wiki/Sonoff_4CH</a></span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">⇒ Question: is there an API to use that without their app? ⇒ Not the 4CH one.</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="-webkit-text-decoration-skip:none;color:rgb(17, 85, 204);text-decoration:underline;text-decoration-skip-ink:none"><a href="http://developers.sonoff.tech/sonoff-diy-mode-api-protocol.html" style="color:inherit;text-decoration:inherit">http://developers.sonoff.tech/sonoff-diy-mode-api-protocol.html</a></span><span style="font-family:&quot;Workbench&quot;;font-size:12pt">&nbsp;“The DIY Mode is designed for IoT home automation users and developers who would like to control the SONOFF device via existing home automation open-source platform or local HTTP client instead of eWeLink App.”</span></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Supported: “BasicR3”, “RFR3”, “MINI”, “D1” (dimmer) (these only toggle 1 output)</span></p>
<p style="height:12pt;text-align:left"></p>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">One direct application would be control of the xmas lights from server -- time based and/or image based. Ideal detection would be “any kind of motion detection” in living room, kitchen, and hallway leaving the lights on for 10+ minutes.</span></p>
<ul style="margin:0">
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">An ESP32-CAM with the widest lens possible would be ideal, or even 2 of them (one by chimney).</span></li>
</ul>
<p style="text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Options on how to control the lights:</span></p>
<ul style="margin:0">
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">DYI:</span></li>
 <ul>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Add a 3-to-5V converter.</span></li>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Add a 250V 2-channel relay (to switch both L1+N).</span></li>
 </ul>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Use something like a Sonoff or a more “serious” option for the plug control.</span></li>
 <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Modify an existing timer switch. </span></li>
 <ul>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">The one I’m using right now is essentially a relay switching the hot wire (small prong of the polarized plug).</span></li>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">It has 2 boards: power + relay vs control board.</span></li>
  <li style="padding-bottom:0pt;padding-left:0pt;padding-top:0pt;text-align:left"><span style="font-family:&quot;Workbench&quot;;font-size:12pt">Connector with 3 wires: Vss, Vcc, On. (voltages?)</span></li>
 </ul>
</ul>
<p style="height:12pt;text-align:left"></p>
<p style="height:12pt;text-align:left"></p>
<hr>
<p style="height:12pt;text-align:left"></p>


</div>





<div class="prev-next-container">

    <span class="prev-page"><a href="0006.html">⇐ Newer Posts</a><br/></span>
    <span class="next-page"><a href="0008.html">Older Posts ⇒</a><br/></span>


</div>

</div> <!-- container -->
</div> <!-- main -->

<div class="bottom-container">&nbsp;Generated on 2025-09-02 by Rig4j 0.1-Exp-05cc7b2&nbsp;</div>

</main>

<script async src="https://www.googletagmanager.com/gtag/js?id=G-GCEQ33G1MB"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-GCEQ33G1MB');
</script>

</body>
</html>

